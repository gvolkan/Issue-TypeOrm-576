var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};System.register("typeorm/driver/types/DatabaseType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/DriverOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/types/ColumnTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/RelationTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/naming-strategy/NamingStrategyInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/OnDeleteType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/ForeignKeyMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete,e.namingStrategy&&this.build(e.namingStrategy)}return e.prototype.build=function(e){this.columnNames=this.columns.map(function(e){return e.databaseName}),this.referencedColumnNames=this.referencedColumns.map(function(e){return e.databaseName}),this.tableName=this.entityMetadata.tableName,this.referencedTableName=this.referencedEntityMetadata.tableName,this.name=e.foreignKeyName(this.tableName,this.columnNames,this.referencedEntityMetadata.tableName,this.referencedColumnNames)},e}(),e("ForeignKeyMetadata",n)}}}),System.register("typeorm/common/ObjectLiteral",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EmbeddedMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/Alias",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){Object.assign(this,e||{})}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMetadata",{get:function(){return!!this._metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!this._metadata)throw new Error('Cannot get entity metadata for the given alias "'+this.name+'"');return this._metadata},set:function(e){this._metadata=e},enumerable:!0,configurable:!0}),e}(),e("Alias",n)}}}),System.register("typeorm/find-options/OrderByCondition",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/JoinOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/QueryBuilderUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.isAliasProperty=function(e){if("string"!=typeof e||-1===e.indexOf("."))return!1;var t=e.split("."),n=t[0],r=t[1];if(!n||!r)return!1;var i=/^[a-zA-Z0-9_-]+$/;return!(!i.test(n)||!i.test(r))},e}(),e("QueryBuilderUtils",n)}}}),System.register("typeorm/query-builder/JoinAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n){this.connection=e,this.queryExpressionMap=t,this.joinAttribute=n,Object.assign(this,n||{})}return Object.defineProperty(e.prototype,"isMany",{get:function(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tableName",{get:function(){return this.metadata?this.metadata.tableName:this.entityOrProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(n.QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(n.QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(n.QueryBuilderUtils.isAliasProperty(this.entityOrProperty)){var e=this.queryExpressionMap.findAliasByName(this.parentAlias),t=(e.metadata.parentEntityMetadata?e.metadata.parentEntityMetadata:e.metadata).findRelationWithPropertyPath(this.relationPropertyPath);if(!t)throw new Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return t}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){if(!this.relation)throw new Error("Cannot get junction table for join without relation.");return this.relation.isOwning?this.parentAlias+"_"+this.alias.name:this.alias.name+"_"+this.parentAlias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}(),e("JoinAttribute",r)}}}),System.register("typeorm/query-builder/relation-id/RelationIdLoadResult",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/relation-count/RelationCountAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t){this.expressionMap=e,this.relationCountAttribute=t,Object.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationProperty",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");return this.relationName.split(".")[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=this.relationName.split(".");return e[0]+"_"+e[1]+"_relation_count"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=this.relationName.split("."),t=e[0],r=e[1],i=this.expressionMap.findAliasByName(t).metadata.findRelationWithPropertyPath(r);if(!i)throw new Error("Relation with property path "+r+" in entity was not found.");return i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}(),e("RelationCountAttribute",r)}}}),System.register("typeorm/query-builder/relation-count/RelationCountLoadResult",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/util/OrmUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.splitClassesAndStrings=function(e){return[e.filter(function(e){return"string"!=typeof e}),e.filter(function(e){return"string"==typeof e})]},e.groupBy=function(e,t){return e.reduce(function(e,n){var r=t(n),i=e.find(function(e){return e.id===r});return i||(i={id:r,items:[]},e.push(i)),i.items.push(n),e},[])},e.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},e.mergeDeep=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!t.length)return e;var r=t.shift();if(this.isObject(e)&&this.isObject(r))for(var i in r)this.isObject(r[i])?(e[i]||Object.assign(e,(o={},o[i]={},o)),this.mergeDeep(e[i],r[i])):Object.assign(e,(a={},a[i]=r[i],a));return this.mergeDeep.apply(this,[e].concat(t));var o,a},e.deepCompare=function(){function e(t,n){var r;if(isNaN(t)&&isNaN(n)&&"number"==typeof t&&"number"==typeof n)return!0;if(t===n)return!0;if(t.equals instanceof Function&&t.equals(n))return!0;if("function"==typeof t&&"function"==typeof n||t instanceof Date&&n instanceof Date||t instanceof RegExp&&n instanceof RegExp||t instanceof String&&n instanceof String||t instanceof Number&&n instanceof Number)return t.toString()===n.toString();if(!(t instanceof Object&&n instanceof Object))return!1;if(t.isPrototypeOf(n)||n.isPrototypeOf(t))return!1;if(t.constructor!==n.constructor)return!1;if(t.prototype!==n.prototype)return!1;if(o.indexOf(t)>-1||a.indexOf(n)>-1)return!1;for(r in n){if(n.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;if(typeof n[r]!=typeof t[r])return!1}for(r in t){if(n.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;if(typeof n[r]!=typeof t[r])return!1;switch(typeof t[r]){case"object":case"function":if(o.push(t),a.push(n),!e(t[r],n[r]))return!1;o.pop(),a.pop();break;default:if(t[r]!==n[r])return!1}}return!0}for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r,i,o,a;if(arguments.length<1)return!0;for(r=1,i=arguments.length;r<i;r++)if(o=[],a=[],!e(arguments[0],arguments[r]))return!1;return!0},e.toBoolean=function(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e||"1"===e:"number"==typeof e&&e>0},e.zipObject=function(e,t){return e.reduce(function(e,n,r){return e[n]=t[r],e},{})},e}(),e("OrmUtils",n)}}}),System.register("typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer",["typeorm/util/OrmUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n,r){this.driver=e,this.joinAttributes=t,this.rawRelationIdResults=n,this.rawRelationCountResults=r}return e.prototype.transform=function(e,t){var n=this;return this.group(e,t).map(function(e){return n.transformRawResultsGroup(e,t)}).filter(function(e){return!!e})},e.prototype.group=function(e,t){var n=[];return e.forEach(function(e){var r=t.metadata.primaryColumns.map(function(n){return e[t.name+"_"+n.databaseName]}).join("_");if(r){var i=n.find(function(e){return e.id===r});i||(i={id:r,items:[]},n.push(i)),i.items.push(e)}}),n.map(function(e){return e.items})},e.prototype.transformRawResultsGroup=function(e,t){var n=!1,r=!1,i=!1,o=!1,a=t.metadata.create();if(t.metadata.discriminatorColumn){var s=e.map(function(e){return e[t.name+"_"+t.metadata.discriminatorColumn.databaseName]}),u=t.metadata.childEntityMetadatas.find(function(e){return!!s.find(function(t){return t===e.discriminatorValue})});u&&(a=u.create())}return n=this.transformColumns(e,t,a,t.metadata),r=this.transformJoins(e,a,t),i=this.transformRelationIds(e,t,a),o=this.transformRelationCounts(e,t,a),n||r||i||o?a:void 0},e.prototype.transformColumns=function(e,t,n,r){var i=this,o=!1;return r.columns.forEach(function(r){var a=e[0][t.name+"_"+r.databaseName];void 0===a||null===a||r.isVirtual||r.isParentId||r.isDiscriminator||(r.setEntityValue(n,i.driver.prepareHydratedValue(a,r)),o=!0)}),t.metadata.parentEntityMetadata&&t.metadata.parentEntityMetadata.columns.forEach(function(r){var a=e[0]["parentIdColumn_"+t.metadata.parentEntityMetadata.tableName+"_"+r.databaseName];void 0===a||null===a||r.isVirtual||r.isParentId||r.isDiscriminator||(r.setEntityValue(n,i.driver.prepareHydratedValue(a,r)),o=!0)}),o},e.prototype.transformJoins=function(e,t,n){var r=this,i=!1,o="";return n.metadata.discriminatorColumn&&(o=e[0][n.name+"_"+n.metadata.discriminatorColumn.databaseName]),this.joinAttributes.forEach(function(a){if(a.metadata){var s=n.metadata.childEntityMetadatas.find(function(e){return o===e.discriminatorValue});if(!s||!a.relation||s.target===a.relation.target){if(a.mapToProperty){if(a.mapToPropertyParentAlias!==n.name)return}else if(!a.relation||a.parentAlias!==n.name||a.relationPropertyPath!==a.relation.propertyPath)return;var u=r.transform(e,a.alias),c=a.isMany?u:u[0];c&&(a.mapToPropertyPropertyName?t[a.mapToPropertyPropertyName]=c:a.relation.setEntityValue(t,c),i=!0)}}}),i},e.prototype.transformRelationIds=function(e,t,r){var i=this,o=!1;return this.rawRelationIdResults.forEach(function(a){if(a.relationIdAttribute.parentAlias===t.name){var s=a.relationIdAttribute.relation,u=i.createValueMapFromJoinColumns(s,a.relationIdAttribute.parentAlias,e);if(void 0!==u&&null!==u){var c=a.results.map(function(e){var r=i.extractEntityPrimaryIds(s,e);if(t.metadata.compareIds(r,u)){var o,c=(o=s.isManyToOne||s.isOneToOneOwner?s.joinColumns.map(function(e){return e}):s.isOneToMany||s.isOneToOneNotOwner?s.inverseEntityMetadata.primaryColumns.map(function(e){return e}):s.isOwning?s.inverseJoinColumns.map(function(e){return e}):s.inverseRelation.joinColumns.map(function(e){return e})).reduce(function(t,r){return s.isOneToMany||s.isOneToOneNotOwner?n.OrmUtils.mergeDeep(t,r.createValueMap(e[r.databaseName])):n.OrmUtils.mergeDeep(t,r.referencedColumn.createValueMap(e[r.databaseName]))},{});return 1===o.length&&!1===a.relationIdAttribute.disableMixedMap?s.isOneToMany||s.isOneToOneNotOwner?o[0].getEntityValue(c):o[0].referencedColumn.getEntityValue(c):c}}).filter(function(e){return e}),l=a.relationIdAttribute.mapToPropertyPropertyPath.split("."),d=function(e,t,n){var r=e.shift();return r&&0===e.length?(t[r]=n,t):r&&e.length>0?void d(e,t[r],n):t};s.isOneToOne||s.isManyToOne?d(l,r,c[0]):d(l,r,c),o=!0}}}),o},e.prototype.transformRelationCounts=function(e,t,n){var r=!1;return this.rawRelationCountResults.filter(function(e){return e.relationCountAttribute.parentAlias===t.name}).forEach(function(i){var o,a=i.relationCountAttribute.relation;o=a.isOneToMany?a.inverseRelation.joinColumns[0].referencedColumn.databaseName:a.isOwning?a.joinColumns[0].referencedColumn.databaseName:a.inverseRelation.joinColumns[0].referencedColumn.databaseName;var s=e[0][t.name+"_"+o];void 0!==s&&null!==s&&(n[i.relationCountAttribute.mapToPropertyPropertyName]=0,i.results.filter(function(e){return e.parentId===s}).forEach(function(e){n[i.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),r=!0}))}),r},e.prototype.createValueMapFromJoinColumns=function(e,t,n){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(r,i){return n.forEach(function(n){e.isManyToOne||e.isOneToOneOwner?r[i.databaseName]=n[t+"_"+i.databaseName]:r[i.databaseName]=n[t+"_"+i.referencedColumn.databaseName]}),r},{})},e.prototype.extractEntityPrimaryIds=function(e,t){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(e,n){return e[n.databaseName]=t[n.databaseName],e},{})},e}(),e("RawSqlResultsToEntityTransformer",r)}}}),System.register("typeorm/driver/error/ConnectionIsNotSetError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="ConnectionIsNotSetError",n.message="Connection with "+t+" database is not established. Check connection configuration.",n}return __extends(t,e),t}(Error),e("ConnectionIsNotSetError",n)}}}),System.register("typeorm/driver/error/DriverPackageNotInstalledError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="DriverPackageNotInstalledError",r.message=t+" package has not been found installed. Try to install it: npm install "+n+" --save",r}return __extends(t,e),t}(Error),e("DriverPackageNotInstalledError",n)}}}),System.register("typeorm/driver/DriverUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.buildDriverOptions=function(e,t){if(e.url){var n=this.parseConnectionUrl(e.url);if(t&&t.useSid){r={type:e.type,host:n.host,username:n.username,password:n.password,port:n.port,sid:n.database};return Object.assign(r,e)}var r={type:e.type,host:n.host,username:n.username,password:n.password,port:n.port,database:n.database};return Object.assign(r,e)}return Object.assign({},e)},e.parseConnectionUrl=function(e){var t=e.indexOf("//"),n=e.substr(t+2),r=n.indexOf("/"),i=-1!==r?n.substr(0,r):n,o=-1!==r?n.substr(r+1):void 0,a=i.split("@"),s=a[0],u=a[1],c=s.split(":"),l=c[0],d=c[1],p=u.split(":"),m=p[0],f=p[1];return{host:m,username:l,password:d,port:f?parseInt(f):void 0,database:o||void 0}},e}(),e("DriverUtils",n)}}}),System.register("typeorm/driver/error/TransactionAlreadyStartedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="TransactionAlreadyStartedError",t.message="Transaction already started for the given connection, commit current transaction before starting a new one.",t}return __extends(t,e),t}(Error),e("TransactionAlreadyStartedError",n)}}}),System.register("typeorm/driver/error/TransactionNotStartedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="TransactionNotStartedError",t.message="Transaction is not started yet, start transaction before committing or rolling it back.",t}return __extends(t,e),t}(Error),e("TransactionNotStartedError",n)}}}),System.register("typeorm/metadata-args/IndexMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/IndexMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.isUnique=!1,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.isUnique=e.args.unique,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this,n={};if(this.tableName=this.entityMetadata.tableName,this.givenColumnNames){var r=[];if(this.givenColumnNames instanceof Array)(r=this.givenColumnNames).forEach(function(e){return n[e]=1});else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);i instanceof Array?(r=i.map(function(e){return String(e)})).forEach(function(e){return n[e]=1}):(r=Object.keys(i).map(function(e){return String(e)}),Object.keys(i).forEach(function(e){return n[e]=i[e]}))}var o=this.entityMetadata.columns.filter(function(e){return-1!==r.indexOf(e.propertyPath)});this.entityMetadata.relations.filter(function(e){return e.isWithJoinColumn&&-1!==r.indexOf(e.propertyName)}).forEach(function(e){return o.push.apply(o,e.joinColumns)});var a=r.filter(function(e){return!t.entityMetadata.columns.find(function(t){return t.propertyPath===e})&&!t.entityMetadata.relations.find(function(t){return t.isWithJoinColumn&&t.propertyPath===e})});if(a.length>0)throw new Error("Index "+(this.givenName?'"'+this.givenName+'" ':"")+"contains columns that are missing in the entity: "+a.join(", "));this.columns=o}return this.columnNamesWithOrderingMap=Object.keys(n).reduce(function(e,r){var i=t.entityMetadata.columns.find(function(e){return e.propertyPath===r});return i&&(e[i.databaseName]=n[r]),e},{}),this.name=e.indexName(this.givenName?this.givenName:void 0,this.entityMetadata.tableName,this.columns.map(function(e){return e.databaseName})),this},e}(),e("IndexMetadata",n)}}}),System.register("typeorm/schema-builder/schema/IndexSchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r){this.tableName=e,this.name=t,this.columnNames=n,this.isUnique=r}return e.prototype.clone=function(){return new e(this.tableName,this.name,this.columnNames.map(function(e){return e}),this.isUnique)},e.create=function(t){return new e(t.entityMetadata.tableName,t.name,t.columns.map(function(e){return e.databaseName}),t.isUnique)},e}(),e("IndexSchema",n)}}}),System.register("typeorm/schema-builder/schema/ForeignKeySchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r,i){this.name=e,this.columnNames=t,this.referencedColumnNames=n,this.referencedTableName=r,this.onDelete=i}return e.prototype.clone=function(){return new e(this.name,this.columnNames,this.referencedColumnNames,this.referencedTableName)},e.create=function(t){return new e(t.name,t.columnNames,t.referencedColumnNames,t.referencedTableName,t.onDelete)},e}(),e("ForeignKeySchema",n)}}}),System.register("typeorm/schema-builder/schema/PrimaryKeySchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){this.name=e,this.columnName=t}return e.prototype.clone=function(){return new e(this.name,this.columnName)},e}(),e("PrimaryKeySchema",n)}}}),System.register("typeorm/schema-builder/schema/TableSchema",["typeorm/schema-builder/schema/ColumnSchema"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,r){this.columns=[],this.indices=[],this.foreignKeys=[],this.primaryKeys=[],this.justCreated=!1,this.name=e,t&&(this.columns=t.map(function(e){return e instanceof n.ColumnSchema?e:new n.ColumnSchema(e)})),void 0!==r&&(this.justCreated=r)}return Object.defineProperty(e.prototype,"primaryKeysWithoutGenerated",{get:function(){var e=this.columns.find(function(e){return e.isGenerated});return e?this.primaryKeys.filter(function(t){return t.columnName!==e.name}):this.primaryKeys},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasGeneratedColumn",{get:function(){return!!this.columns.find(function(e){return e.isGenerated})},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e(this.name);return t.columns=this.columns.map(function(e){return e.clone()}),t.indices=this.indices.map(function(e){return e.clone()}),t.foreignKeys=this.foreignKeys.map(function(e){return e.clone()}),t.primaryKeys=this.primaryKeys.map(function(e){return e.clone()}),t.engine=this.engine,t},e.prototype.addColumns=function(e){this.columns=this.columns.concat(e)},e.prototype.replaceColumn=function(e,t){this.columns[this.columns.indexOf(e)]=t},e.prototype.removeColumn=function(e){var t=this.columns.find(function(t){return t.name===e.name});t&&this.columns.splice(this.columns.indexOf(t),1)},e.prototype.removeColumns=function(e){var t=this;e.forEach(function(e){return t.removeColumn(e)})},e.prototype.addPrimaryKeys=function(e){var t=this;e.forEach(function(e){return t.primaryKeys.push(e)})},e.prototype.removePrimaryKeys=function(e){var t=this;e.forEach(function(e){t.primaryKeys.splice(t.primaryKeys.indexOf(e),1)})},e.prototype.removePrimaryKeysOfColumns=function(e){this.primaryKeys=this.primaryKeys.filter(function(t){return!e.find(function(e){return e.name===t.columnName})})},e.prototype.addForeignKeys=function(e){this.foreignKeys=this.foreignKeys.concat(e)},e.prototype.removeForeignKey=function(e){var t=this.foreignKeys.find(function(t){return t.name===e.name});t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)},e.prototype.removeForeignKeys=function(e){var t=this;e.forEach(function(e){return t.removeForeignKey(e)})},e.prototype.removeIndex=function(e){var t=this.indices.find(function(t){return t.name===e.name});t&&this.indices.splice(this.indices.indexOf(t),1)},e.prototype.findChangedColumns=function(e,t){var n=this;return this.columns.filter(function(r){var i=t.find(function(e){return e.databaseName===r.name});return!!i&&(r.name!==i.databaseName||r.type!==e.normalizeType(i)||r.comment!==i.comment||!r.isGenerated&&!n.compareDefaultValues(e.normalizeDefault(i),r.default)||r.isNullable!==i.isNullable||r.isUnique!==i.isUnique||r.isGenerated!==i.isGenerated)})},e.prototype.findColumnByName=function(e){return this.columns.find(function(t){return t.name===e})},e.prototype.compareDefaultValues=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e=e.replace(/\(\([0-9.]*\)\)$/g,"$1"),t=t.replace(/\(\(([0-9.]*?)\)\)$/g,"$1"),e=e.replace(/^\(|\)$/g,""),t=t.replace(/^\(|\)$/g,""),e=e.replace(/^'+|'+$/g,""),t=t.replace(/^'+|'+$/g,"")),e===t},e.create=function(t,r){var i=new e(t.tableName);return i.engine=t.engine,t.columns.forEach(function(e){i.columns.push(n.ColumnSchema.create(e,r.normalizeType(e),r.normalizeDefault(e)))}),i},e}(),e("TableSchema",r)}}}),System.register("typeorm/query-runner/error/QueryRunnerAlreadyReleasedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="QueryRunnerAlreadyReleasedError",t.message="Query runner already released. Cannot run queries anymore.",t}return __extends(t,e),t}(Error),e("QueryRunnerAlreadyReleasedError",n)}}}),System.register("typeorm/find-options/JoinOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/find-options/FindOneOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/find-options/FindManyOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/common/ObjectType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-runner/error/QueryRunnerProviderAlreadyReleasedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="QueryRunnerProviderAlreadyReleasedError",t.message="Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.",t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("QueryRunnerProviderAlreadyReleasedError",n)}}}),System.register("typeorm/common/DeepPartial",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/RemoveOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/SaveOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-manager/error/NoNeedToReleaseEntityManagerError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="NoNeedToReleaseEntityManagerError",t.message="Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.",t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("NoNeedToReleaseEntityManagerError",n)}}}),System.register("typeorm/repository/Repository",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e.prototype.hasId=function(e){return this.manager.hasId(this.metadata.target,e)},e.prototype.getId=function(e){return this.manager.getId(this.metadata.target,e)},e.prototype.createQueryBuilder=function(e,t){return this.manager.createQueryBuilder(this.metadata.target,e,t||this.queryRunner)},e.prototype.create=function(e){return this.manager.create(this.metadata.target,e)},e.prototype.merge=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return(r=this.manager).merge.apply(r,[this.metadata.target,e].concat(t));var r},e.prototype.preload=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.manager.preload(this.metadata.target,e)]})})},e.prototype.save=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.save(this.metadata.target,e,t)]})})},e.prototype.persist=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.save(e,t)]})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.findOne(e)];case 1:if(!(r=i.sent()))throw new Error("Cannot find entity to update by a given criteria");return Object.assign(r,t),[4,this.save(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.updateById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.manager.updateById(this.metadata.target,e,t,n)]})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.remove(this.metadata.target,e,t)]})})},e.prototype.removeById=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.removeById(this.metadata.target,e,t)]})})},e.prototype.removeByIds=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.removeByIds(this.metadata.target,e,t)]})})},e.prototype.count=function(e){return this.manager.count(this.metadata.target,e)},e.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},e.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},e.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},e.prototype.findOne=function(e){return this.manager.findOne(this.metadata.target,e)},e.prototype.findOneById=function(e,t){return this.manager.findOneById(this.metadata.target,e,t)},e.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.query(e,t)]})})},e.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.clear(this.metadata.target)]})})},e}(),e("Repository",n)}}}),System.register("typeorm/driver/mongodb/typings",["events","stream"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){}}}),System.register("typeorm/driver/mongodb/MongoQueryRunner",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){this.isReleased=!1,this.isTransactionActive=!1,this.connection=e,this.manager=e.manager,this.databaseConnection=t}return e.prototype.cursor=function(e,t){return this.getCollection(e).find(t||{})},e.prototype.aggregate=function(e,t,n){return this.getCollection(e).aggregate(t,n)},e.prototype.bulkWrite=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).bulkWrite(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.count=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).count(t||{},n)];case 1:return[2,r.sent()]}})})},e.prototype.createCollectionIndex=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).createIndex(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.createCollectionIndexes=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).createIndexes(t)];case 1:return[2,n.sent()]}})})},e.prototype.deleteMany=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).deleteMany(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.deleteOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).deleteOne(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.distinct=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).distinct(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.dropCollectionIndex=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).dropIndex(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.dropCollectionIndexes=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).dropIndexes()];case 1:return[2,t.sent()]}})})},e.prototype.findOneAndDelete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).findOneAndDelete(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.findOneAndReplace=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).findOneAndReplace(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.findOneAndUpdate=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).findOneAndUpdate(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.geoHaystackSearch=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).geoHaystackSearch(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.geoNear=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).geoNear(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.group=function(e,t,n,r,i,o,a,s){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(u){switch(u.label){case 0:return[4,this.getCollection(e).group(t,n,r,i,o,a,s)];case 1:return[2,u.sent()]}})})},e.prototype.collectionIndexes=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).indexes()];case 1:return[2,t.sent()]}})})},e.prototype.collectionIndexExists=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).indexExists(t)];case 1:return[2,n.sent()]}})})},e.prototype.collectionIndexInformation=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).indexInformation(t)];case 1:return[2,n.sent()]}})})},e.prototype.initializeOrderedBulkOp=function(e,t){return this.getCollection(e).initializeOrderedBulkOp(t)},e.prototype.initializeUnorderedBulkOp=function(e,t){return this.getCollection(e).initializeUnorderedBulkOp(t)},e.prototype.insertMany=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).insertMany(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.insertOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).insertOne(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.isCapped=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).isCapped()];case 1:return[2,t.sent()]}})})},e.prototype.listCollectionIndexes=function(e,t){return this.getCollection(e).listIndexes(t)},e.prototype.mapReduce=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).mapReduce(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.parallelCollectionScan=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).parallelCollectionScan(t)];case 1:return[2,n.sent()]}})})},e.prototype.reIndex=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).reIndex()];case 1:return[2,t.sent()]}})})},e.prototype.rename=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).rename(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.replaceOne=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).replaceOne(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.stats=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).stats(t)];case 1:return[2,n.sent()]}})})},e.prototype.updateMany=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).updateMany(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.updateOne=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).updateOne(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.databaseConnection.dropDatabase()];case 1:return e.sent(),[2]}})})},e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.query=function(e,t){throw new Error("Executing SQL query is not supported by MongoDB driver.")},e.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by MongoDB driver.")},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.databaseConnection.collection(e).insertOne(t)];case 1:return n=r.sent(),[2,n.insertedId]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.databaseConnection.collection(e).updateOne(n,t)];case 1:return r.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:if("string"==typeof t)throw new Error("String condition is not supported by MongoDB driver.");return[4,this.databaseConnection.collection(e).deleteOne(t)];case 1:return n.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.databaseConnection.dropCollection(e)];case 1:return t.sent(),[2]}})})},e.prototype.enableSqlMemory=function(){throw new Error("This operation is not supported by MongoDB driver.")},e.prototype.disableSqlMemory=function(){throw new Error("This operation is not supported by MongoDB driver.")},e.prototype.getMemorySql=function(){throw new Error("This operation is not supported by MongoDB driver.")},e.prototype.getCollection=function(e){return this.databaseConnection.collection(e)},e}(),e("MongoQueryRunner",n)}}}),System.register("typeorm/driver/error/DriverOptionNotSetError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="DriverOptionNotSetError",n.message="Driver option ("+t+") is not set. Please set it to perform connection to the database.",n}return __extends(t,e),t}(Error),e("DriverOptionNotSetError",n)}}}),System.register("typeorm/platform/PlatformTools",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){(n=function(){function e(){}return e.getGlobalVariable=function(){return window},e.load=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require("'+e+'").');return""},e.pathNormilize=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize("'+e+'").');return""},e.pathExtname=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname("'+e+'").');return""},e.pathResolve=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve("'+e+'").');return""},e.fileExist=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync("'+e+'").');return!1},e.getEnvVariable=function(e){},e}()).type="browser",e("PlatformTools",n)}}}),System.register("typeorm/metadata/types/TableTypes",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){(n=function(){return function(){}}()).REGULAR="regular",n.ABSTRACT="abstract",n.JUNCTION="junction",n.CLOSURE="closure",n.CLOSURE_JUNCTION="closure-junction",n.EMBEDDABLE="embeddable",n.SINGLE_TABLE_CHILD="single-table-child",n.CLASS_TABLE_CHILD="class-table-child",e("TableTypes",n)}}}),System.register("typeorm/decorator/options/JoinColumnOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/JoinTableMuplipleColumnsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchema",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/logger/LoggerOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/BaseConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/mongodb/MongoConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/types/MappedColumnTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/schema-builder/SchemaBuilder",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/schema-builder/MongoSchemaBuilder",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.build=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=this.connection.driver.createQueryRunner(),t=[],this.connection.entityMetadatas.forEach(function(n){n.indices.forEach(function(r){var i={name:r.name};t.push(e.createCollectionIndex(n.tableName,r.columnNamesWithOrderingMap,i))})}),[4,Promise.all(t)];case 1:return n.sent(),[2]}})})},e.prototype.log=function(){return Promise.resolve([])},e}(),e("MongoSchemaBuilder",n)}}}),System.register("typeorm/driver/mongodb/MongoDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/mongodb/MongoQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/platform/PlatformTools","typeorm/schema-builder/MongoSchemaBuilder"],function(e,t){"use strict";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e){this.connection=e,this.supportedDataTypes=[],this.mappedDataTypes={createDate:"int",createDateDefault:"",updateDate:"int",updateDateDefault:"",version:"int",treeLevel:"int",migrationName:"int",migrationTimestamp:"int"},this.options=e.options,this.validateOptions(e.options),this.loadDependencies()}return e.prototype.connect=function(){var e=this;return new Promise(function(t,n){e.mongodb.MongoClient.connect(e.buildConnectionUrl(),e.options.extra,function(r,o){if(r)return n(r);e.queryRunner=new i.MongoQueryRunner(e.connection,o),t()})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,r){if(!e.queryRunner)return r(new n.ConnectionIsNotSetError("mongodb"));e.queryRunner.databaseConnection.close(function(e){return e?r(e):t()}),e.queryRunner=void 0})]})})},e.prototype.createSchemaBuilder=function(){return new s.MongoSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(){return this.queryRunner},e.prototype.escapeQueryWithParameters=function(e,t){throw new Error("This operation is not supported by Mongodb driver.")},e.prototype.escape=function(e){return e},e.prototype.preparePersistentValue=function(e,t){return e},e.prototype.prepareHydratedValue=function(e,t){return e},e.prototype.normalizeType=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.normalizeDefault=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.validateOptions=function(e){if(!e.url&&!e.database)throw new o.DriverOptionNotSetError("database")},e.prototype.loadDependencies=function(){try{this.mongodb=a.PlatformTools.load("mongodb")}catch(e){throw new r.DriverPackageNotInstalledError("MongoDB","mongodb")}},e.prototype.buildConnectionUrl=function(){return this.options.url?this.options.url:"mongodb://"+(this.options.host||"127.0.0.1")+":"+(this.options.port||"27017")+"/"+this.options.database},e}(),e("MongoDriver",u)}}}),System.register("typeorm/query-builder/transformer/DocumentToEntityTransformer",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){void 0===e&&(e=!1),this.enableRelationIdValues=e}return e.prototype.transformAll=function(e,t){var n=this;return e.map(function(e){return n.transform(e,t)})},e.prototype.transform=function(e,t){var n=t.create(),r=!1;t.objectIdColumn&&e[t.objectIdColumn.databaseNameWithoutPrefixes]&&(n[t.objectIdColumn.propertyName]=e[t.objectIdColumn.databaseNameWithoutPrefixes],r=!0),this.enableRelationIdValues&&t.columns.filter(function(e){return!!e.relationMetadata}).forEach(function(t){var i=e[t.databaseNameWithoutPrefixes];void 0!==i&&null!==i&&t.propertyName&&(n[t.propertyName]=i,r=!0)}),t.ownColumns.forEach(function(t){var i=e[t.databaseNameWithoutPrefixes];void 0===i||null===i||!t.propertyName||t.isVirtual||t.isParentId||t.isDiscriminator||(n[t.propertyName]=i,r=!0)});var i=function(e,t,n){n.forEach(function(n){t[n.prefix]&&(n.isArray?e[n.propertyName]=t[n.prefix].map(function(e){var t=n.create();return n.columns.forEach(function(n){t[n.propertyName]=e[n.databaseNameWithoutPrefixes]}),t}):n.columns.forEach(function(r){var i=t[n.prefix][r.databaseNameWithoutPrefixes];i&&(e[n.propertyName]||(e[n.propertyName]=n.create()),e[n.propertyName][r.propertyName]=i)}),i(e[n.propertyName],t[n.prefix],n.embeddeds))})};return i(n,e,t.embeddeds),r?n:null},e}(),e("DocumentToEntityTransformer",n)}}}),System.register("typeorm/find-options/FindOptionsUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.isFindOneOptions=function(e){var t=e;return t&&(t.where instanceof Object||t.join instanceof Object||t.order instanceof Object)},e.isFindManyOptions=function(e){var t=e;return t&&(t.where instanceof Object||t.join instanceof Object||t.order instanceof Object||"number"==typeof t.skip||"number"==typeof t.take)},e.extractFindOneOptionsAlias=function(e){if(this.isFindOneOptions(e)&&e.join)return e.join.alias},e.extractFindManyOptionsAlias=function(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias},e.applyFindOneOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindOneOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?this.applyConditions(e,t):e},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?this.applyConditions(e,t):e},e.applyOptionsToQueryBuilder=function(e,t){return t&&this.isFindOneOptions(t)?(t.where&&this.applyConditions(e,t.where),t.skip&&e.skip(t.skip),t.take&&e.take(t.take),t.order&&Object.keys(t.order).forEach(function(n){e.addOrderBy(e.alias+"."+n,t.order[n])}),t.join&&(t.join.leftJoin&&Object.keys(t.join.leftJoin).forEach(function(n){e.leftJoin(t.join.leftJoin[n],n)}),t.join.innerJoin&&Object.keys(t.join.innerJoin).forEach(function(n){e.innerJoin(t.join.innerJoin[n],n)}),t.join.leftJoinAndSelect&&Object.keys(t.join.leftJoinAndSelect).forEach(function(n){e.leftJoinAndSelect(t.join.leftJoinAndSelect[n],n)}),t.join.innerJoinAndSelect&&Object.keys(t.join.innerJoinAndSelect).forEach(function(n){e.innerJoinAndSelect(t.join.innerJoinAndSelect[n],n)})),e):e},e.applyConditions=function(e,t){return Object.keys(t).forEach(function(n,r){if(null===t[n])e.andWhere(e.alias+"."+n+" IS NULL");else{var i="where_"+r;e.andWhere(e.alias+"."+n+"=:"+i).setParameter(i,t[n])}}),e},e}(),e("FindOptionsUtils",n)}}}),System.register("typeorm/entity-manager/MongoEntityManager",["typeorm/entity-manager/EntityManager","typeorm/query-builder/transformer/DocumentToEntityTransformer","typeorm/find-options/FindOptionsUtils"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.find=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(o){switch(o.label){case 0:return n=this.convertFindManyOptionsOrConditionsToMongodbQuery(t),[4,this.createEntityCursor(e,n)];case 1:return r=o.sent(),i.FindOptionsUtils.isFindManyOptions(t)&&(t.skip&&r.skip(t.skip),t.take&&r.limit(t.take),t.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(t.order))),[2,r.toArray()]}})})},t.prototype.findAndCount=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=this.convertFindManyOptionsOrConditionsToMongodbQuery(t),[4,this.createEntityCursor(e,n)];case 1:return r=u.sent(),i.FindOptionsUtils.isFindManyOptions(t)&&(t.skip&&r.skip(t.skip),t.take&&r.limit(t.take),t.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(t.order))),[4,Promise.all([r.toArray(),this.count(e,n)])];case 2:return o=u.sent(),a=o[0],s=o[1],[2,[a,parseInt(s)]]}})})},t.prototype.findByIds=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=this.connection.getMetadata(e),o=this.convertFindManyOptionsOrConditionsToMongodbQuery(n)||{},a=require("mongodb").ObjectID,o._id={$in:t.map(function(e){return e instanceof a?e:e[r.objectIdColumn.propertyName]})},[4,this.createEntityCursor(e,o)];case 1:return s=u.sent(),i.FindOptionsUtils.isFindManyOptions(n)&&(n.skip&&s.skip(n.skip),n.take&&s.limit(n.take),n.order&&s.sort(this.convertFindOptionsOrderToOrderCriteria(n.order))),[4,s.toArray()];case 2:return[2,u.sent()]}})})},t.prototype.findOne=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o;return __generator(this,function(a){switch(a.label){case 0:return n=this.convertFindOneOptionsOrConditionsToMongodbQuery(t),[4,this.createEntityCursor(e,n)];case 1:return r=a.sent(),i.FindOptionsUtils.isFindOneOptions(t)&&t.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(t.order)),[4,r.limit(1).toArray()];case 2:return o=a.sent(),[2,o.length>0?o[0]:void 0]}})})},t.prototype.findOneById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,o,a;return __generator(this,function(s){switch(s.label){case 0:return r=this.convertFindOneOptionsOrConditionsToMongodbQuery(n)||{},r._id=t,[4,this.createEntityCursor(e,r)];case 1:return o=s.sent(),i.FindOptionsUtils.isFindOneOptions(n)&&n.order&&o.sort(this.convertFindOptionsOrderToOrderCriteria(n.order)),[4,o.limit(1).toArray()];case 2:return a=s.sent(),[2,a.length>0?a[0]:void 0]}})})},t.prototype.createCursor=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.cursor(n.tableName,t)},t.prototype.createEntityCursor=function(e,t){var n=this.connection.getMetadata(e),i=this.createCursor(e,t),o=require("mongodb").Cursor;return i.toArray=function(e){if(!e)return o.prototype.toArray.call(this).then(function(e){return(new r.DocumentToEntityTransformer).transformAll(e,n)});o.prototype.toArray.call(this,function(t,i){if(!t){var o=new r.DocumentToEntityTransformer;return e(t,o.transformAll(i,n))}e(t,i)})},i.next=function(e){if(!e)return o.prototype.next.call(this).then(function(e){return e?(new r.DocumentToEntityTransformer).transform(e,n):e});o.prototype.next.call(this,function(t,i){if(!t&&i){var o=new r.DocumentToEntityTransformer;return e(t,o.transform(i,n))}e(t,i)})},i},t.prototype.aggregate=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.aggregate(r.tableName,t,n)},t.prototype.bulkWrite=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.bulkWrite(r.tableName,t,n)},t.prototype.count=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.count(r.tableName,t,n)},t.prototype.createCollectionIndex=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.createCollectionIndex(r.tableName,t,n)},t.prototype.createCollectionIndexes=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.createCollectionIndexes(n.tableName,t)},t.prototype.deleteMany=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.deleteMany(r.tableName,t,n)},t.prototype.deleteOne=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.deleteOne(r.tableName,t,n)},t.prototype.distinct=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.distinct(i.tableName,t,n,r)},t.prototype.dropCollectionIndex=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.dropCollectionIndex(r.tableName,t,n)},t.prototype.dropCollectionIndexes=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.dropCollectionIndexes(t.tableName)},t.prototype.findOneAndDelete=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.findOneAndDelete(r.tableName,t,n)},t.prototype.findOneAndReplace=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.findOneAndReplace(i.tableName,t,n,r)},t.prototype.findOneAndUpdate=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.findOneAndUpdate(i.tableName,t,n,r)},t.prototype.geoHaystackSearch=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.geoHaystackSearch(i.tableName,t,n,r)},t.prototype.geoNear=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.geoNear(i.tableName,t,n,r)},t.prototype.group=function(e,t,n,r,i,o,a,s){var u=this.connection.getMetadata(e);return this.queryRunner.group(u.tableName,t,n,r,i,o,a,s)},t.prototype.collectionIndexes=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.collectionIndexes(t.tableName)},t.prototype.collectionIndexExists=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.collectionIndexExists(n.tableName,t)},t.prototype.collectionIndexInformation=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.collectionIndexInformation(n.tableName,t)},t.prototype.initializeOrderedBulkOp=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.initializeOrderedBulkOp(n.tableName,t)},t.prototype.initializeUnorderedBulkOp=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.initializeUnorderedBulkOp(n.tableName,t)},t.prototype.insertMany=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.insertMany(r.tableName,t,n)},t.prototype.insertOne=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.insertOne(r.tableName,t,n)},t.prototype.isCapped=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.isCapped(t.tableName)},t.prototype.listCollectionIndexes=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.listCollectionIndexes(n.tableName,t)},t.prototype.mapReduce=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.mapReduce(i.tableName,t,n,r)},t.prototype.parallelCollectionScan=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.parallelCollectionScan(n.tableName,t)},t.prototype.reIndex=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.reIndex(t.tableName)},t.prototype.rename=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.rename(r.tableName,t,n)},t.prototype.replaceOne=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.replaceOne(i.tableName,t,n,r)},t.prototype.stats=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.stats(n.tableName,t)},t.prototype.updateMany=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.updateMany(i.tableName,t,n,r)},t.prototype.updateOne=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.updateOne(i.tableName,t,n,r)},Object.defineProperty(t.prototype,"queryRunner",{get:function(){return this.connection.driver.queryRunner},enumerable:!0,configurable:!0}),t.prototype.convertFindManyOptionsOrConditionsToMongodbQuery=function(e){if(e)return i.FindOptionsUtils.isFindManyOptions(e)?e.where:e},t.prototype.convertFindOneOptionsOrConditionsToMongodbQuery=function(e){if(e)return i.FindOptionsUtils.isFindOneOptions(e)?e.where:e},t.prototype.convertFindOptionsOrderToOrderCriteria=function(e){var t={};return Object.keys(e).forEach(function(n){return t[n]=[n,e[n].toLowerCase()]}),t},t}(n.EntityManager),e("MongoEntityManager",o)}}}),System.register("typeorm/repository/MongoRepository",["typeorm/repository/Repository"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.query=function(e,t){throw new Error("Queries aren't supported by MongoDB.")},t.prototype.createQueryBuilder=function(e,t){throw new Error("Query Builder is not supported by MongoDB.")},t.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},t.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},t.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},t.prototype.findOne=function(e){return this.manager.findOne(this.metadata.target,e)},t.prototype.findOneById=function(e,t){return this.manager.findOneById(this.metadata.target,e,t)},t.prototype.createCursor=function(e){return this.manager.createCursor(this.metadata.target,e)},t.prototype.createEntityCursor=function(e){return this.manager.createEntityCursor(this.metadata.target,e)},t.prototype.aggregate=function(e,t){return this.manager.aggregate(this.metadata.target,e,t)},t.prototype.bulkWrite=function(e,t){return this.manager.bulkWrite(this.metadata.target,e,t)},t.prototype.count=function(e,t){return this.manager.count(this.metadata.target,e||{},t)},t.prototype.createCollectionIndex=function(e,t){return this.manager.createCollectionIndex(this.metadata.target,e,t)},t.prototype.createCollectionIndexes=function(e){return this.manager.createCollectionIndexes(this.metadata.target,e)},t.prototype.deleteMany=function(e,t){return this.manager.deleteMany(this.metadata.tableName,e,t)},t.prototype.deleteOne=function(e,t){return this.manager.deleteOne(this.metadata.tableName,e,t)},t.prototype.distinct=function(e,t,n){return this.manager.distinct(this.metadata.tableName,e,t,n)},t.prototype.dropCollectionIndex=function(e,t){return this.manager.dropCollectionIndex(this.metadata.tableName,e,t)},t.prototype.dropCollectionIndexes=function(){return this.manager.dropCollectionIndexes(this.metadata.tableName)},t.prototype.findOneAndDelete=function(e,t){return this.manager.findOneAndDelete(this.metadata.tableName,e,t)},t.prototype.findOneAndReplace=function(e,t,n){return this.manager.findOneAndReplace(this.metadata.tableName,e,t,n)},t.prototype.findOneAndUpdate=function(e,t,n){return this.manager.findOneAndUpdate(this.metadata.tableName,e,t,n)},t.prototype.geoHaystackSearch=function(e,t,n){return this.manager.geoHaystackSearch(this.metadata.tableName,e,t,n)},t.prototype.geoNear=function(e,t,n){return this.manager.geoNear(this.metadata.tableName,e,t,n)},t.prototype.group=function(e,t,n,r,i,o,a){return this.manager.group(this.metadata.tableName,e,t,n,r,i,o,a)},t.prototype.collectionIndexes=function(){return this.manager.collectionIndexes(this.metadata.tableName)},t.prototype.collectionIndexExists=function(e){return this.manager.collectionIndexExists(this.metadata.tableName,e)},t.prototype.collectionIndexInformation=function(e){return this.manager.collectionIndexInformation(this.metadata.tableName,e)},t.prototype.initializeOrderedBulkOp=function(e){return this.manager.initializeOrderedBulkOp(this.metadata.tableName,e)},t.prototype.initializeUnorderedBulkOp=function(e){return this.manager.initializeUnorderedBulkOp(this.metadata.tableName,e)},t.prototype.insertMany=function(e,t){return this.manager.insertMany(this.metadata.tableName,e,t)},t.prototype.insertOne=function(e,t){return this.manager.insertOne(this.metadata.tableName,e,t)},t.prototype.isCapped=function(){return this.manager.isCapped(this.metadata.tableName)},t.prototype.listCollectionIndexes=function(e){return this.manager.listCollectionIndexes(this.metadata.tableName,e)},t.prototype.mapReduce=function(e,t,n){return this.manager.mapReduce(this.metadata.tableName,e,t,n)},t.prototype.parallelCollectionScan=function(e){return this.manager.parallelCollectionScan(this.metadata.tableName,e)},t.prototype.reIndex=function(){return this.manager.reIndex(this.metadata.tableName)},t.prototype.rename=function(e,t){return this.manager.rename(this.metadata.tableName,e,t)},t.prototype.replaceOne=function(e,t,n){return this.manager.replaceOne(this.metadata.tableName,e,t,n)},t.prototype.stats=function(e){return this.manager.stats(this.metadata.tableName,e)},t.prototype.updateMany=function(e,t,n){return this.manager.updateMany(this.metadata.tableName,e,t,n)},t.prototype.updateOne=function(e,t,n){return this.manager.updateOne(this.metadata.tableName,e,t,n)},t}(n.Repository),e("MongoRepository",r)}}}),System.register("typeorm/repository/TreeRepository",["typeorm/repository/Repository"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findTrees=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return[4,this.findRoots()];case 1:return e=n.sent(),[4,Promise.all(e.map(function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.findDescendantsTree(e)];case 1:return t.sent(),[2]}})})}))];case 2:return n.sent(),[2,e]}})})},t.prototype.findRoots=function(){var e=this.metadata.treeParentRelation.propertyName;return this.createQueryBuilder("treeEntity").where("treeEntity."+e+" IS NULL").getMany()},t.prototype.createDescendantsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)},o=function(e){return r.manager.connection.driver.escape(e)},a=i(e)+"."+o(this.metadata.primaryColumns[0].databaseName)+"="+i(t)+"."+o("descendant");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(i(t)+"."+o("ancestor")+"="+this.metadata.getEntityIdMap(n)[this.metadata.primaryColumns[0].propertyName])},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findDescendantsTree=function(e){var t=this;return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then(function(n){var r=t.createRelationMaps("treeEntity",n.raw);return t.buildChildrenEntityTree(e,n.entities,r),e})},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)},o=function(e){return r.manager.connection.driver.escape(e)},a=i(e)+"."+o(this.metadata.primaryColumns[0].databaseName)+"="+i(t)+"."+o("ancestor");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(i(t)+"."+o("descendant")+"="+this.metadata.getEntityIdMap(n)[this.metadata.primaryColumns[0].propertyName])},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findAncestorsTree=function(e){var t=this;return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then(function(n){var r=t.createRelationMaps("treeEntity",n.raw);return t.buildParentEntityTree(e,n.entities,r),e})},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createRelationMaps=function(e,t){var n=this;return t.map(function(t){return{id:t[e+"_"+n.metadata.primaryColumns[0].databaseName],parentId:t[e+"_"+n.metadata.treeParentRelation.joinColumns[0].referencedColumn.databaseName]}})},t.prototype.buildChildrenEntityTree=function(e,t,n){var r=this,i=this.metadata.treeChildrenRelation.propertyName,o=this.metadata.primaryColumns[0].getEntityValue(e),a=n.filter(function(e){return e.parentId===o}).map(function(e){return e.id});e[i]=t.filter(function(e){return-1!==a.indexOf(r.metadata.primaryColumns[0].getEntityValue(e))}),e[i].forEach(function(e){r.buildChildrenEntityTree(e,t,n)})},t.prototype.buildParentEntityTree=function(e,t,n){var r=this,i=this.metadata.treeParentRelation.propertyName,o=this.metadata.primaryColumns[0].getEntityValue(e),a=n.find(function(e){return e.id===o}),s=t.find(function(e){return!!a&&e[r.metadata.primaryColumns[0].propertyName]===a.parentId});s&&(e[i]=s,this.buildParentEntityTree(e[i],t,n))},t}(n.Repository),e("TreeRepository",r)}}}),System.register("typeorm/util/DateUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.normalizeHydratedDate=function(e){if(!e)return e;var t="string"==typeof e?new Date(e):e,n=new Date;return n.setUTCFullYear(t.getFullYear(),t.getMonth(),t.getDate()),n.setUTCHours(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),n},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToTimeString=function(e){return e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds()):e},e.mixedTimeToString=function(e){return e=e instanceof Date?e.getHours()+":"+e.getMinutes()+":"+e.getSeconds():e,"string"==typeof e?e.split(":").map(function(e){return 1===e.length?"0"+e:e}).join(":"):e},e.mixedDateToDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds()):e},e.mixedDateToUtcDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear())+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds()):e},e.simpleArrayToString=function(e){return e instanceof Array?e.map(function(e){return String(e)}).join(","):e},e.stringToSimpleArray=function(e){return e instanceof String||"string"==typeof e?e.split(","):e},e.formatZerolessValue=function(e){return e<10?"0"+e:String(e)},e}(),e("DateUtils",n)}}}),System.register("typeorm/persistence/Subject",["typeorm/util/DateUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n){this.date=new Date,this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.diffColumns=[],this.diffRelations=[],this.relationUpdates=[],this.junctionInserts=[],this.junctionRemoves=[],this.metadata=e,this._persistEntity=t,this._databaseEntity=n}return Object.defineProperty(e.prototype,"entity",{get:function(){if(!this._persistEntity)throw new Error("Persistence entity is not set for the given subject.");return this._persistEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasEntity",{get:function(){return!!this._persistEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"databaseEntity",{get:function(){if(!this._databaseEntity)throw new Error("Database entity is not set for the given subject.");return this._databaseEntity},set:function(e){this._databaseEntity=e,this.recompute()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasDatabaseEntity",{get:function(){return!!this._databaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityTarget",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeInserted",{get:function(){return this.canBeInserted&&!this.hasDatabaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeUpdated",{get:function(){return this.canBeUpdated&&(this.diffColumns.length>0||this.diffRelations.length>0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRelationUpdates",{get:function(){return this.relationUpdates.length>0},enumerable:!0,configurable:!0}),e.prototype.validate=function(){if(this.mustBeInserted&&this.mustBeRemoved)throw new Error("Removed entity "+this.metadata.name+" is also scheduled for insert operation. This looks like ORM problem. Please report a github issue.");if(this.mustBeUpdated&&this.mustBeRemoved)throw new Error('Removed entity "'+this.metadata.name+'" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).');if(this.mustBeInserted&&this.mustBeUpdated)throw new Error("Inserted entity "+this.metadata.name+" is also scheduled for updated operation. This looks like ORM problem. Please report a github issue.")},e.prototype.recompute=function(){this.hasEntity&&this._databaseEntity&&(this.computeDiffColumns(),this.computeDiffRelationalColumns())},e.prototype.computeDiffColumns=function(){var e=this;this.diffColumns=this.metadata.columns.filter(function(t){var r=t.getEntityValue(e.entity),i=t.getEntityValue(e.databaseEntity);if(void 0===r)return!1;if(null!==r&&void 0!==r&&("date"===t.type?r=n.DateUtils.mixedDateToDateString(r):"time"===t.type?r=n.DateUtils.mixedDateToTimeString(r):"datetime"===t.type||t.type===Date?(r=n.DateUtils.mixedDateToUtcDatetimeString(r),i=n.DateUtils.mixedDateToUtcDatetimeString(i)):"json"===t.type||"jsonb"===t.type||t.type===Object?(r=JSON.stringify(r),null!==i&&void 0!==i&&(i=JSON.stringify(i))):"sample-array"===t.type&&(r=n.DateUtils.simpleArrayToString(r),i=n.DateUtils.simpleArrayToString(i))),t.isVirtual||t.isParentId||t.isDiscriminator||t.isUpdateDate||t.isVersion||t.isCreateDate||r===i)return!1;var o=e.metadata.findRelationWithDbName(t.databaseName);if(o){var a=o.getEntityValue(e.entity);if(null!==a&&void 0!==a)return!1}return!0})},e.prototype.computeDiffRelationalColumns=function(){var e=this;this.diffRelations=this.metadata.relations.filter(function(t){if(!(t.isManyToOne||t.isOneToOne&&t.isOwning))return!1;var n=t.getEntityValue(e.entity),r=n instanceof Object?t.inverseEntityMetadata.getEntityIdMixedMap(n):n,i=t.getEntityValue(e.databaseEntity);return void 0!==r&&((void 0!==r&&null!==r||void 0!==i&&null!==i)&&r!==i)})},e}(),e("Subject",r)}}}),System.register("typeorm/persistence/SubjectBuilder",["typeorm/persistence/Subject","typeorm/driver/mongodb/MongoDriver","typeorm/util/OrmUtils"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(e,t){this.connection=e,this.queryRunner=t,this.operateSubjects=[]}return e.prototype.persist=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=new n.Subject(t,e),r.canBeInserted=!0,r.canBeUpdated=!0,this.operateSubjects.push(r),this.buildCascadeUpdateAndInsertOperateSubjects(r),[4,this.loadOperateSubjectsDatabaseEntities()];case 1:return a.sent(),i=this.operateSubjects.filter(function(e){return e.hasDatabaseEntity}),[4,Promise.all(i.map(function(e){return o.buildCascadeRemovedAndRelationUpdateOperateSubjects(e)}))];case 2:return a.sent(),[4,this.buildJunctionOperations({insert:!0,remove:!0})];case 3:return a.sent(),[2]}})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=new n.Subject(t,e),r.mustBeRemoved=!0,this.operateSubjects.push(r),this.buildCascadeRemoveOperateSubjects(r),[4,this.loadOperateSubjectsDatabaseEntities()];case 1:return a.sent(),i=this.operateSubjects.filter(function(e){return e.hasDatabaseEntity}),[4,Promise.all(i.map(function(e){return o.buildCascadeRemovedAndRelationUpdateOperateSubjects(e)}))];case 2:return a.sent(),[4,this.buildJunctionOperations({insert:!1,remove:!0})];case 3:return a.sent(),[2]}})})},e.prototype.buildCascadeUpdateAndInsertOperateSubjects=function(e){var t=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).filter(function(e){var t=e[0],n=e[1];e[2];return void 0!==n&&null!==n&&(t.isCascadeInsert||t.isCascadeUpdate)}).forEach(function(e){var r=e[0],i=e[1],o=e[2],a=t.findByEntityLike(o.target,i);if(a)return!1===a.canBeInserted&&(a.canBeInserted=!0===r.isCascadeInsert),void(!1===a.canBeUpdated&&(a.canBeUpdated=!0===r.isCascadeUpdate));var s=new n.Subject(o,i);s.canBeInserted=!0===r.isCascadeInsert,s.canBeUpdated=!0===r.isCascadeUpdate,t.operateSubjects.push(s),t.buildCascadeUpdateAndInsertOperateSubjects(s)})},e.prototype.buildCascadeRemoveOperateSubjects=function(e){var t=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).filter(function(e){var t=e[0],n=e[1];e[2];return void 0!==n&&null!==n&&t.isCascadeRemove}).forEach(function(e){e[0];var r=e[1],i=e[2],o=t.findByEntityLike(i.target,r);if(o)o.mustBeRemoved=!0;else{var a=new n.Subject(i,r);a.mustBeRemoved=!0,t.operateSubjects.push(a),t.buildCascadeRemoveOperateSubjects(a)}})},e.prototype.loadOperateSubjectsDatabaseEntities=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=this.groupByEntityTargets().map(function(e){return __awaiter(t,void 0,void 0,function(){var t,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.subjects.filter(function(e){return!e.hasDatabaseEntity}).filter(function(e){return!e.metadata.isEntityMapEmpty(e.entity)}).map(function(e){return e.metadata.getEntityIdMap(e.entity)}),t.length?this.connection.driver instanceof r.MongoDriver?[4,this.connection.getMongoRepository(e.target).findByIds(t)]:[3,2]:[2];case 1:return n=o.sent(),[3,4];case 2:return[4,this.connection.getRepository(e.target).createQueryBuilder("operateSubject",this.queryRunner).whereInIds(t).loadAllRelationIds().getMany()];case 3:n=o.sent(),o.label=4;case 4:return n.forEach(function(t){var n=i.findByEntityLike(e.target,t);n&&(n.databaseEntity=t)}),[2]}})})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.buildCascadeRemovedAndRelationUpdateOperateSubjects=function(e){return __awaiter(this,void 0,void 0,function(){var t,r=this;return __generator(this,function(i){switch(i.label){case 0:return t=e.metadata.relations.map(function(t){return __awaiter(r,void 0,void 0,function(){var r,i,o,a,s,u,c,l,d,p,m,f,y,h,g,v,b,E,_,N,C,T,M,w,R=this;return __generator(this,function(S){switch(S.label){case 0:return r=t.inverseEntityMetadata,i=r.tableName,e.hasDatabaseEntity?t.isOneToOneOwner||t.isManyToOne?t.isCascadeRemove?null===(o=t.getEntityValue(e.databaseEntity))||void 0===o?[2]:(c=void 0,a=void 0,e.hasEntity&&(null===(a=t.getEntityValue(e.entity))&&(c=null),a&&(c=t.joinColumns.reduce(function(e,t){return t.referencedColumn.getEntityValueMap(a)},{})),void 0===c)?[2]:null!==c&&t.entityMetadata.compareIds(o,a)?[2]:(p=this.operateSubjects.find(function(e){return!(!e.hasDatabaseEntity||e.entityTarget!==r.target)&&t.entityMetadata.compareIds(o,t.getEntityValue(e.databaseEntity))}))?[3,2]:(s=this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).loadAllRelationIds(),u=t.joinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+" = :"+e.databaseName}).join(" AND "),C=t.joinColumns.reduce(function(e,t){return e[t.databaseName]=t.referencedColumn.getEntityValue(o),e},{}),s.where(u).setParameters(C),[4,s.getOne()])):[2]:[3,4]:[2];case 1:(m=S.sent())&&(p=new n.Subject(r,void 0,m),this.operateSubjects.push(p)),S.label=2;case 2:return p?p.mustBeRemoved?[2]:(p.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(p)]):[3,4];case 3:S.sent(),S.label=4;case 4:return t.isOneToOneNotOwner?t.isCascadeRemove?(c=void 0,e.hasEntity&&!e.mustBeRemoved&&((l=t.getEntityValue(e.entity))&&(c=t.inverseRelation.getEntityValue(l)),void 0===c)?[2]:null===(d=t.inverseRelation.joinColumns[0].referencedColumn.getEntityValue(e.databaseEntity))||void 0===d?[2]:(p=this.operateSubjects.find(function(e){return!(!e.hasDatabaseEntity||e.entityTarget!==r.target)&&t.inverseRelation.getEntityValue(e.databaseEntity)===d}),p?[3,6]:[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).where(i+"."+t.inverseSidePropertyPath+"=:id").setParameter("id",d).loadAllRelationIds().getOne()])):[2]:[3,8];case 5:m=S.sent(),p=new n.Subject(r,void 0,m),this.operateSubjects.push(p),S.label=6;case 6:return p&&p.hasDatabaseEntity?(f=t.inverseRelation.getEntityValue(p.databaseEntity),c&&c===f?[2]:p.mustBeRemoved?[2]:(p.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(p)])):[3,8];case 7:S.sent(),S.label=8;case 8:return t.isOneToMany||t.isManyToMany?(y=void 0,e.hasEntity&&void 0===(y=t.getEntityValue(e.entity))?[2]:(h=[],g=function(e){return R.connection.driver.escape(e)},t.isManyToManyOwner?t.isCascadeRemove?(v=g("persistenceJoinedRelation"),E=t.joinColumns.map(function(e){return v+"."+e.propertyName+" = :"+e.propertyName}),_=t.inverseJoinColumns.map(function(e){return v+"."+e.propertyName+" = "+g(i)+"."+g(e.referencedColumn.propertyName)}),N=E.concat(_).join(" AND "),C=t.joinColumns.reduce(function(t,n){return t[n.propertyName]=n.referencedColumn.getEntityValue(e.databaseEntity),t},{}),[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).innerJoin(t.junctionEntityMetadata.tableName,v,N).setParameters(C).loadAllRelationIds().getMany()]):[2]:[3,10])):[3,18];case 9:return h=S.sent(),[3,14];case 10:return t.isManyToManyNotOwner?t.isCascadeRemove?(b=g("persistenceJoinedRelation"),E=t.joinColumns.map(function(e){return b+"."+e.propertyName+" = "+g(i)+"."+g(e.referencedColumn.propertyName)}),_=t.inverseJoinColumns.map(function(e){return b+"."+e.propertyName+" = :"+e.propertyName}),N=E.concat(_).join(" AND "),C=t.inverseRelation.inverseJoinColumns.reduce(function(t,n){return t[n.propertyName]=n.referencedColumn.getEntityValue(e.databaseEntity),t},{}),[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).innerJoin(t.junctionEntityMetadata.tableName,b,N).setParameters(C).loadAllRelationIds().getMany()]):[2]:[3,12];case 11:return h=S.sent(),[3,14];case 12:return T=t.inverseRelation.joinColumns[0].referencedColumn.getEntityValue(e.databaseEntity),[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).where(i+"."+t.inverseSidePropertyPath+"=:id").setParameter("id",T).loadAllRelationIds().getMany()];case 13:h=S.sent(),S.label=14;case 14:return h.forEach(function(e){var t=R.findByEntityLike(r.target,e);if(t&&!t.hasDatabaseEntity)t.databaseEntity=e;else if(!t){var i=new n.Subject(r,void 0,e);R.operateSubjects.push(i)}}),t.isOneToMany&&y?(M=y.map(function(o){return __awaiter(R,void 0,void 0,function(){var a,s,u,c;return __generator(this,function(l){switch(l.label){case 0:return(a=h.find(function(e){return r.compareEntities(o,e)}))?[3,3]:(s=this.findByDatabaseEntityLike(r.target,o))?[3,2]:(u=r.getEntityIdMap(o),u?[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).whereInIds([u]).loadAllRelationIds().getOne()]:[3,2]);case 1:(c=l.sent())&&(s=new n.Subject(r,void 0,c),this.operateSubjects.push(s)),l.label=2;case 2:s&&s.relationUpdates.push({relation:t.inverseRelation,value:e.entity}),l.label=3;case 3:return[2]}})})}),[4,Promise.all(M)]):[3,16];case 15:S.sent(),S.label=16;case 16:return w=h.map(function(e){return __awaiter(R,void 0,void 0,function(){var n,i;return __generator(this,function(o){switch(o.label){case 0:return(n=this.findByDatabaseEntityLike(r.target,e))?n.mustBeRemoved?[2]:(i=(y||[]).find(function(e){return r.compareEntities(n.databaseEntity,e)}),null!==y&&i?[3,3]:t.isCascadeRemove?(n.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(n)]):[3,2]):[2];case 1:return o.sent(),[3,3];case 2:t.isOneToMany&&t.inverseRelation&&n.relationUpdates.push({relation:t.inverseRelation,value:null}),o.label=3;case 3:return[2]}})})}),[4,Promise.all(w)];case 17:S.sent(),S.label=18;case 18:return[2]}})})}),[4,Promise.all(t)];case 1:return i.sent(),[2]}})})},e.prototype.buildJunctionOperations=function(e){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(r){switch(r.label){case 0:return t=this.operateSubjects.filter(function(e){return e.hasEntity}).map(function(t){var r=(t.metadata.parentEntityMetadata?t.metadata.parentEntityMetadata:t.metadata).manyToManyRelations.map(function(r){return __awaiter(n,void 0,void 0,function(){var n,o,a,s,u,c;return __generator(this,function(l){return t.mustBeRemoved&&e.remove?((n=r.getEntityValue(t.databaseEntity)).length>0&&t.junctionRemoves.push({relation:r,junctionRelationIds:n}),[2]):t.hasEntity&&(o=r.getEntityValue(t.entity))instanceof Array?(a=[],t.hasDatabaseEntity&&(a=r.getEntityValue(t.databaseEntity)),s=o.map(function(e){return(r.isOwning?r.inverseJoinColumns:r.inverseRelation.joinColumns).reduce(function(t,n){return i.OrmUtils.mergeDeep(t,n.referencedColumn.createValueMap(n.referencedColumn.getEntityValue(e)))},{})}).filter(function(e){return void 0!==e&&null!==e}),u=a.filter(function(e){return!s.find(function(t){return r.inverseEntityMetadata.compareIds(t,e)})}),(c=o.filter(function(e){var t=(r.isOwning?r.inverseJoinColumns:r.inverseRelation.joinColumns).reduce(function(t,n){return i.OrmUtils.mergeDeep(t,n.referencedColumn.createValueMap(n.referencedColumn.getEntityValue(e)))},{});return!a.find(function(e){return r.inverseEntityMetadata.compareIds(e,t)})})).length>0&&e.insert&&t.junctionInserts.push({relation:r,junctionEntities:c}),u.length>0&&e.remove&&t.junctionRemoves.push({relation:r,junctionRelationIds:u}),[2]):[2]})})});return Promise.all(r)}),[4,Promise.all(t)];case 1:return r.sent(),[2]}})})},e.prototype.findByEntityLike=function(e,t){return this.operateSubjects.find(function(n){return!!n.hasEntity&&(n.entity===t||n.entityTarget===e&&n.metadata.compareEntities(n.entity,t))})},e.prototype.findByDatabaseEntityLike=function(e,t){return this.operateSubjects.find(function(n){return!!n.hasDatabaseEntity&&(n.entityTarget===e&&n.metadata.compareEntities(n.databaseEntity,t))})},e.prototype.groupByEntityTargets=function(){return this.operateSubjects.reduce(function(e,t){var n=e.find(function(e){return e.target===t.entityTarget});return n||(n={target:t.entityTarget,subjects:[]},e.push(n)),n.subjects.push(t),e},[])},e}(),e("SubjectBuilder",o)}}}),System.register("typeorm/util/PromiseUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.runInSequence=function(e,t){var n=[];return e.reduce(function(e,r){return e.then(function(){return t(r)}).then(function(e){n.push(e)})},Promise.resolve()).then(function(){return n})},e}(),e("PromiseUtils",n)}}}),System.register("typeorm/subscriber/event/UpdateEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/event/RemoveEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/event/InsertEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/EntitySubscriberInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/EventListenerTypes",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){(n=function(){return function(){}}()).AFTER_LOAD="after-load",n.BEFORE_INSERT="before-insert",n.AFTER_INSERT="after-insert",n.BEFORE_UPDATE="before-update",n.AFTER_UPDATE="after-update",n.BEFORE_REMOVE="before-remove",n.AFTER_REMOVE="after-remove",e("EventListenerTypes",n)}}}),System.register("typeorm/metadata-args/EntityListenerMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/EntityListenerMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.target=e.target,this.propertyName=e.propertyName,this.type=e.type}return e.prototype.isAllowed=function(e){return this.target===e.constructor||this.target instanceof Function&&e.constructor.prototype instanceof this.target},e}(),e("EntityListenerMetadata",n)}}}),System.register("typeorm/subscriber/Broadcaster",["typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.connection=e}return e.prototype.broadcastBeforeEventsForAll=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return i=t.map(function(t){return u.broadcastBeforeInsertEvent(e,t)}),o=n.map(function(t){return u.broadcastBeforeUpdateEvent(e,t)}),a=r.map(function(t){return u.broadcastBeforeRemoveEvent(e,t)}),s=i.concat(o).concat(a),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.broadcastAfterEventsForAll=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return i=t.map(function(t){return u.broadcastAfterInsertEvent(e,t)}),o=n.map(function(t){return u.broadcastAfterUpdateEvent(e,t)}),a=r.map(function(t){return u.broadcastAfterRemoveEvent(e,t)}),s=i.concat(o).concat(a),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.broadcastBeforeInsertEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_INSERT&&e.isAllowed(t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeInsert}).map(function(n){return n.beforeInsert({manager:e,entity:t.entity})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastBeforeUpdateEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_UPDATE&&e.isAllowed(t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeUpdate}).map(function(n){return n.beforeUpdate({manager:e,entity:t.entity,databaseEntity:t.databaseEntity,updatedColumns:t.diffColumns,updatedRelations:t.diffRelations})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastBeforeRemoveEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_REMOVE&&e.isAllowed(t.entity)}).map(function(e){return t.databaseEntity[e.propertyName]()}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeRemove}).map(function(n){return n.beforeRemove({manager:e,entity:t.hasEntity?t.entity:void 0,databaseEntity:t.databaseEntity,entityId:t.metadata.getEntityIdMixedMap(t.databaseEntity)})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterInsertEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_INSERT&&e.isAllowed(t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterInsert}).map(function(n){return n.afterInsert({manager:e,entity:t.entity})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterUpdateEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_UPDATE&&e.isAllowed(t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterUpdate}).map(function(n){return n.afterUpdate({manager:e,entity:t.entity,databaseEntity:t.databaseEntity,updatedColumns:t.diffColumns,updatedRelations:t.diffRelations})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterRemoveEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_REMOVE&&e.isAllowed(t.entity)}).map(function(e){return t.entity[e.propertyName]()}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterRemove}).map(function(n){return n.afterRemove({manager:e,entity:t.hasEntity?t.entity:void 0,databaseEntity:t.databaseEntity,entityId:t.metadata.getEntityIdMixedMap(t.databaseEntity)})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastLoadEventsForAll=function(e,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.broadcastLoadEvents(e,t)}))];case 1:return r.sent(),[2]}})})},e.prototype.broadcastLoadEvents=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t instanceof Promise?[2]:(r=this.connection.getMetadata(e).relations.reduce(function(e,n){if(!t.hasOwnProperty(n.propertyName))return e;var r=n.getEntityValue(t);return r instanceof Array?e=e.concat(a.broadcastLoadEventsForAll(n.inverseEntityMetadata.target,r)):r&&e.push(a.broadcastLoadEvents(n.inverseEntityMetadata.target,r)),e},[]),i=this.connection.getMetadata(e).listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_LOAD&&e.isAllowed(t)}).map(function(e){return t[e.propertyName]()}),o=this.connection.subscribers.filter(function(t){return a.isAllowedSubscriber(t,e)&&t.afterLoad}).map(function(e){return e.afterLoad(t)}),[4,Promise.all(r.concat(i.concat(o)))]);case 1:return s.sent(),[2]}})})},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t},e}(),e("Broadcaster",r)}}}),System.register("typeorm/persistence/SubjectOperationExecutor",["typeorm/util/OrmUtils","typeorm/util/PromiseUtils","typeorm/driver/mongodb/MongoDriver","typeorm/subscriber/Broadcaster"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e,t,n){this.connection=e,this.transactionEntityManager=t,this.queryRunner=n}return e.prototype.execute=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(a){switch(a.label){case 0:if(e.forEach(function(e){return e.validate()}),this.allSubjects=e,this.insertSubjects=e.filter(function(e){return e.mustBeInserted}),this.updateSubjects=e.filter(function(e){return e.mustBeUpdated}),this.removeSubjects=e.filter(function(e){return e.mustBeRemoved}),this.relationUpdateSubjects=e.filter(function(e){return e.hasRelationUpdates}),!this.insertSubjects.length&&!this.updateSubjects.length&&!this.removeSubjects.length&&!this.relationUpdateSubjects.length&&e.every(function(e){return!e.junctionInserts.length})&&e.every(function(e){return!e.junctionRemoves.length}))return[2];t=!1,a.label=1;case 1:return a.trys.push([1,16,,21]),this.queryRunner.isTransactionActive?[3,3]:(t=!0,[4,this.queryRunner.startTransaction()]);case 2:a.sent(),a.label=3;case 3:return n=new o.Broadcaster(this.connection),[4,n.broadcastBeforeEventsForAll(this.transactionEntityManager,this.insertSubjects,this.updateSubjects,this.removeSubjects)];case 4:return a.sent(),this.updateSubjects.forEach(function(e){return e.recompute()}),[4,this.executeInsertOperations()];case 5:return a.sent(),[4,this.executeInsertClosureTableOperations()];case 6:return a.sent(),[4,this.executeInsertJunctionsOperations()];case 7:return a.sent(),[4,this.executeRemoveJunctionsOperations()];case 8:return a.sent(),[4,this.executeUpdateOperations()];case 9:return a.sent(),[4,this.executeUpdateRelations()];case 10:return a.sent(),[4,this.executeRemoveOperations()];case 11:return a.sent(),!0!==t?[3,13]:[4,this.queryRunner.commitTransaction()];case 12:a.sent(),a.label=13;case 13:return[4,this.updateSpecialColumnsInPersistedEntities()];case 14:return a.sent(),[4,n.broadcastAfterEventsForAll(this.transactionEntityManager,this.insertSubjects,this.updateSubjects,this.removeSubjects)];case 15:return a.sent(),[3,21];case 16:if(r=a.sent(),!t)return[3,20];a.label=17;case 17:return a.trys.push([17,19,,20]),[4,this.queryRunner.rollbackTransaction()];case 18:return a.sent(),[3,20];case 19:return i=a.sent(),[3,20];case 20:throw r;case 21:return[2]}})})},e.prototype.executeInsertOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return e=this.insertSubjects.filter(function(e){return!e.metadata.hasNonNullableRelations}),t=this.insertSubjects.filter(function(e){return e.metadata.hasNonNullableRelations}),[4,Promise.all(e.map(function(e){return r.insert(e,[])}))];case 1:return i.sent(),[4,Promise.all(t.map(function(t){return r.insert(t,e)}))];case 2:return i.sent(),n=[],e.forEach(function(e){var t={};if(e.metadata.relationsWithJoinColumns.forEach(function(n){n.joinColumns.forEach(function(i){var o=i.referencedColumn,a=n.getEntityValue(e.entity);if(a){var s,u=n.inverseEntityMetadata.findRelationWithPropertyPath(i.referencedColumn.propertyPath);if(u)(c=r.insertSubjects.find(function(e){return e.entity===o.getEntityValue(a)}))&&((s=u.getEntityValue(o.getEntityValue(a)))||(o.isGenerated?s=c.newlyGeneratedId:o.isObjectId&&(s=c.generatedObjectId)));else{var c=r.insertSubjects.find(function(e){return e.entity===a});c&&((s=o.getEntityValue(a))||(o.isGenerated?s=c.newlyGeneratedId:o.isObjectId&&(s=c.generatedObjectId)))}s&&(t[i.databaseName]=s)}})}),Object.keys(t).length>0){var i={};if((e.metadata.parentEntityMetadata,e.metadata.primaryColumns).forEach(function(t){var n=t.getEntityValue(e.entity),o=e.metadata.relations.find(function(e){return e.propertyName===t.propertyName});n&&o?o.joinColumns.forEach(function(e){var o=n[e.referencedColumn.propertyName];if(!o){var a=r.insertSubjects.find(function(e){return e.entity===n});a&&(e.referencedColumn.isGenerated?o=a.newlyGeneratedId:e.referencedColumn.isObjectId&&(o=a.generatedObjectId))}o&&(i[t.databaseName]=o)}):n?i[t.databaseName]=n:e.newlyGeneratedId?i[t.databaseName]=e.newlyGeneratedId:e.generatedObjectId&&(i[t.databaseName]=e.generatedObjectId)}),!Object.keys(i).length)return;var o=r.queryRunner.update(e.metadata.tableName,t,i);n.push(o)}var a=e.metadata.oneToManyRelations.concat(e.metadata.oneToOneRelations.filter(function(e){return!e.isOwning}));e.metadata.extractRelationValuesFromEntity(e.entity,a).forEach(function(t){var i=t[0],o=t[1],a=t[2];i.inverseRelation.joinColumns.forEach(function(t){var s=t.referencedColumn,u={};if((a.parentEntityMetadata,a.primaryColumns).forEach(function(e){var t=e.getEntityValue(o),n=a.relations.find(function(t){return t.propertyName===e.propertyName});if(t&&n)n.joinColumns.forEach(function(n){var i=t[n.referencedColumn.propertyName];if(!i){var o=r.insertSubjects.find(function(e){return e.entity===t});o&&(n.referencedColumn.isGenerated?i=o.newlyGeneratedId:n.referencedColumn.isObjectId&&(i=o.generatedObjectId))}i&&(u[e.databaseName]=i)});else{var i=r.insertSubjects.find(function(e){return e.entity===o});t?u[e.databaseName]=t:i&&i.newlyGeneratedId?u[e.databaseName]=i.newlyGeneratedId:i&&i.generatedObjectId&&(u[e.databaseName]=i.generatedObjectId)}}),Object.keys(u).length){var c={},l=i.inverseEntityMetadata.relations.find(function(e){return e.propertyName===s.propertyName}),d=s.getEntityValue(e.entity);if(l){var p=l.getEntityValue(d);if(!p){var m=r.insertSubjects.find(function(e){return e.entity===d});m&&(m.newlyGeneratedId?p=m.newlyGeneratedId:m.generatedObjectId&&(p=m.generatedObjectId))}c[t.databaseName]=p}else c[t.databaseName]=d||e.newlyGeneratedId||o.generatedObjectId;var f=r.queryRunner.update(i.inverseEntityMetadata.tableName,c,u);n.push(f)}})})}),[4,Promise.all(n)];case 3:return i.sent(),[2]}})})},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l;return __generator(this,function(d){switch(d.label){case 0:return n=e.metadata.parentEntityMetadata,r=e.metadata,i=e.entity,r.isClassTableChild?(s=this.collectColumnsAndValues(n,i,e.date,void 0,r.discriminatorValue,t),[4,this.queryRunner.insert(n.tableName,s,n.generatedColumn)]):[3,3];case 1:return o=a=d.sent(),u=this.collectColumnsAndValues(r,i,e.date,o,void 0,t),[4,this.queryRunner.insert(r.tableName,u,r.generatedColumn)];case 2:return c=d.sent(),!o&&c&&(o=c),[3,5];case 3:return l=this.collectColumnsAndValues(r,i,e.date,void 0,void 0,t),[4,this.queryRunner.insert(r.tableName,l,r.generatedColumn)];case 4:o=d.sent(),d.label=5;case 5:return a&&(e.parentGeneratedId=a),o&&(r.generatedColumn?e.newlyGeneratedId=o:r.objectIdColumn&&(e.generatedObjectId=o)),[2]}})})},e.prototype.collectColumns=function(e,t,n){var r=this;e.forEach(function(e){if(!(e.isVirtual||e.isParentId||e.isDiscriminator)){var i=t[e.propertyName];void 0!==i&&(n[e.databaseNameWithoutPrefixes]=r.connection.driver.preparePersistentValue(i,e))}})},e.prototype.collectEmbeds=function(e,t,n){var r=this;e.isArray?t[e.propertyName]instanceof Array&&(n[e.prefix]||(n[e.prefix]=[]),t[e.propertyName].forEach(function(t,i){n[e.prefix][i]||(n[e.prefix][i]={}),r.collectColumns(e.columns,t,n[e.prefix][i]),e.embeddeds.forEach(function(o){return r.collectEmbeds(o,t,n[e.prefix][i])})})):void 0!==t[e.propertyName]&&(n[e.prefix]||(n[e.prefix]={}),this.collectColumns(e.columns,t[e.propertyName],n[e.prefix]),e.embeddeds.forEach(function(i){return r.collectEmbeds(i,t[e.propertyName],n[e.prefix])}))},e.prototype.collectColumnsAndValues=function(e,t,n,r,o,a){var s=this,u={};if(this.connection.driver instanceof i.MongoDriver?(this.collectColumns(e.ownColumns,t,u),e.embeddeds.forEach(function(e){return s.collectEmbeds(e,t,u)})):e.columns.forEach(function(e){if(!(e.isVirtual||e.isParentId||e.isDiscriminator)){var n=e.getEntityValue(t);null!==n&&void 0!==n&&(u[e.databaseName]=s.connection.driver.preparePersistentValue(n,e))}}),e.relationsWithJoinColumns.forEach(function(e){e.joinColumns.forEach(function(n){var r,i=e.getEntityValue(t);if(i){var o=n.referencedColumn.getEntityValue(i);o&&(r=o);var c=a.find(function(e){return e.entity===i});if(c){var l=n.referencedColumn;l.referencedColumn&&l.referencedColumn.isGenerated&&l.isParentId&&(r=c.parentGeneratedId),l.isGenerated&&(r=c.newlyGeneratedId),l.isObjectId&&(r=c.generatedObjectId),(l.isCreateDate||l.isUpdateDate)&&(r=s.connection.driver.preparePersistentValue(c.date,l)),l.isVersion&&(r=s.connection.driver.preparePersistentValue(1,l))}}else if(e.inverseRelation){var d=s.allSubjects.find(function(n){if(!n.hasEntity||n.entityTarget!==e.inverseRelation.target)return!1;var r=e.inverseRelation.getEntityValue(n.entity);return r?r instanceof Array?r.find(function(e){return e===e}):r===t:void 0});d&&n.referencedColumn.getEntityValue(d.entity)&&(r=n.referencedColumn.getEntityValue(d.entity))}r&&(u[n.databaseName]=r)})}),e.createDateColumn){c=this.connection.driver.preparePersistentValue(n,e.createDateColumn);u[e.createDateColumn.databaseName]=c}if(e.updateDateColumn){c=this.connection.driver.preparePersistentValue(n,e.updateDateColumn);u[e.updateDateColumn.databaseName]=c}if(e.versionColumn){c=this.connection.driver.preparePersistentValue(1,e.versionColumn);u[e.versionColumn.databaseName]=c}if(e.discriminatorColumn){var c=this.connection.driver.preparePersistentValue(o||e.discriminatorValue,e.discriminatorColumn);u[e.discriminatorColumn.databaseName]=c}if(e.treeLevelColumn&&e.treeParentRelation){var l=e.treeParentRelation.getEntityValue(t),d=l?e.treeLevelColumn.getEntityValue(l)||0:0;u[e.treeLevelColumn.databaseName]=d+1}return e.parentEntityMetadata&&e.parentIdColumns.length&&(u[e.parentIdColumns[0].databaseName]=r||e.parentEntityMetadata.primaryColumns[0].getEntityValue(t)),u},e.prototype.executeInsertClosureTableOperations=function(){var e=this,t=this.insertSubjects.filter(function(e){return e.metadata.isClosure}).map(function(t){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.insertClosureTableValues(t)];case 1:return e.sent(),[2]}})})});return Promise.all(t)},e.prototype.insertClosureTableValues=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,d;return __generator(this,function(p){switch(p.label){case 0:return t=e.metadata.closureJunctionTable.tableName,n=e.metadata.treeParentRelation.joinColumns[0].referencedColumn,!(r=n.getEntityValue(e.entity))&&n.isGenerated&&(r=e.newlyGeneratedId),i=e.metadata.treeParentRelation.getEntityValue(e.entity),o=0,i&&!(o=n.getEntityValue(i))&&n.isGenerated&&(a=this.insertSubjects.find(function(e){return e.entity===i}),o=a.newlyGeneratedId),o||(s=this.allSubjects.find(function(t){if(!t.hasEntity||!t.metadata.isClosure||!t.metadata.treeChildrenRelation)return!1;var n=e.metadata.treeChildrenRelation.getEntityValue(t.entity);return n instanceof Array&&-1!==n.indexOf(e.entity)}))&&!(o=n.getEntityValue(s))&&s.newlyGeneratedId&&(o=s.newlyGeneratedId),u=e,[4,this.queryRunner.insertIntoClosureTable(t,r,o,!!e.metadata.treeLevelColumn)];case 1:return u.treeLevel=p.sent(),e.metadata.treeLevelColumn?(l={},l[e.metadata.treeLevelColumn.databaseName]=e.treeLevel,c=l,[4,this.queryRunner.update(e.metadata.tableName,c,(d={},d[n.databaseName]=r,d))]):[3,3];case 2:p.sent(),p.label=3;case 3:return[2]}})})},e.prototype.executeUpdateOperations=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.updateSubjects.map(function(t){return e.update(t)}))];case 1:return t.sent(),[2]}})})},e.prototype.update=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:if(t=e.entity,this.connection.driver instanceof i.MongoDriver){if(!(n=e.metadata.getDatabaseEntityIdMap(t)))throw new Error("Internal error. Cannot get id of the updating entity.");return r={},this.collectColumns(e.metadata.ownColumns,t,r),e.metadata.embeddeds.forEach(function(e){return s.collectEmbeds(e,t,r)}),0===Object.keys(r).length?[2]:(e.metadata.updateDateColumn&&(r[e.metadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.updateDateColumn)),e.metadata.versionColumn&&(r[e.metadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(e.metadata.versionColumn.getEntityValue(t)+1,e.metadata.versionColumn)),[2,this.queryRunner.update(e.metadata.tableName,r,n)])}return o=[],e.diffColumns.forEach(function(e){var n=s.connection.getMetadata(e.entityMetadata.target),r=o.find(function(e){return e.tableName===n.tableName});r||(r={tableName:n.tableName,metadata:n,values:{}},o.push(r)),r.values[e.databaseName]=s.connection.driver.preparePersistentValue(e.getEntityValue(t),e)}),e.diffRelations.forEach(function(e){var n=o.find(function(t){return t.tableName===e.entityMetadata.tableName});n||(n={tableName:e.entityMetadata.tableName,metadata:e.entityMetadata,values:{}},o.push(n));var r=e.getEntityValue(t);e.joinColumns.forEach(function(e){n.values[e.databaseName]=null!==r&&void 0!==r?r[e.referencedColumn.propertyName]:null})}),0===Object.keys(o).length?[2]:(e.metadata.updateDateColumn&&((a=o.find(function(t){return t.tableName===e.metadata.tableName}))||(a={tableName:e.metadata.tableName,metadata:e.metadata,values:{}},o.push(a)),a.values[e.metadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.updateDateColumn)),e.metadata.versionColumn&&((a=o.find(function(t){return t.tableName===e.metadata.tableName}))||(a={tableName:e.metadata.tableName,metadata:e.metadata,values:{}},o.push(a)),a.values[e.metadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(e.metadata.versionColumn.getEntityValue(t)+1,e.metadata.versionColumn)),e.metadata.parentEntityMetadata&&(e.metadata.parentEntityMetadata.updateDateColumn&&((a=o.find(function(t){return t.tableName===e.metadata.parentEntityMetadata.tableName}))||(a={tableName:e.metadata.parentEntityMetadata.tableName,metadata:e.metadata.parentEntityMetadata,values:{}},o.push(a)),a.values[e.metadata.parentEntityMetadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.parentEntityMetadata.updateDateColumn)),e.metadata.parentEntityMetadata.versionColumn&&((a=o.find(function(t){return t.tableName===e.metadata.parentEntityMetadata.tableName}))||(a={tableName:e.metadata.parentEntityMetadata.tableName,metadata:e.metadata.parentEntityMetadata,values:{}},o.push(a)),a.values[e.metadata.parentEntityMetadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(e.metadata.parentEntityMetadata.versionColumn.getEntityValue(t)+1,e.metadata.parentEntityMetadata.versionColumn))),[4,Promise.all(o.map(function(e){var n=e.metadata.getDatabaseEntityIdMap(t);if(!n)throw new Error("Internal error. Cannot get id of the updating entity.");return s.queryRunner.update(e.tableName,e.values,n)}))]);case 1:return u.sent(),[2]}})})},e.prototype.executeUpdateRelations=function(){var e=this;return Promise.all(this.relationUpdateSubjects.map(function(t){return e.updateRelations(t)}))},e.prototype.updateRelations=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){if(t={},e.relationUpdates.forEach(function(e){e.relation.joinColumns.forEach(function(n){var r=e.value?e.value[n.referencedColumn.propertyName]:null;t[n.databaseName]=r})}),!(n=e.metadata.getDatabaseEntityIdMap(e.databaseEntity)))throw new Error("Internal error. Cannot get id of the updating entity.");return[2,this.queryRunner.update(e.metadata.tableName,t,n)]})})},e.prototype.executeRemoveOperations=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,r.PromiseUtils.runInSequence(this.removeSubjects,function(t){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.remove(t)];case 1:return[2,e.sent()]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.remove=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return e.metadata.parentEntityMetadata?(t={},e.metadata.primaryColumns.forEach(function(n){t[n.databaseName]=n.getEntityValue(e.databaseEntity)}),[4,this.queryRunner.delete(e.metadata.parentEntityMetadata.tableName,t)]):[3,3];case 1:return r.sent(),n={},e.metadata.primaryColumns.forEach(function(t){n[t.databaseName]=t.getEntityValue(e.databaseEntity)}),[4,this.queryRunner.delete(e.metadata.tableName,n)];case 2:return r.sent(),[3,5];case 3:return[4,this.queryRunner.delete(e.metadata.tableName,e.metadata.getDatabaseEntityIdMap(e.databaseEntity))];case 4:r.sent(),r.label=5;case 5:return[2]}})})},e.prototype.executeInsertJunctionsOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=[],this.allSubjects.forEach(function(n){n.junctionInserts.forEach(function(r){e.push(t.insertJunctions(n,r))})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.insertJunctions=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:if(r=function(e,t){return t.map(function(t){var n=t.referencedColumn.getEntityValue(e);if(!n&&t.referencedColumn.isGenerated&&(r=u.insertSubjects.find(function(t){return t.entity===e})))return r.newlyGeneratedId;if(!n&&t.referencedColumn.isObjectId){var r=u.insertSubjects.find(function(t){return t.entity===e});if(r)return r.generatedObjectId}return n})},i=t.relation,o=i.isManyToManyOwner?i.joinColumns:i.inverseRelation.inverseJoinColumns,!(a=r(e.entity,o)).length)throw new Error("Cannot insert object of "+e.entityTarget+" type. Looks like its not persisted yet, or cascades are not set on the relation.");return s=t.junctionEntities.map(function(e){var t=i.isManyToManyOwner?i.inverseJoinColumns:i.inverseRelation.joinColumns,o=r(e,t);if(!o)throw new Error("Cannot insert object of "+e.constructor.name+" type. Looks like its not persisted yet, or cascades are not set on the relation.");var s=i.junctionEntityMetadata.columns.map(function(e){return e.databaseName}),c=i.isOwning?a.concat(o):o.concat(a);return u.queryRunner.insert(i.junctionEntityMetadata.tableName,n.OrmUtils.zipObject(s,c))}),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.executeRemoveJunctionsOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=[],this.allSubjects.forEach(function(n){n.junctionRemoves.forEach(function(r){e.push(t.removeJunctions(n,r))})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.removeJunctions=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return n=t.relation.junctionEntityMetadata,r=e.hasEntity?e.entity:e.databaseEntity,i=t.relation.isOwning?t.relation.joinColumns:t.relation.inverseRelation.inverseJoinColumns,o=t.relation.isOwning?t.relation.inverseJoinColumns:t.relation.inverseRelation.joinColumns,a={},i.forEach(function(e){a[e.databaseName]=e.referencedColumn.getEntityValue(r)}),s=t.junctionRelationIds.map(function(e){var t={};return o.forEach(function(n){t[n.databaseName]=n.referencedColumn.getEntityValue(e)}),u.queryRunner.delete(n.tableName,Object.assign({},t,a))}),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.updateSpecialColumnsInPersistedEntities=function(){this.insertSubjects.forEach(function(e){e.generatedObjectId&&e.metadata.objectIdColumn&&e.metadata.objectIdColumn.setEntityValue(e.entity,e.generatedObjectId),e.metadata.primaryColumns.forEach(function(t){e.newlyGeneratedId&&t.setEntityValue(e.entity,e.newlyGeneratedId)}),e.metadata.primaryColumns.forEach(function(t){e.parentGeneratedId&&t.setEntityValue(e.entity,e.parentGeneratedId)}),e.metadata.updateDateColumn&&e.metadata.updateDateColumn.setEntityValue(e.entity,e.date),e.metadata.createDateColumn&&e.metadata.createDateColumn.setEntityValue(e.entity,e.date),e.metadata.versionColumn&&e.metadata.versionColumn.setEntityValue(e.entity,1),e.metadata.treeLevelColumn&&e.metadata.treeLevelColumn.setEntityValue(e.entity,e.treeLevel)}),this.updateSubjects.forEach(function(e){e.metadata.updateDateColumn&&e.metadata.updateDateColumn.setEntityValue(e.entity,e.date),e.metadata.versionColumn&&e.metadata.versionColumn.setEntityValue(e.entity,e.metadata.versionColumn.getEntityValue(e.entity)+1)}),this.removeSubjects.filter(function(e){return e.hasEntity}).forEach(function(e){e.metadata.primaryColumns.forEach(function(t){t.setEntityValue(e.entity,void 0)})})},e}(),e("SubjectOperationExecutor",a)}}}),System.register("typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.prototype.transform=function(e,t,n){return this.groupAndTransform(e,t,n),e},e.prototype.groupAndTransform=function(e,t,n){var r=this;n.columns.filter(function(e){return t.hasOwnProperty(e.propertyName)}).forEach(function(n){return e[n.propertyName]=t[n.propertyName]}),n.relations.filter(function(e){return t.hasOwnProperty(e.propertyName)}).forEach(function(i){var o=i.inverseEntityMetadata;if(!o)throw new Error("Relation metadata for the relation "+n.name+"#"+i.propertyName+" is missing");if(i.isManyToMany||i.isOneToMany)t[i.propertyName]instanceof Array?e[i.propertyName]=t[i.propertyName].map(function(t){var n=o.create();if(e[i.propertyName]instanceof Array){var a=e[i.propertyName].find(function(e){return e[i.propertyName]===t[i.propertyName]});a&&r.groupAndTransform(n,a,o)}return r.groupAndTransform(n,t,o),n}):e[i.propertyName]=t[i.propertyName];else if(t[i.propertyName]){var a=o.create();e[i.propertyName]&&r.groupAndTransform(a,e[i.propertyName],o),r.groupAndTransform(a,t[i.propertyName],o),e[i.propertyName]=a}else e[i.propertyName]=t[i.propertyName]})},e}(),e("PlainObjectToNewEntityTransformer",n)}}}),System.register("typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer",[],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!0,configurable:!0}),e.prototype.compareEntities=function(e,t){return this.metadata.compareEntities(e,t)},e}(),r=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,"mainLoadMapItem",{get:function(){return this.loadMapItems.find(function(e){return!e.relation&&!e.parentLoadMapItem})},enumerable:!0,configurable:!0}),e.prototype.addLoadMap=function(e){this.loadMapItems.find(function(t){return t.target===e.target&&t.id===e.id})||this.loadMapItems.push(e)},e.prototype.fillEntities=function(e,t){var n=this;t.forEach(function(t){var r=n.loadMapItems.find(function(n){return n.target===e&&n.compareEntities(t,n.plainEntity)});r&&(r.entity=t)})},e.prototype.groupByTargetIds=function(){var e=[];return this.loadMapItems.forEach(function(t){var n=e.find(function(e){return e.target===t.target});n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)}),e},e}(),i=function(){function e(e){this.entityManager=e}return e.prototype.transform=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t.checkIfObjectContainsAllPrimaryKeys(e)?(i=new r,(o=function(e,r,a,s){var u=new n(e,r,a,s);i.addLoadMap(u),r.extractRelationValuesFromEntity(e,t.relations).filter(function(e){return null!==e&&void 0!==e}).forEach(function(e){var t=e[0],n=e[1],r=e[2];return o(n,r,u,t)})})(e,t),[4,Promise.all(i.groupByTargetIds().map(function(e){return a.entityManager.findByIds(e.target,e.ids).then(function(t){return i.fillEntities(e.target,t)})}))]):[2,Promise.reject("Given object does not have a primary column, cannot transform it to database entity.")];case 1:return s.sent(),i.loadMapItems.forEach(function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)}),[2,i.mainLoadMapItem?i.mainLoadMapItem.entity:void 0]}})})},e}(),e("PlainObjectToDatabaseEntityTransformer",i)}}}),System.register("typeorm/repository/error/CustomRepositoryNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CustomRepositoryNotFoundError",n.message="Custom repository "+(t instanceof Function?t.name:t.constructor.name)+" was not found. Did you forgot to put @EntityRepository decorator on it?",n}return __extends(t,e),t}(Error),e("CustomRepositoryNotFoundError",n)}}}),System.register("typeorm/repository/error/CustomRepositoryDoesNotHaveEntityError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Custom repository "+(t instanceof Function?t.name:t.constructor.name)+" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? ")||this;return n.name="CustomRepositoryDoesNotHaveEntityError",n}return __extends(t,e),t}(Error),e("CustomRepositoryDoesNotHaveEntityError",n)}}}),System.register("typeorm/repository/AbstractRepository",["typeorm/repository/error/CustomRepositoryDoesNotHaveEntityError","typeorm/index","typeorm/repository/error/CustomRepositoryNotFoundError"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(){}return Object.defineProperty(e.prototype,"repository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeRepository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getTreeRepository(e)},enumerable:!0,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.manager.getTreeRepository(e)},e.prototype.getCustomRepositoryTarget=function(e){var t=r.getMetadataArgsStorage().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new i.CustomRepositoryNotFoundError(e);return t.entity},e}(),e("AbstractRepository",o)}}}),System.register("typeorm/repository/error/CustomRepositoryCannotInheritRepositoryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Custom entity repository "+(t instanceof Function?t.name:t.constructor.name)+"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.")||this;return n.name="CustomRepositoryCannotInheritRepositoryError",n}return __extends(t,e),t}(Error),e("CustomRepositoryCannotInheritRepositoryError",n)}}}),System.register("typeorm/entity-manager/EntityManager",["typeorm/query-runner/error/QueryRunnerProviderAlreadyReleasedError","typeorm/entity-manager/error/NoNeedToReleaseEntityManagerError","typeorm/repository/Repository","typeorm/find-options/FindOptionsUtils","typeorm/persistence/SubjectBuilder","typeorm/persistence/SubjectOperationExecutor","typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer","typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer","typeorm/repository/error/CustomRepositoryNotFoundError","typeorm/index","typeorm/repository/AbstractRepository","typeorm/repository/error/CustomRepositoryCannotInheritRepositoryError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,p,m,f;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){p=e},function(e){m=e}],execute:function(){f=function(){function e(e,t){this.data={},this.connection=e,t&&(this.queryRunner=t)}return e.prototype.transaction=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.connection.transaction(e,this.queryRunner)]})})},e.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.connection.query(e,t,this.queryRunner)]})})},e.prototype.createQueryBuilder=function(e,t,n){return t?this.connection.createQueryBuilder(e,t,n||this.queryRunner):this.connection.createQueryBuilder(e||this.queryRunner)},e.prototype.getData=function(e){return this.data[e]},e.prototype.setData=function(e,t){return this.data[e]=t,this},e.prototype.hasId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).hasId(r)},e.prototype.getId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).getEntityIdMixedMap(r)},e.prototype.create=function(e,t){var n=this,r=this.connection.getMetadata(e);return t?t instanceof Array?t.map(function(t){return n.create(e,t)}):this.merge(e,r.create(),t):r.create()},e.prototype.merge=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this.connection.getMetadata(e),o=new u.PlainObjectToNewEntityTransformer;return n.forEach(function(e){return o.transform(t,e,i)}),t},e.prototype.preload=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:return n=this.connection.getMetadata(e),r=new c.PlainObjectToDatabaseEntityTransformer(this.connection.manager),[4,r.transform(t,n)];case 1:return i=o.sent(),i?[2,this.merge(e,i,t)]:[2,void 0]}})})},e.prototype.save=function(e,t,n){var r=this,i=arguments.length>1&&(e instanceof Function||"string"==typeof e)?e:void 0,o=i?t:e,a=i?n:t;return Promise.resolve().then(function(){return __awaiter(r,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return o instanceof Array?[4,Promise.all(o.map(function(e){var n=i||e.constructor;return t.saveOne(n,e,a)}))]:[3,2];case 1:return n.sent(),[3,4];case 2:return e=i||o.constructor,[4,this.saveOne(e,o,a)];case 3:n.sent(),n.label=4;case 4:return[2,o]}})})})},e.prototype.persist=function(e,t,n){return this.save(e,t,n)},e.prototype.update=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return[4,this.findOne(e,t)];case 1:if(!(i=o.sent()))throw new Error("Cannot find entity to update by a given criteria");return Object.assign(i,n),[4,this.save(i,r)];case 2:return o.sent(),[2]}})})},e.prototype.updateById=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return[4,this.findOneById(e,t)];case 1:if(!(i=o.sent()))throw new Error("Cannot find entity to update by a id");return Object.assign(i,n),[4,this.save(i,r)];case 2:return o.sent(),[2]}})})},e.prototype.remove=function(e,t,n){var r=this,i=arguments.length>1&&(e instanceof Function||"string"==typeof e)?e:void 0,o=i?t:e,a=i?n:t;return Promise.resolve().then(function(){return __awaiter(r,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return o instanceof Array?[4,Promise.all(o.map(function(e){var n=i||e.constructor;return t.removeOne(n,e,a)}))]:[3,2];case 1:return n.sent(),[3,4];case 2:return e=i||o.constructor,[4,this.removeOne(e,o,a)];case 3:n.sent(),n.label=4;case 4:return[2,o]}})})})},e.prototype.removeById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.findOneById(e,t)];case 1:if(!(r=i.sent()))throw new Error("Cannot find entity to remove by a given id");return[4,this.remove(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.removeByIds=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i=this;return __generator(this,function(o){switch(o.label){case 0:return r=t.map(function(t){return __awaiter(i,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.findOneById(e,t)];case 1:if(!(r=i.sent()))throw new Error("Cannot find entity to remove by a given id");return[4,this.remove(r,n)];case 2:return i.sent(),[2]}})})}),[4,Promise.all(r)];case 1:return o.sent(),[2]}})})},e.prototype.count=function(e,t){var n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,o.FindOptionsUtils.extractFindManyOptionsAlias(t)||n.name);return o.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getCount()},e.prototype.find=function(e,t){var n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,o.FindOptionsUtils.extractFindManyOptionsAlias(t)||n.name);return o.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getMany()},e.prototype.findAndCount=function(e,t){var n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,o.FindOptionsUtils.extractFindManyOptionsAlias(t)||n.name);return o.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getManyAndCount()},e.prototype.findByIds=function(e,t,n){var r=this.connection.getMetadata(e),i=this.createQueryBuilder(e,o.FindOptionsUtils.extractFindManyOptionsAlias(n)||r.name);return o.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(i,n),t=t.map(function(e){return r.hasMultiplePrimaryKeys||e instanceof Object?e:r.createEntityIdMap([e])}),i.whereInIds(t),i.getMany()},e.prototype.findOne=function(e,t){var n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,o.FindOptionsUtils.extractFindOneOptionsAlias(t)||n.name);return o.FindOptionsUtils.applyFindOneOptionsOrConditionsToQueryBuilder(r,t).getOne()},e.prototype.findOneById=function(e,t,n){var r=this.connection.getMetadata(e),i=this.createQueryBuilder(e,o.FindOptionsUtils.extractFindOneOptionsAlias(n)||r.name);if(r.hasMultiplePrimaryKeys&&!(t instanceof Object))throw new Error("You have multiple primary keys in your entity, to use findOneById with multiple primary keys please provide complete object with all entity ids, like this: { firstKey: value, secondKey: value }");return o.FindOptionsUtils.applyFindOneOptionsOrConditionsToQueryBuilder(i,n),r.hasMultiplePrimaryKeys||t instanceof Object||(t=r.createEntityIdMap([t])),i.whereInIds([t]),i.getOne()},e.prototype.clear=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:t=this.connection.getMetadata(e),n=this.queryRunner||this.connection.createQueryRunner(),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,n.truncate(t.tableName)];case 2:return[2,r.sent()];case 3:return this.queryRunner?[3,5]:[4,n.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.getRepository=function(e){if(this.queryRunner){if(this.queryRunner.isReleased)throw new n.QueryRunnerProviderAlreadyReleasedError;return this.connection.createIsolatedRepository(e,this.queryRunner)}return this.connection.getRepository(e)},e.prototype.getTreeRepository=function(e){if(this.queryRunner){if(this.queryRunner.isReleased)throw new n.QueryRunnerProviderAlreadyReleasedError;return this.connection.createIsolatedRepository(e,this.queryRunner)}return this.connection.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){if(this.queryRunner){if(this.queryRunner.isReleased)throw new n.QueryRunnerProviderAlreadyReleasedError;return this.connection.createIsolatedRepository(e,this.queryRunner)}return this.connection.getMongoRepository(e)},e.prototype.getCustomRepository=function(e){var t=d.getMetadataArgsStorage().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new l.CustomRepositoryNotFoundError(e);var n=t.entity?this.connection.getMetadata(t.entity):void 0,r=new t.target(this,n);if(r instanceof p.AbstractRepository&&(r.manager||(r.manager=this)),r instanceof i.Repository){if(!n)throw new m.CustomRepositoryCannotInheritRepositoryError(e);r.manager=this,r.metadata=n}return r},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(!this.queryRunner)throw new r.NoNeedToReleaseEntityManagerError;return[2,this.queryRunner.release()]})})},e.prototype.saveOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,u,c;return __generator(this,function(l){switch(l.label){case 0:r=this.connection.getMetadata(e),i=this.queryRunner||this.connection.createQueryRunner(),l.label=1;case 1:return l.trys.push([1,,4,7]),o=this.connection.createIsolatedManager(i),n&&n.data&&(o.data=n.data),u=new a.SubjectBuilder(this.connection,i),[4,u.persist(t,r)];case 2:return l.sent(),c=new s.SubjectOperationExecutor(this.connection,o,i),[4,c.execute(u.operateSubjects)];case 3:return l.sent(),[3,7];case 4:return this.queryRunner?[3,6]:[4,i.release()];case 5:l.sent(),l.label=6;case 6:return[7];case 7:return[2]}})})},e.prototype.removeOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,u,c;return __generator(this,function(l){switch(l.label){case 0:r=this.connection.getMetadata(e),i=this.queryRunner||this.connection.createQueryRunner(),l.label=1;case 1:return l.trys.push([1,,4,7]),o=this.connection.createIsolatedManager(i),n&&n.data&&(o.data=n.data),u=new a.SubjectBuilder(this.connection,i),[4,u.remove(t,r)];case 2:return l.sent(),c=new s.SubjectOperationExecutor(this.connection,o,i),[4,c.execute(u.operateSubjects)];case 3:return l.sent(),[3,7];case 4:return this.queryRunner?[3,6]:[4,i.release()];case 5:l.sent(),l.label=6;case 6:return[7];case 7:return[2]}})})},e}(),e("EntityManager",f)}}}),System.register("typeorm/driver/sqlserver/SqlServerQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){this.driver=e,this.isReleased=!1,this.isTransactionActive=!1,this.queryResponsibilityChain=[],this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.connection=e.connection,this.manager=e.connection.manager}return e.prototype.connect=function(){return Promise.resolve()},e.prototype.release=function(){return this.isReleased=!0,Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return[2,new Promise(function(t,n){return __awaiter(e,void 0,void 0,function(){var e=this;return __generator(this,function(r){return this.isTransactionActive=!0,this.databaseConnection=this.driver.connectionPool.transaction(),this.databaseConnection.begin(function(r){if(r)return e.isTransactionActive=!1,n(r);t()}),[2]})})})]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[2,new Promise(function(t,n){e.databaseConnection.commit(function(r){if(r)return n(r);e.isTransactionActive=!1,e.databaseConnection=null,t()})})]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[2,new Promise(function(t,n){e.databaseConnection.rollback(function(r){if(r)return n(r);e.isTransactionActive=!1,e.databaseConnection=null,t()})})]})})},e.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return r=new Promise(function(e){return n=e}),this.queryResponsibilityChain.length?(i=this.queryResponsibilityChain.slice(),this.queryResponsibilityChain.push(r),[4,Promise.all(i)]):[3,2];case 1:s.sent(),s.label=2;case 2:return o=new Promise(function(i,s){return __awaiter(a,void 0,void 0,function(){var a,u=this;return __generator(this,function(c){return this.driver.connection.logger.logQuery(e,t,this),a=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:this.driver.connectionPool),t&&t.length&&t.forEach(function(e,n){a.input(n,t[n])}),a.query(e,function(a,c){var l=function(){-1!==d&&u.queryResponsibilityChain.splice(d,1),-1!==p&&u.queryResponsibilityChain.splice(p,1),n()},d=u.queryResponsibilityChain.indexOf(o),p=u.queryResponsibilityChain.indexOf(r);if(a)return u.driver.connection.logger.logFailedQuery(e,t,u),u.driver.connection.logger.logQueryError(a.originalError&&a.originalError.info?a.originalError.info.message:a,u),l(),s(a);i(c.recordset),l()}),[2]})})}),this.isTransactionActive&&this.queryResponsibilityChain.push(o),[2,o]}})})},e.prototype.stream=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u=this;return __generator(this,function(l){switch(l.label){case 0:if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return o=new Promise(function(e){return i=e}),this.queryResponsibilityChain.length?(a=this.queryResponsibilityChain.slice(),this.queryResponsibilityChain.push(o),[4,Promise.all(a)]):[3,2];case 1:l.sent(),l.label=2;case 2:return s=new Promise(function(a,c){return __awaiter(u,void 0,void 0,function(){var u,l=this;return __generator(this,function(d){return this.driver.connection.logger.logQuery(e,t,this),u=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:this.driver.connectionPool),u.stream=!0,t&&t.length&&t.forEach(function(e,n){u.input(n,t[n])}),u.query(e,function(n,r){var u=function(){-1!==d&&l.queryResponsibilityChain.splice(d,1),-1!==p&&l.queryResponsibilityChain.splice(p,1),i()},d=l.queryResponsibilityChain.indexOf(s),p=l.queryResponsibilityChain.indexOf(o);if(n)return l.driver.connection.logger.logFailedQuery(e,t,l),l.driver.connection.logger.logQueryError(n.originalError&&n.originalError.info?n.originalError.info.message:n,l),u(),c(n);a(r.recordset),u()}),n&&u.on("done",n),r&&u.on("error",r),a(u),[2]})})}),this.isTransactionActive&&this.queryResponsibilityChain.push(s),[2,s]}})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=Object.keys(t),i=r.map(function(e){return'"'+e+'"'}).join(", "),o=r.map(function(e,t){return"@"+t}).join(","),a=r.map(function(e){return t[e]}),s=i.length>0?'INSERT INTO "'+e+'"('+i+") "+(n?"OUTPUT INSERTED."+n.databaseName+" ":"")+"VALUES ("+o+")":'INSERT INTO "'+e+'" '+(n?"OUTPUT INSERTED."+n.databaseName+" ":"")+"DEFAULT VALUES ",[4,this.query(s,a)];case 1:return u=c.sent(),[2,n?u instanceof Array?u[0][n.databaseName]:u[n.databaseName]:void 0]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=Object.keys(n).map(function(e){return n[e]}),i=Object.keys(t).map(function(e){return t[e]}),o=i.concat(r),a=this.parametrize(t).join(", "),s=this.parametrize(n,i.length).join(" AND "),u='UPDATE "'+e+'" SET '+a+" "+(s?" WHERE "+s:""),[4,this.query(u,o)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o='DELETE FROM "'+e+'" WHERE '+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i="",i=r?'INSERT INTO "'+e+'"("ancestor", "descendant", "level") SELECT "ancestor", '+t+', "level" + 1 FROM "'+e+'" WHERE "descendant" = '+n+" UNION ALL SELECT "+t+", "+t+", 1":'INSERT INTO "'+e+'"("ancestor", "descendant") SELECT "ancestor", '+t+' FROM "'+e+'" WHERE "descendant" = '+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query('SELECT MAX(level) as level FROM "'+e+'" WHERE descendant = '+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,c,l,d,p,m,f,y,h,g,v=this;return __generator(this,function(b){switch(b.label){case 0:return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_CATALOG = '"+this.dbName+"' AND TABLE_NAME IN ("+t+")",r="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_CATALOG = '"+this.dbName+"'",c="SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages LEFT JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME WHERE columnUsages.TABLE_CATALOG = '"+this.dbName+"' AND tableConstraints.TABLE_CATALOG = '"+this.dbName+"'",l="SELECT COLUMN_NAME, TABLE_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_CATALOG = '"+this.dbName+"' AND COLUMNPROPERTY(object_id(TABLE_NAME), COLUMN_NAME, 'IsIdentity') = 1;",d="SELECT TABLE_NAME = t.name, INDEX_NAME = ind.name, IndexId = ind.index_id, ColumnId = ic.index_column_id, COLUMN_NAME = col.name, ind.*, ic.*, col.* FROM sys.indexes ind INNER JOIN sys.index_columns ic ON ind.object_id = ic.object_id and ind.index_id = ic.index_id INNER JOIN sys.columns col ON ic.object_id = col.object_id and ic.column_id = col.column_id INNER JOIN sys.tables t ON ind.object_id = t.object_id WHERE ind.is_primary_key = 0 AND ind.is_unique = 0 AND ind.is_unique_constraint = 0 AND t.is_ms_shipped = 0 ORDER BY t.name, ind.name, ind.index_id, ic.index_column_id",[4,Promise.all([this.query(n),this.query(r),this.query(c),this.query(l),this.query(d)])]):[2,[]];case 1:return p=b.sent(),m=p[0],f=p[1],y=p[2],h=p[3],g=p[4],m.length?[2,Promise.all(m.map(function(e){return __awaiter(v,void 0,void 0,function(){var t;return __generator(this,function(n){return t=new o.TableSchema(e.TABLE_NAME),t.columns=f.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var n=!!y.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME&&"PRIMARY KEY"===n.CONSTRAINT_TYPE}),r=!!h.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME}),o=!!y.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME&&"UNIQUE"===n.CONSTRAINT_TYPE}),a=new i.ColumnSchema;return a.name=e.COLUMN_NAME,a.type=e.DATA_TYPE.toLowerCase()+(e.CHARACTER_MAXIMUM_LENGTH?"("+e.CHARACTER_MAXIMUM_LENGTH+")":""),a.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,a.isNullable="YES"===e.IS_NULLABLE,a.isPrimary=n,a.isGenerated=r,a.isUnique=o,a.comment="",a}),t.primaryKeys=y.filter(function(e){return e.TABLE_NAME===t.name&&"PRIMARY KEY"===e.CONSTRAINT_TYPE}).map(function(e){return new s.PrimaryKeySchema(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),t.foreignKeys=y.filter(function(e){return e.TABLE_NAME===t.name&&"FOREIGN KEY"===e.CONSTRAINT_TYPE}).map(function(e){return new a.ForeignKeySchema(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=g.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=g.filter(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===n}).map(function(e){return e.COLUMN_NAME});return new u.IndexSchema(e.TABLE_NAME,n,r,!1)}),[2,t]})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_CATALOG = '"+this.dbName+"' AND TABLE_NAME = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.columns.map(function(e){return i.buildCreateColumnSql(e,!1,!0)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,n+=e.columns.filter(function(e){return e.isUnique}).map(function(t){return', CONSTRAINT "uk_'+e.name+"_"+t.name+'" UNIQUE ("'+t.name+'")'}).join(" "),(r=e.columns.filter(function(e){return e.isPrimary})).length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_CATALOG = '"+this.dbName+"' AND TABLE_NAME = '"+e+"' AND COLUMN_NAME = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof o.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD '+this.buildCreateColumnSql(t,!1,!0),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof o.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof i.ColumnSchema?s=n:(s=a.clone()).name=n,[2,this.changeColumn(r,a,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof o.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return n.isGenerated===a.isGenerated?[3,6]:[4,this.query('ALTER TABLE "'+r.name+'" DROP COLUMN "'+n.name+'"')];case 4:return u.sent(),[4,this.query('ALTER TABLE "'+r.name+'" ADD '+this.buildCreateColumnSql(n,!1,!1))];case 5:u.sent(),u.label=6;case 6:return s='ALTER TABLE "'+r.name+'" ALTER COLUMN '+this.buildCreateColumnSql(n,!0,!1),[4,this.query(s)];case 7:return u.sent(),n.isUnique===a.isUnique?[3,11]:!0!==n.isUnique?[3,9]:[4,this.query('ALTER TABLE "'+r.name+'" ADD CONSTRAINT "uk_'+n.name+'" UNIQUE ("'+n.name+'")')];case 8:return u.sent(),[3,11];case 9:return!1!==n.isUnique?[3,11]:[4,this.query('ALTER TABLE "'+r.name+'" DROP CONSTRAINT "uk_'+n.name+'"')];case 10:u.sent(),u.label=11;case 11:return n.default===a.default?[3,16]:null===n.default||void 0===n.default?[3,14]:[4,this.query('ALTER TABLE "'+r.name+'" DROP CONSTRAINT "df_'+n.name+'"')];case 12:return u.sent(),[4,this.query('ALTER TABLE "'+r.name+'" ADD CONSTRAINT "df_'+n.name+'" DEFAULT '+n.default+' FOR "'+n.name+'"')];case 13:return u.sent(),[3,16];case 14:return null===a.default||void 0===a.default?[3,16]:[4,this.query('ALTER TABLE "'+r.name+'" DROP CONSTRAINT "df_'+n.name+'"')];case 15:u.sent(),u.label=16;case 16:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return t.default?[4,this.query('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "df_'+t.name+'"')]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.query('ALTER TABLE "'+e.name+'" DROP COLUMN "'+t.name+'"')];case 3:return n.sent(),[2]}})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:return t="SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages\nLEFT JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME AND tableConstraints.CONSTRAINT_TYPE = 'PRIMARY KEY'\nWHERE columnUsages.TABLE_CATALOG = '"+this.dbName+"' AND tableConstraints.TABLE_CATALOG = '"+this.dbName+"'",[4,this.query(t)];case 1:return n=i.sent(),n.length>0?[4,this.query('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n[0].CONSTRAINT_NAME+'"')]:[3,3];case 2:i.sent(),i.label=3;case 3:return r=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),r.length>0?[4,this.query('ALTER TABLE "'+e.name+'" ADD PRIMARY KEY ('+r.join(", ")+")")]:[3,5];case 4:i.sent(),i.label=5;case 5:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,a;return __generator(this,function(s){return n=e instanceof o.TableSchema?e.name:e,r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),a='ALTER TABLE "'+n+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'"('+i+")",t.onDelete&&(a+=" ON DELETE "+t.onDelete),[2,this.query(a)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof o.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" DROP CONSTRAINT "'+t.name+'"',[2,this.query(r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n='DROP INDEX "'+e+'"."'+t+'"',[4,this.query(n)];case 1:return r.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query('TRUNCATE TABLE "'+e+'"')];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return[4,this.startTransaction()];case 1:a.sent(),a.label=2;case 2:return a.trys.push([2,7,,12]),e="SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE'",[4,this.query(e)];case 3:return t=a.sent(),n=t.map(function(e){return e.TABLE_NAME}),[4,Promise.all(n.map(function(e){return __awaiter(o,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return t="SELECT 'ALTER TABLE ' +  OBJECT_SCHEMA_NAME(parent_object_id) + '.[' + OBJECT_NAME(parent_object_id) + '] DROP CONSTRAINT ' + name as query FROM sys.foreign_keys WHERE referenced_object_id = object_id('"+e+"')",[4,this.query(t)];case 1:return n=i.sent(),[2,Promise.all(n.map(function(e){return e.query}).map(function(e){return r.query(e)}))]}})})}))];case 4:return a.sent(),[4,Promise.all(n.map(function(e){var t='DROP TABLE "'+e+'"';return o.query(t)}))];case 5:return a.sent(),[4,this.commitTransaction()];case 6:return a.sent(),[3,12];case 7:r=a.sent(),a.label=8;case 8:return a.trys.push([8,10,,11]),[4,this.rollbackTransaction()];case 9:return a.sent(),[3,11];case 10:return i=a.sent(),[3,11];case 11:throw r;case 12:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.database},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,n){return'"'+e+'"=@'+(t+n)})},e.prototype.buildCreateColumnSql=function(e,t,n){var r='"'+e.name+'" '+e.type;return!0!==e.isNullable&&(r+=" NOT NULL"),!0!==e.isGenerated||t||(r+=" IDENTITY(1,1)"),e.comment&&(r+=" COMMENT '"+e.comment+"'"),n&&void 0!==e.default&&null!==e.default&&(r+=' CONSTRAINT "df_'+e.name+'" DEFAULT '+e.default),r},e}(),e("SqlServerQueryRunner",l)}}}),System.register("typeorm/schema-builder/RdbmsSchemaBuilder",["typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/util/PromiseUtils"],function(e,t){"use strict";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e){this.connection=e}return e.prototype.build=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r;return __generator(this,function(i){switch(i.label){case 0:return e=this,[4,this.connection.createQueryRunner()];case 1:return e.queryRunner=i.sent(),t=this,[4,this.loadTableSchemas()];case 2:return t.tableSchemas=i.sent(),[4,this.queryRunner.startTransaction()];case 3:i.sent(),i.label=4;case 4:return i.trys.push([4,7,12,14]),[4,this.executeSchemaSyncOperationsInProperOrder()];case 5:return i.sent(),[4,this.queryRunner.commitTransaction()];case 6:return i.sent(),[3,14];case 7:n=i.sent(),i.label=8;case 8:return i.trys.push([8,10,,11]),[4,this.queryRunner.rollbackTransaction()];case 9:return i.sent(),[3,11];case 10:return r=i.sent(),[3,11];case 11:throw n;case 12:return[4,this.queryRunner.release()];case 13:return i.sent(),[7];case 14:return[2]}})})},e.prototype.log=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=this,[4,this.connection.createQueryRunner()];case 1:e.queryRunner=n.sent(),n.label=2;case 2:return n.trys.push([2,,5,7]),t=this,[4,this.loadTableSchemas()];case 3:return t.tableSchemas=n.sent(),this.queryRunner.enableSqlMemory(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 4:return n.sent(),[2,this.queryRunner.getMemorySql()];case 5:return this.queryRunner.disableSqlMemory(),[4,this.queryRunner.release()];case 6:return n.sent(),[7];case 7:return[2]}})})},e.prototype.loadTableSchemas=function(){var e=this.entityToSyncMetadatas.map(function(e){return e.tableName});return this.queryRunner.loadTableSchemas(e)},Object.defineProperty(e.prototype,"entityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter(function(e){return!e.skipSync&&"single-table-child"!==e.tableType})},enumerable:!0,configurable:!0}),e.prototype.executeSchemaSyncOperationsInProperOrder=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.dropOldForeignKeys()];case 1:return e.sent(),[4,this.createNewTables()];case 2:return e.sent(),[4,this.dropRemovedColumns()];case 3:return e.sent(),[4,this.addNewColumns()];case 4:return e.sent(),[4,this.updateExistColumns()];case 5:return e.sent(),[4,this.updatePrimaryKeys()];case 6:return e.sent(),[4,this.createIndices()];case 7:return e.sent(),[4,this.createForeignKeys()];case 8:return e.sent(),[2]}})})},e.prototype.dropOldForeignKeys=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n;return __generator(this,function(r){switch(r.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?0===(n=e.foreignKeys.filter(function(e){return!t.foreignKeys.find(function(t){return t.name===e.name})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping old foreign keys of "+e.name+": "+n.map(function(e){return e.name}).join(", ")),e.removeForeignKeys(n),[4,this.queryRunner.dropForeignKeys(e,n)]):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.createNewTables=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,r;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?[2]:(this.connection.logger.logSchemaBuild("creating a new table: "+t.tableName),r=new n.TableSchema(t.tableName,this.metadataColumnsToColumnSchemas(t.columns),!0),this.tableSchemas.push(r),[4,this.queryRunner.createTable(r)]);case 1:return i.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.dropRemovedColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?(n=e.columns.filter(function(e){return!t.columns.find(function(t){return t.databaseName===e.name})}),0===n.length?[2]:[4,Promise.all(n.map(function(e){return r.dropColumnReferencedForeignKeys(t.tableName,e.name)}))]):[2];case 1:return i.sent(),[4,Promise.all(n.map(function(e){return r.dropColumnReferencedIndices(t.tableName,e.name)}))];case 2:return i.sent(),this.connection.logger.logSchemaBuild("columns dropped in "+e.name+": "+n.map(function(e){return e.name}).join(", ")),e.removeColumns(n),e.removePrimaryKeysOfColumns(n),[4,this.queryRunner.dropColumns(e,n)];case 3:return i.sent(),[2]}})})})},e.prototype.addNewColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?0===(n=t.columns.filter(function(t){return!e.columns.find(function(e){return e.name===t.databaseName})})).length?[2]:(this.connection.logger.logSchemaBuild("new columns added: "+n.map(function(e){return e.databaseName}).join(", ")),r=this.metadataColumnsToColumnSchemas(n),[4,this.queryRunner.addColumns(e,r)]):[2];case 1:return i.sent(),e.addColumns(r),[2]}})})})},e.prototype.updateExistColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,i,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?0===(n=e.findChangedColumns(this.connection.driver,t.columns)).length?[2]:(this.connection.logger.logSchemaBuild("columns changed in "+e.name+". updating: "+n.map(function(e){return e.name}).join(", ")),i=n.filter(function(e){return!!t.columns.find(function(t){return t.databaseName===e.name})}).map(function(e){return s.dropColumnReferencedForeignKeys(t.tableName,e.name)}),[4,Promise.all(i)]):[2];case 1:return u.sent(),o=n.filter(function(e){return!!t.columns.find(function(t){return t.databaseName===e.name})}).map(function(e){return s.dropColumnReferencedIndices(t.tableName,e.name)}),[4,Promise.all(o)];case 2:return u.sent(),a=n.map(function(n){var i=t.columns.find(function(e){return e.databaseName===n.name}),o=r.ColumnSchema.create(i,s.connection.driver.normalizeType(i),s.connection.driver.normalizeDefault(i));return e.replaceColumn(n,o),{newColumn:o,oldColumn:n}}),[2,this.queryRunner.changeColumns(e,a)]}})})})},e.prototype.updatePrimaryKeys=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r,i;return __generator(this,function(o){switch(o.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName&&!e.justCreated}))?(n=t.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),r=n.filter(function(t){return!e.primaryKeysWithoutGenerated.find(function(e){return e.columnName===t.databaseName})}).map(function(e){return new a.PrimaryKeySchema("",e.databaseName)}),i=e.primaryKeysWithoutGenerated.filter(function(e){return!n.find(function(t){return t.databaseName===e.columnName})}),0===r.length&&0===i.length?[2]:(this.connection.logger.logSchemaBuild("primary keys of "+e.name+" has changed: dropped - "+(i.map(function(e){return e.columnName}).join(", ")||"nothing")+"; added - "+(r.map(function(e){return e.columnName}).join(", ")||"nothing")),e.addPrimaryKeys(r),e.removePrimaryKeys(i),[4,this.queryRunner.updatePrimaryKeys(e)])):[2];case 1:return o.sent(),[2]}})})})},e.prototype.createForeignKeys=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r;return __generator(this,function(o){switch(o.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?0===(n=t.foreignKeys.filter(function(t){return!e.foreignKeys.find(function(e){return e.name===t.name})})).length?[2]:(r=n.map(function(e){return i.ForeignKeySchema.create(e)}),this.connection.logger.logSchemaBuild("creating a foreign keys: "+n.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.createForeignKeys(e,r)]):[2];case 1:return o.sent(),e.addForeignKeys(r),[2]}})})})},e.prototype.createIndices=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r,i=this;return __generator(this,function(a){switch(a.label){case 0:return(e=this.tableSchemas.find(function(e){return e.name===t.tableName}))?(n=e.indices.filter(function(e){return!t.indices.find(function(t){return t.name===e.name})}).map(function(n){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return this.connection.logger.logSchemaBuild("dropping an index: "+n.name),e.removeIndex(n),[4,this.queryRunner.dropIndex(t.tableName,n.name)];case 1:return r.sent(),[2]}})})}),r=t.indices.filter(function(t){return!e.indices.find(function(e){return e.name===t.name})}).map(function(t){return __awaiter(i,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n=o.IndexSchema.create(t),e.indices.push(n),this.connection.logger.logSchemaBuild("adding new index: "+n.name),[4,this.queryRunner.createIndex(n.tableName,n)];case 1:return r.sent(),[2]}})})}),[4,Promise.all(n.concat(r))]):[2];case 1:return a.sent(),[2]}})})})},e.prototype.dropColumnReferencedIndices=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return n=this.connection.entityMetadatas.reduce(function(e,t){return e.concat(t.indices)},[]),(r=this.tableSchemas.find(function(t){return t.name===e}))?(i=n.filter(function(n){return n.tableName===e&&!!n.columns.find(function(e){return e.databaseName===t})})).length?0===(o=r.indices.filter(function(e){return!!i.find(function(t){return e.name===t.name})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping related indices of "+e+"#"+t+": "+o.map(function(e){return e.name}).join(", ")),a=o.map(function(e){return r.removeIndex(e),s.queryRunner.dropIndex(r.name,e.name)}),[4,Promise.all(a)]):[2]:[2];case 1:return u.sent(),[2]}})})},e.prototype.dropColumnReferencedForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=this.connection.entityMetadatas.reduce(function(e,t){return e.concat(t.foreignKeys)},[]),(r=this.tableSchemas.find(function(t){return t.name===e}))?(o=n.filter(function(n){return n.tableName===e?!!n.columns.find(function(e){return e.databaseName===t}):n.referencedTableName===e&&!!n.referencedColumns.find(function(e){return e.databaseName===t})})).length?0===(a=o.filter(function(e){return!!r.foreignKeys.find(function(t){return t.name===e.name})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping related foreign keys of "+e+"#"+t+": "+a.map(function(e){return e.name}).join(", ")),s=a.map(function(e){return i.ForeignKeySchema.create(e)}),r.removeForeignKeys(s),[4,this.queryRunner.dropForeignKeys(r,s)]):[2]:[2];case 1:return u.sent(),[2]}})})},e.prototype.metadataColumnsToColumnSchemas=function(e){var t=this;return e.map(function(e){return r.ColumnSchema.create(e,t.connection.driver.normalizeType(e),t.connection.driver.normalizeDefault(e))})},e}(),e("RdbmsSchemaBuilder",u)}}}),System.register("typeorm/driver/sqlserver/SqlServerConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/sqlserver/SqlServerDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/sqlserver/SqlServerQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){if(this.supportedDataTypes=["bigint","bit","decimal","int","money","numeric","smallint","smallmoney","tinyint","float","real","date","datetime2","datetime","datetimeoffset","smalldatetime","time","char","text","varchar","nchar","ntext","nvarchar","binary","image","varbinary","cursor","hierarchyid","sql_variant","table","timestamp","uniqueidentifier","xml"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"getdate()",updateDate:"datetime",updateDateDefault:"getdate()",version:"int",treeLevel:"int",migrationName:"varchar",migrationTimestamp:"bigint"},this.connection=e,this.options=e.options,Object.assign(e.options,i.DriverUtils.buildDriverOptions(e.options)),!this.options.host)throw new a.DriverOptionNotSetError("host");if(!this.options.username)throw new a.DriverOptionNotSetError("username");if(!this.options.database)throw new a.DriverOptionNotSetError("database");this.loadDependencies()}return e.prototype.connect=function(){var e=this,t=Object.assign({},{server:this.options.host,user:this.options.username,password:this.options.password,database:this.options.database,port:this.options.port},this.options.extra||{});return t.options?t.options.useUTC||(t.options.useUTC=!1):t.options={useUTC:!1},new Promise(function(n,r){var i=new e.mssql.ConnectionPool(t).connect(function(t){if(t)return r(t);e.connectionPool=i,n()})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.connectionPool?(this.connectionPool.close(),this.connectionPool=void 0,[2]):[2,Promise.reject(new n.ConnectionIsNotSetError("mssql"))]})})},e.prototype.createSchemaBuilder=function(){return new c.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(){return new o.SqlServerQueryRunner(this)},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"@"+(n.length-1)}).join(", "):(n.push(r),"@"+(n.length-1))}),[e,n]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.preparePersistentValue=function(e,t){return null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?s.DateUtils.mixedDateToDateString(e):"time"===t.type?s.DateUtils.mixedDateToTimeString(e):"datetime"===t.type?s.DateUtils.mixedDateToUtcDatetimeString(e):"json"===t.type?JSON.stringify(e):"simple-array"===t.type?s.DateUtils.simpleArrayToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return t.type===Boolean?!!e:"datetime"===t.type?s.DateUtils.normalizeHydratedDate(e):"date"===t.type?s.DateUtils.mixedDateToDateString(e):"time"===t.type?s.DateUtils.mixedTimeToString(e):"json"===t.type?JSON.parse(e):"simple-array"===t.type?s.DateUtils.stringToSimpleArray(e):e},e.prototype.normalizeType=function(e){var t="";return e.type===Number?t+="int":e.type===String?t+="nvarchar":e.type===Date?t+="datetime":e.type===Boolean?t+="bit":e.type===Object?t+="ntext":"simple-array"===e.type?t+="ntext":t+=e.type,"integer"===t&&(t="int"),e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale&&(t+="("+e.scale+")"),"varchar"!==t&&"nvarchar"!==t||(t+="(255)"),t},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"1":"0":"function"==typeof e.default?"("+e.default()+")":"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.loadDependencies=function(){try{this.mssql=u.PlatformTools.load("mssql")}catch(e){throw new r.DriverPackageNotInstalledError("SQL Server","mssql")}},e}(),e("SqlServerDriver",l)}}}),System.register("typeorm/query-builder/error/PessimisticLockTransactionRequiredError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name="PessimisticLockTransactionRequiredError",Object.setPrototypeOf(n,t.prototype),n.message="An open transaction is required for pessimistic lock.",n}return __extends(t,e),t}(Error),e("PessimisticLockTransactionRequiredError",n)}}}),System.register("typeorm/query-builder/error/NoVersionOrUpdateDateColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(n){var r=e.call(this)||this;return r.name="NoVersionOrUpdateDateColumnError",Object.setPrototypeOf(r,t.prototype),r.message="Entity "+n+" does not have version or update date columns.",r}return __extends(t,e),t}(Error),e("NoVersionOrUpdateDateColumnError",n)}}}),System.register("typeorm/query-builder/error/OptimisticLockVersionMismatchError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(n,r,i){var o=e.call(this)||this;return o.name="OptimisticLockVersionMismatchError",Object.setPrototypeOf(o,t.prototype),o.message="The optimistic lock on entity "+n+" failed, version "+r+" was expected, but is actually "+i+".",o}return __extends(t,e),t}(Error),e("OptimisticLockVersionMismatchError",n)}}}),System.register("typeorm/query-builder/error/OptimisticLockCanNotBeUsedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name="OptimisticLockCanNotBeUsedError",Object.setPrototypeOf(n,t.prototype),n.message="The optimistic lock can be used only with getOne() method.",n}return __extends(t,e),t}(Error),e("OptimisticLockCanNotBeUsedError",n)}}}),System.register("typeorm/query-builder/relation-id/RelationIdLoader",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}return e.prototype.load=function(e){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(r){return t=this.relationIdAttributes.map(function(t){return __awaiter(n,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,d,p,m,f,y,h,g,v,b,E,_,N,C;return __generator(this,function(T){switch(T.label){case 0:if(!t.relation.isManyToOne&&!t.relation.isOneToOneOwner)return[3,1];if(t.queryBuilderFactory)throw new Error("Additional condition can not be used with ManyToOne or OneToOne owner relations.");return n=e.map(function(e){var n={};return t.relation.joinColumns.forEach(function(r){n[r.databaseName]=e[t.parentAlias+"_"+r.databaseName]}),t.relation.entityMetadata.primaryColumns.forEach(function(r){n[r.databaseName]=e[t.parentAlias+"_"+r.databaseName]}),n}),[2,{relationIdAttribute:t,results:n}];case 1:return t.relation.isOneToMany||t.relation.isOneToOneNotOwner?(l=t.relation,r=l.isOwning?l.joinColumns:l.inverseRelation.joinColumns,i=l.inverseEntityMetadata.target,o=l.inverseEntityMetadata.tableName,a=t.alias||o,s={},(_=e.map(function(e,n){return r.map(function(r){var i=r.databaseName+n;return s[i]=e[t.parentAlias+"_"+r.referencedColumn.databaseName],a+"."+r.propertyPath+" = :"+i}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR "))?(u=this.connection.createQueryBuilder(this.queryRunner),r.forEach(function(e){u.addSelect(a+"."+e.propertyPath,e.databaseName)}),l.inverseRelation.entityMetadata.primaryColumns.forEach(function(e){u.addSelect(a+"."+e.propertyPath,e.databaseName)}),u.from(i,a).where("("+_+")").setParameters(s),t.queryBuilderFactory&&t.queryBuilderFactory(u),c={relationIdAttribute:t},[4,u.getRawMany()]):[2,{relationIdAttribute:t,results:[]}]):[3,3];case 2:return[2,(c.results=T.sent(),c)];case 3:return l=t.relation,d=l.isOwning?l.joinColumns:l.inverseRelation.inverseJoinColumns,p=l.isOwning?l.inverseJoinColumns:l.inverseRelation.joinColumns,m=t.junctionAlias,f=t.joinInverseSideMetadata.tableName,y=t.alias||f,h=l.junctionEntityMetadata.tableName,0===(g=e.map(function(e){return d.reduce(function(n,r){return n[r.propertyPath]=e[t.parentAlias+"_"+r.referencedColumn.databaseName],n},{})})).length?[2,{relationIdAttribute:t,results:[]}]:(v={},b=g.map(function(e,t){return Object.keys(e).map(function(n){var r=n+t;return v[r]=e[n],m+"."+n+" = :"+r}).join(" AND ")}),E=p.map(function(e){return m+"."+e.propertyPath+" = "+y+"."+e.referencedColumn.propertyPath}).join(" AND "),_=b.map(function(e){return"("+e+" AND "+E+")"}).join(" OR "),N=this.connection.createQueryBuilder(this.queryRunner),p.forEach(function(e){N.addSelect(m+"."+e.propertyPath,e.databaseName).addOrderBy(m+"."+e.propertyPath)}),d.forEach(function(e){N.addSelect(m+"."+e.propertyPath,e.databaseName).addOrderBy(m+"."+e.propertyPath)}),N.from(f,y).innerJoin(h,m,_).setParameters(v),t.queryBuilderFactory&&t.queryBuilderFactory(N),C={relationIdAttribute:t},[4,N.getRawMany()]);case 4:return[2,(C.results=T.sent(),C)]}})})}),[2,Promise.all(t)]})})},e}(),e("RelationIdLoader",n)}}}),System.register("typeorm/query-builder/relation-id/RelationIdMetadataToAttributeTransformer",["typeorm/query-builder/relation-id/RelationIdAttribute"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationIdAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationIds.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationIdAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new n.RelationIdAttribute(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),e("RelationIdMetadataToAttributeTransformer",r)}}}),System.register("typeorm/query-builder/relation-count/RelationCountLoader",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationCountAttributes=n}return e.prototype.load=function(e){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(r){return t=this.relationCountAttributes.map(function(t){return __awaiter(n,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,d,p,m,f,y,h,g,v,b;return __generator(this,function(E){switch(E.label){case 0:return t.relation.isOneToMany?(n=t.relation,r=n.inverseRelation,i=r.joinColumns[0].referencedColumn.propertyName,o=n.inverseEntityMetadata.target,f=n.inverseEntityMetadata.tableName,y=t.alias||f,a=r.propertyName,0===(p=e.map(function(e){return e[t.parentAlias+"_"+i]}).filter(function(e){return!!e})).length?[2,{relationCountAttribute:t,results:[]}]:((v=this.connection.createQueryBuilder(this.queryRunner)).select(y+"."+a,"parentId").addSelect("COUNT("+v.escape(y)+"."+v.escape(i)+")","cnt").from(o,y).where(y+"."+a+" IN (:ids)").addGroupBy(y+"."+a).setParameter("ids",p),t.queryBuilderFactory&&t.queryBuilderFactory(v),s={relationCountAttribute:t},[4,v.getRawMany()])):[3,2];case 1:return[2,(s.results=E.sent(),s)];case 2:return c=void 0,l=void 0,d=void 0,t.relation.isOwning?(u=t.relation.joinColumns[0].referencedColumn.databaseName,c=t.relation.inverseJoinColumns[0].referencedColumn.databaseName,l=t.relation.junctionEntityMetadata.columns[0],d=t.relation.junctionEntityMetadata.columns[1]):(u=t.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,c=t.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,l=t.relation.junctionEntityMetadata.columns[1],d=t.relation.junctionEntityMetadata.columns[0]),0===(p=e.map(function(e){return e[t.parentAlias+"_"+u]}).filter(function(e){return e})).length?[2,{relationCountAttribute:t,results:[]}]:(m=t.junctionAlias,f=t.joinInverseSideMetadata.tableName,y=t.alias||f,h=t.relation.junctionEntityMetadata.tableName,g=m+"."+l.propertyName+" IN ("+p+") AND "+m+"."+d.propertyName+" = "+y+"."+c,(v=this.connection.createQueryBuilder(this.queryRunner)).select(m+"."+l.propertyName,"parentId").addSelect("COUNT("+v.escape(y)+"."+v.escape(c)+")","cnt").from(f,y).innerJoin(h,m,g).addGroupBy(m+"."+l.propertyName),t.queryBuilderFactory&&t.queryBuilderFactory(v),b={relationCountAttribute:t},[4,v.getRawMany()]);case 3:return[2,(b.results=E.sent(),b)]}})})}),[2,Promise.all(t)]})})},e}(),e("RelationCountLoader",n)}}}),System.register("typeorm/metadata-args/RelationCountMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationCountMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationCount decorator.");this.relation=t},e}(),e("RelationCountMetadata",n)}}}),System.register("typeorm/query-builder/relation-count/RelationCountMetadataToAttributeTransformer",["typeorm/query-builder/relation-count/RelationCountAttribute"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationCountAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationCounts.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationCountAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new n.RelationCountAttribute(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),e("RelationCountMetadataToAttributeTransformer",r)}}}),System.register("typeorm/query-builder/error/LockNotSupportedOnGivenDriverError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name="LockNotSupportedOnGivenDriverError",Object.setPrototypeOf(n,t.prototype),n.message="Locking not supported on giver driver.",n}return __extends(t,e),t}(Error),e("LockNotSupportedOnGivenDriverError",n)}}}),System.register("typeorm/driver/mysql/MysqlQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){this.driver=e,this.isReleased=!1,this.isTransactionActive=!1,this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.connection=e.connection,this.manager=e.connection.manager}return e.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(this.databaseConnectionPromise=new Promise(function(t,n){e.driver.pool.getConnection(function(r,i){e.databaseConnection=i,r?n(r):t(i)})}),this.databaseConnectionPromise)},e.prototype.release=function(){return this.isReleased=!0,this.databaseConnection&&this.databaseConnection.release(),Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){return __awaiter(n,void 0,void 0,function(){var n,o=this;return __generator(this,function(a){switch(a.label){case 0:return[4,this.connect()];case 1:return n=a.sent(),this.driver.connection.logger.logQuery(e,t,this),n.query(e,t,function(n,a){if(n)return o.driver.connection.logger.logFailedQuery(e,t,o),o.driver.connection.logger.logQueryError(n,o),i(n);r(a)}),[2]}})})})},e.prototype.stream=function(e,t,n,r){var i=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(o,a){return __awaiter(i,void 0,void 0,function(){var i,a;return __generator(this,function(s){switch(s.label){case 0:return[4,this.connect()];case 1:return i=s.sent(),this.driver.connection.logger.logQuery(e,t,this),a=i.query(e,t),n&&a.on("end",n),r&&a.on("error",r),o(a),[2]}})})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=Object.keys(t),i=r.map(function(e){return"`"+e+"`"}).join(", "),o=r.map(function(e){return"?"}).join(","),a=r.map(function(e){return t[e]}),s="INSERT INTO `"+e+"`("+i+") VALUES ("+o+")",[4,this.query(s,a)];case 1:return u=c.sent(),[2,n?u.insertId:void 0]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=this.parametrize(t).join(", "),i=this.parametrize(n).join(" AND "),o="UPDATE `"+e+"` SET "+r+" "+(i?" WHERE "+i:""),a=Object.keys(n).map(function(e){return n[e]}),s=Object.keys(t).map(function(e){return t[e]}),u=s.concat(a),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o="DELETE FROM `"+e+"` WHERE "+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return r?[4,this.query("INSERT INTO `"+e+"`(`ancestor`, `descendant`, `level`) SELECT `ancestor`, "+t+", `level` + 1 FROM `"+e+"` WHERE `descendant` = "+n+" UNION ALL SELECT "+t+", "+t+", 1")]:[3,2];case 1:return o.sent(),[3,4];case 2:return[4,this.query("INSERT INTO `"+e+"`(`ancestor`, `descendant`) SELECT `ancestor`, "+t+" FROM `"+e+"` WHERE `descendant` = "+n+" UNION ALL SELECT "+t+", "+t)];case 3:o.sent(),o.label=4;case 4:return[4,this.query("SELECT MAX(`level`) as `level` FROM `"+e+"` WHERE `descendant` = "+n)];case 5:return i=o.sent(),[2,i&&i[0]&&i[0].level?parseInt(i[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,c,l,d,p,m,f,y,h=this;return __generator(this,function(g){switch(g.label){case 0:if(this.sqlMemoryMode)throw new Error("Loading table schema is not supported in sql memory mode");return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = '"+this.dbName+"' AND TABLE_NAME IN ("+t+")",r="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+this.dbName+"'",c="SELECT * FROM INFORMATION_SCHEMA.STATISTICS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND INDEX_NAME != 'PRIMARY'",l="SELECT * FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = '"+this.dbName+"' AND REFERENCED_COLUMN_NAME IS NOT NULL",[4,Promise.all([this.query(n),this.query(r),this.query(c),this.query(l)])]):[2,[]];case 1:return d=g.sent(),p=d[0],m=d[1],f=d[2],y=d[3],p.length?[2,Promise.all(p.map(function(e){return __awaiter(h,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t=new o.TableSchema(e.TABLE_NAME),[4,this.query("SHOW INDEX FROM `"+e.TABLE_NAME+"` WHERE Key_name = 'PRIMARY'")];case 1:return n=r.sent(),t.columns=m.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var t=new i.ColumnSchema;return t.name=e.COLUMN_NAME,t.type=e.COLUMN_TYPE.toLowerCase(),t.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,t.isNullable="YES"===e.IS_NULLABLE,t.isPrimary=-1!==e.COLUMN_KEY.indexOf("PRI"),t.isUnique=-1!==e.COLUMN_KEY.indexOf("UNI"),t.isGenerated=-1!==e.EXTRA.indexOf("auto_increment"),t.comment=e.COLUMN_COMMENT,t.precision=e.NUMERIC_PRECISION,t.scale=e.NUMERIC_SCALE,t}),t.primaryKeys=n.map(function(e){return new s.PrimaryKeySchema(e.Key_name,e.Column_name)}),t.foreignKeys=y.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){return new a.ForeignKeySchema(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=f.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=f.filter(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===n}),i=r.map(function(e){return e.COLUMN_NAME});if(1===r.length&&0===r[0].NON_UNIQUE){var o=t.columns.find(function(e){return e.name===r[0].INDEX_NAME&&e.name===r[0].COLUMN_NAME});if(o)return void(o.isUnique=!0)}return new u.IndexSchema(e.TABLE_NAME,n,i,!1)}).filter(function(e){return!!e}),[2,t]}})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:return t=e instanceof o.TableSchema?e.name:e,n="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND TABLE_NAME = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=e instanceof o.TableSchema?e.name:e,r=t instanceof i.ColumnSchema?t.name:t,a="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND TABLE_NAME = '"+n+"' AND COLUMN_NAME = '"+r+"'",[4,this.query(a)];case 1:return s=u.sent(),[2,!!s.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(a){return t=e.columns.map(function(e){return o.buildCreateColumnSql(e,!1)}).join(", "),n="CREATE TABLE `"+e.name+"` ("+t,(r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return"`"+e.name+"`"}).join(", ")+")"),n+=") ENGINE="+(e.engine||"InnoDB"),i="DROP TABLE `"+e.name+"`",[2,this.schemaQuery(n,i)]})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){return t=e instanceof o.TableSchema?e.name:e,n="DROP TABLE `"+t+"`",[2,this.query(n)]})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(a){return n=e instanceof o.TableSchema?e.name:e,r="ALTER TABLE `"+n+"` ADD "+this.buildCreateColumnSql(t,!1),i="ALTER TABLE `"+n+"` DROP `"+t.name+"`",[2,this.schemaQuery(r,i)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof o.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:if(!(r=u.sent()))throw new Error("Table "+e+" was not found.");u.label=3;case 3:if(a=void 0,!(a=t instanceof i.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof i.ColumnSchema?s=n:(s=a.clone()).name=n,[2,this.changeColumn(r,a,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=void 0,e instanceof o.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=c.sent(),c.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return!1!==n.isUnique||!0!==a.isUnique?[3,5]:[4,this.query("ALTER TABLE `"+r.name+"` DROP INDEX `"+a.name+"`")];case 4:c.sent(),c.label=5;case 5:return s="ALTER TABLE `"+r.name+"` CHANGE `"+a.name+"` "+this.buildCreateColumnSql(n,a.isPrimary),u="ALTER TABLE `"+r.name+"` CHANGE `"+a.name+"` "+this.buildCreateColumnSql(a,a.isPrimary),[2,this.schemaQuery(s,u)]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n="ALTER TABLE `"+e.name+"` DROP `"+t.name+"`",r="ALTER TABLE `"+e.name+"` ADD "+this.buildCreateColumnSql(t,!1),[2,this.schemaQuery(n,r)]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:return e.hasGeneratedColumn?[3,2]:[4,this.query("ALTER TABLE `"+e.name+"` DROP PRIMARY KEY")];case 1:i.sent(),i.label=2;case 2:return t=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}).map(function(e){return"`"+e.name+"`"}),t.length>0?(n="ALTER TABLE `"+e.name+"` ADD PRIMARY KEY ("+t.join(", ")+")",r="ALTER TABLE `"+e.name+"` DROP PRIMARY KEY",[2,this.schemaQuery(n,r)]):[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,a,s;return __generator(this,function(u){return n=e instanceof o.TableSchema?e.name:e,r=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),i=t.referencedColumnNames.map(function(e){return"`"+e+"`"}).join(","),a="ALTER TABLE `"+n+"` ADD CONSTRAINT `"+t.name+"` FOREIGN KEY ("+r+") REFERENCES `"+t.referencedTableName+"`("+i+")",t.onDelete&&(a+=" ON DELETE "+t.onDelete),s="ALTER TABLE `"+n+"` DROP FOREIGN KEY `"+t.name+"`",[2,this.schemaQuery(a,s)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,a,s;return __generator(this,function(u){return n=e instanceof o.TableSchema?e.name:e,r="ALTER TABLE `"+n+"` DROP FOREIGN KEY `"+t.name+"`",i=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),a=t.referencedColumnNames.map(function(e){return"`"+e+"`"}).join(","),s="ALTER TABLE `"+n+"` ADD CONSTRAINT `"+t.name+"` FOREIGN KEY ("+i+") REFERENCES `"+t.referencedTableName+"`("+a+")",t.onDelete&&(s+=" ON DELETE "+t.onDelete),[2,this.schemaQuery(r,s)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,a;return __generator(this,function(s){switch(s.label){case 0:return n=e instanceof o.TableSchema?e.name:e,r=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),i="CREATE "+(t.isUnique?"UNIQUE ":"")+"INDEX `"+t.name+"` ON `"+n+"`("+r+")",a="ALTER TABLE `"+n+"` DROP INDEX `"+t.name+"`",[4,this.schemaQuery(i,a)];case 1:return s.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,a,s;return __generator(this,function(c){switch(c.label){case 0:return n=e instanceof o.TableSchema?e.name:e,r=t instanceof u.IndexSchema?t.name:t,i="ALTER TABLE `"+n+"` DROP INDEX `"+r+"`",t instanceof u.IndexSchema?(a=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),s="CREATE "+(t.isUnique?"UNIQUE ":"")+"INDEX `"+t.name+"` ON `"+n+"`("+a+")",[4,this.schemaQuery(i,s)]):[3,2];case 1:return c.sent(),[3,4];case 2:return[4,this.query(i)];case 3:c.sent(),c.label=4;case 4:return[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=e instanceof o.TableSchema?e.name:e,[4,this.query("TRUNCATE TABLE `"+t+"`")];case 1:return n.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return[4,this.startTransaction()];case 1:s.sent(),s.label=2;case 2:return s.trys.push([2,8,,13]),e="SET FOREIGN_KEY_CHECKS = 0;",t="SELECT concat('DROP TABLE IF EXISTS ', table_name, ';') AS query FROM information_schema.tables WHERE table_schema = '"+this.dbName+"'",n="SET FOREIGN_KEY_CHECKS = 1;",[4,this.query(e)];case 3:return s.sent(),[4,this.query(t)];case 4:return r=s.sent(),[4,Promise.all(r.map(function(e){return a.query(e.query)}))];case 5:return s.sent(),[4,this.query(n)];case 6:return s.sent(),[4,this.commitTransaction()];case 7:return s.sent(),[3,13];case 8:i=s.sent(),s.label=9;case 9:return s.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return s.sent(),[3,12];case 11:return o=s.sent(),[3,12];case 12:throw i;case 13:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.schemaQuery=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return!0===this.sqlMemoryMode?(this.sqlsInMemory.push({up:e,down:t}),[2,Promise.resolve()]):[4,this.query(e)];case 1:return n.sent(),[2]}})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.database},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e){return Object.keys(e).map(function(e){return"`"+e+"`=?"})},e.prototype.buildCreateColumnSql=function(e,t){var n="`"+e.name+"` "+e.type;return e.enum&&(n+="("+e.enum.map(function(e){return"'"+e+"'"}).join(", ")+")"),!0!==e.isNullable&&(n+=" NOT NULL"),!0===e.isUnique&&(n+=" UNIQUE"),e.isGenerated&&e.isPrimary&&!t&&(n+=" PRIMARY KEY"),!0===e.isGenerated&&(n+=" AUTO_INCREMENT"),e.comment&&(n+=" COMMENT '"+e.comment+"'"),void 0!==e.default&&null!==e.default&&(n+=" DEFAULT "+e.default),n},e}(),e("MysqlQueryRunner",l)}}}),System.register("typeorm/driver/mysql/MysqlConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/mysql/MysqlDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/mysql/MysqlQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){if(this.supportedDataTypes=["int","tinyint","smallint","mediumint","bigint","float","double","decimal","date","datetime","timestamp","time","year","char","varchar","blob","text","tinyblob","tinytext","mediumblob","mediumtext","longblob","longtext","enum","json"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"CURRENT_TIMESTAMP",updateDate:"datetime",updateDateDefault:"CURRENT_TIMESTAMP",version:"int",treeLevel:"int",migrationName:"varchar",migrationTimestamp:"bigint"},this.connection=e,this.options=e.options,Object.assign(e.options,i.DriverUtils.buildDriverOptions(e.options)),!(this.options.host||this.options.extra&&this.options.extra.socketPath))throw new a.DriverOptionNotSetError("socketPath and host");if(!this.options.username)throw new a.DriverOptionNotSetError("username");if(!this.options.database)throw new a.DriverOptionNotSetError("database");this.loadDependencies()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return e=Object.assign({},{host:this.options.host,user:this.options.username,password:this.options.password,database:this.options.database,port:this.options.port},this.options.extra||{}),this.pool=this.mysql.createPool(e),[2]})})},e.prototype.disconnect=function(){var e=this;return this.pool?new Promise(function(t,n){e.pool.end(function(e){return e?n(e):t()}),e.pool=void 0}):Promise.reject(new n.ConnectionIsNotSetError("mysql"))},e.prototype.createSchemaBuilder=function(){return new c.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(){return new o.MysqlQueryRunner(this)},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){return n.push(t[e.substr(1)]),"?"}),[e,n]},e.prototype.escape=function(e){return"`"+e+"`"},e.prototype.preparePersistentValue=function(e,t){return null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?s.DateUtils.mixedDateToDateString(e):"time"===t.type?s.DateUtils.mixedDateToTimeString(e):"datetime"===t.type?s.DateUtils.mixedDateToUtcDatetimeString(e):"json"===t.type?JSON.stringify(e):"simple-array"===t.type?s.DateUtils.simpleArrayToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return t.type===Boolean?!!e:"datetime"===t.type?s.DateUtils.normalizeHydratedDate(e):"date"===t.type?s.DateUtils.mixedDateToDateString(e):"time"===t.type?s.DateUtils.mixedTimeToString(e):"json"===t.type?JSON.parse(e):"simple-array"===t.type?s.DateUtils.stringToSimpleArray(e):e},e.prototype.normalizeType=function(e){var t="";return e.type===Number?t+="int":e.type===String?t+="varchar":e.type===Date?t+="datetime":e.type===Boolean?t+="tinyint(1)":e.type===Object?t+="text":"simple-array"===e.type?t+="text":t+=e.type,"integer"===t&&(t="int"),e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale&&(t+="("+e.scale+")"),"varchar"===t&&(t+="(255)"),"int"===t&&(t+="(11)"),"tinyint"===t&&(t+="(4)"),"smallint"===t&&(t+="(5)"),"mediumint"===t&&(t+="(9)"),"bigint"===t&&(t+="(20)"),"year"===t&&(t+="(4)"),t},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"1":"0":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.loadDependencies=function(){try{this.mysql=u.PlatformTools.load("mysql")}catch(e){try{this.mysql=u.PlatformTools.load("mysql2")}catch(e){throw new r.DriverPackageNotInstalledError("Mysql","mysql")}}},e}(),e("MysqlDriver",l)}}}),System.register("typeorm/driver/postgres/PostgresQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){this.driver=e,this.isReleased=!1,this.isTransactionActive=!1,this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.connection=e.connection,this.manager=e.connection.manager}return e.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(this.databaseConnectionPromise=new Promise(function(t,n){e.driver.pool.connect(function(r,i,o){if(r)return n(r);e.driver.connectedQueryRunners.push(e),e.databaseConnection=i,e.releaseCallback=o,i.query("SET search_path TO '"+e.schemaName+"', 'public';",function(r){r?(e.driver.connection.logger.logFailedQuery("SET search_path TO '"+e.schemaName+"', 'public';",[],e),e.driver.connection.logger.logQueryError(r,e),n(r)):t(i)})})}),this.databaseConnectionPromise)},e.prototype.release=function(){this.isReleased=!0,this.releaseCallback&&this.releaseCallback();var e=this.driver.connectedQueryRunners.indexOf(this);return-1!==e&&this.driver.connectedQueryRunners.splice(e),Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){return __awaiter(n,void 0,void 0,function(){var n,o=this;return __generator(this,function(a){switch(a.label){case 0:return[4,this.connect()];case 1:return n=a.sent(),this.driver.connection.logger.logQuery(e,t,this),n.query(e,t,function(n,a){n?(o.driver.connection.logger.logFailedQuery(e,t,o),o.driver.connection.logger.logQueryError(n,o),i(n)):r(a.rows)}),[2]}})})})},e.prototype.stream=function(e,t,n,r){var i=this,o=this.driver.loadStreamDependency();if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(a,s){return __awaiter(i,void 0,void 0,function(){var i,s;return __generator(this,function(u){switch(u.label){case 0:return[4,this.connect()];case 1:return i=u.sent(),this.driver.connection.logger.logQuery(e,t,this),s=i.query(new o(e,t)),n&&s.on("end",n),r&&s.on("error",r),a(s),[2]}})})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=Object.keys(t),i=r.map(function(e){return'"'+e+'"'}).join(", "),o=r.map(function(e,t){return"$"+(t+1)}).join(","),a=i.length>0?'INSERT INTO "'+e+'"('+i+") VALUES ("+o+") "+(n?' RETURNING "'+n.databaseName+'"':""):'INSERT INTO "'+e+'" DEFAULT VALUES '+(n?' RETURNING "'+n.databaseName+'"':""),s=r.map(function(e){return t[e]}),[4,this.query(a,s)];case 1:return u=c.sent(),n?[2,u[0][n.databaseName]]:[2,u]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=this.parametrize(t).join(", "),i=this.parametrize(n,Object.keys(t).length).join(" AND "),o='UPDATE "'+e+'" SET '+r+" "+(i?" WHERE "+i:""),a=Object.keys(t).map(function(e){return t[e]}),s=Object.keys(n).map(function(e){return n[e]}),u=a.concat(s),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o='DELETE FROM "'+e+'" WHERE '+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i="",i=r?'INSERT INTO "'+e+'"("ancestor", "descendant", "level") SELECT "ancestor", '+t+', "level" + 1 FROM "'+e+'" WHERE "descendant" = '+n+" UNION ALL SELECT "+t+", "+t+", 1":'INSERT INTO "'+e+'"("ancestor", "descendant") SELECT "ancestor", '+t+' FROM "'+e+'" WHERE "descendant" = '+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+e+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,c,l,d,p,m,f,y,h,g,v,b;return __generator(this,function(E){switch(E.label){case 0:return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT * FROM information_schema.tables WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND table_name IN ("+t+")",r="SELECT * FROM information_schema.columns WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"'",c="SELECT t.relname AS table_name, i.relname AS index_name, a.attname AS column_name  FROM pg_class t, pg_class i, pg_index ix, pg_attribute a, pg_namespace ns\nWHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid\nAND a.attnum = ANY(ix.indkey) AND t.relkind = 'r' AND t.relname IN ("+t+") AND t.relnamespace = ns.OID AND ns.nspname ='"+this.schemaName+"' ORDER BY t.relname, i.relname",l="SELECT table_name, constraint_name FROM information_schema.table_constraints WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND constraint_type = 'FOREIGN KEY'",d="SELECT * FROM information_schema.table_constraints WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND constraint_type = 'UNIQUE'",p="SELECT c.column_name, tc.table_name, tc.constraint_name FROM information_schema.table_constraints tc\nJOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_name)\nJOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name\nwhere constraint_type = 'PRIMARY KEY' AND c.table_schema = '"+this.schemaName+"' and tc.table_catalog = '"+this.dbName+"'",[4,Promise.all([this.query(n),this.query(r),this.query(c),this.query(l),this.query(d),this.query(p)])]):[2,[]];case 1:return m=E.sent(),f=m[0],y=m[1],h=m[2],g=m[3],v=m[4],b=m[5],f.length?[2,f.map(function(e){var t=new o.TableSchema(e.table_name);return t.columns=y.filter(function(e){return e.table_name===t.name}).map(function(e){var t=e.data_type.toLowerCase()+(void 0!==e.character_maximum_length&&null!==e.character_maximum_length?"("+e.character_maximum_length+")":""),n=e.column_default==="nextval('"+e.table_name+"_id_seq'::regclass)"||e.column_default==="nextval('\""+e.table_name+"_id_seq\"'::regclass)"||/^uuid\_generate\_v\d\(\)/.test(e.column_default),r=new i.ColumnSchema;return r.name=e.column_name,r.type=t,r.default=null!==e.column_default&&void 0!==e.column_default?e.column_default.replace(/::character varying/,""):void 0,r.isNullable="YES"===e.is_nullable,r.isGenerated=n,r.comment="",r.isUnique=!!v.find(function(t){return t.constraint_name==="uk_"+e.table_name+"_"+e.column_name}),r}),t.primaryKeys=b.filter(function(e){return e.table_name===t.name}).map(function(e){return new u.PrimaryKeySchema(e.constraint_name,e.column_name)}),t.foreignKeys=g.filter(function(e){return e.table_name===t.name}).map(function(e){return new s.ForeignKeySchema(e.constraint_name,[],[],"","")}),t.indices=h.filter(function(e){return e.table_name===t.name&&!t.foreignKeys.find(function(t){return t.name===e.index_name})&&!t.primaryKeys.find(function(t){return t.name===e.index_name})&&!v.find(function(t){return t.constraint_name===e.index_name})}).map(function(e){return e.index_name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=h.filter(function(e){return e.table_name===t.name&&e.index_name===n}).map(function(e){return e.column_name});return new a.IndexSchema(e.TABLE_NAME,n,r,!1)}),t})]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM information_schema.tables WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND table_name = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.columns.map(function(e){return i.buildCreateColumnSql(e,!1)}).join(", "),[4,this.query('CREATE SCHEMA IF NOT EXISTS "'+this.schemaName+'"')];case 1:return o.sent(),n='CREATE TABLE "'+e.name+'" ('+t,n+=e.columns.filter(function(e){return e.isUnique}).map(function(t){return', CONSTRAINT "uk_'+e.name+"_"+t.name+'" UNIQUE ("'+t.name+'")'}).join(" "),(r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",[4,this.query(n)];case 2:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n="SELECT * FROM information_schema.columns WHERE table_catalog = '"+this.dbName+"' AND table_schema = '"+this.schemaName+"' AND table_name = '"+e+"' AND column_name = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof o.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD '+this.buildCreateColumnSql(t,!1),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof o.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof i.ColumnSchema?s=n:(s=a.clone()).name=n,[2,this.changeColumn(r,a,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof o.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return a.type===n.type&&a.name===n.name?[3,5]:(s='ALTER TABLE "'+r.name+'" ALTER COLUMN "'+a.name+'"',a.type!==n.type&&(s+=" TYPE "+n.type),a.name!==n.name&&(s+=" RENAME TO "+n.name),[4,this.query(s)]);case 4:u.sent(),u.label=5;case 5:return a.isNullable===n.isNullable?[3,7]:(s='ALTER TABLE "'+r.name+'" ALTER COLUMN "'+a.name+'"',n.isNullable?s+=" DROP NOT NULL":s+=" SET NOT NULL",[4,this.query(s)]);case 6:u.sent(),u.label=7;case 7:return a.isGenerated===n.isGenerated?[3,13]:a.isGenerated||"uuid"===n.type?[3,10]:[4,this.query('CREATE SEQUENCE "'+r.name+'_id_seq" OWNED BY "'+r.name+'"."'+a.name+'"')];case 8:return u.sent(),[4,this.query('ALTER TABLE "'+r.name+'" ALTER COLUMN "'+a.name+'" SET DEFAULT nextval(\'"'+r.name+"_id_seq\"')")];case 9:return u.sent(),[3,13];case 10:return[4,this.query('ALTER TABLE "'+r.name+'" ALTER COLUMN "'+a.name+'" DROP DEFAULT')];case 11:return u.sent(),[4,this.query('DROP SEQUENCE "'+r.name+'_id_seq"')];case 12:u.sent(),u.label=13;case 13:return a.comment===n.comment?[3,15]:[4,this.query('COMMENT ON COLUMN "'+r.name+'"."'+a.name+"\" is '"+n.comment+"'")];case 14:u.sent(),u.label=15;case 15:return a.isUnique===n.isUnique?[3,19]:!0!==n.isUnique?[3,17]:[4,this.query('ALTER TABLE "'+r.name+'" ADD CONSTRAINT "uk_'+n.name+'" UNIQUE ("'+n.name+'")')];case 16:return u.sent(),[3,19];case 17:return!1!==n.isUnique?[3,19]:[4,this.query('ALTER TABLE "'+r.name+'" DROP CONSTRAINT "uk_'+n.name+'"')];case 18:u.sent(),u.label=19;case 19:return n.default===a.default?[3,23]:null===n.default||void 0===n.default?[3,21]:[4,this.query('ALTER TABLE "'+r.name+'" ALTER COLUMN "'+n.name+'" SET DEFAULT '+n.default)];case 20:return u.sent(),[3,23];case 21:return null===a.default||void 0===a.default?[3,23]:[4,this.query('ALTER TABLE "'+r.name+'" ALTER COLUMN "'+n.name+'" DROP DEFAULT')];case 22:u.sent(),u.label=23;case 23:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.query('ALTER TABLE "'+e.name+'" DROP "'+t.name+'"')]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),[4,this.query('ALTER TABLE "'+e.name+'" DROP CONSTRAINT IF EXISTS "'+e.name+'_pkey"')];case 1:return n.sent(),[4,this.query('DROP INDEX IF EXISTS "'+e.name+'_pkey"')];case 2:return n.sent(),t.length>0?[4,this.query('ALTER TABLE "'+e.name+'" ADD PRIMARY KEY ('+t.join(", ")+")")]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof o.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ("'+t.columnNames.join('", "')+'") REFERENCES "'+t.referencedTableName+'"("'+t.referencedColumnNames.join('", "')+'")',t.onDelete&&(r+=" ON DELETE "+t.onDelete),[2,this.query(r)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof o.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" DROP CONSTRAINT "'+t.name+'"',[2,this.query(r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(","),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t,n){return void 0===n&&(n=!1),__awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return n?[4,this.query('ALTER SEQUENCE "'+e+'_id_seq" OWNED BY NONE')]:[3,2];case 1:i.sent(),i.label=2;case 2:return r='DROP INDEX "'+t+'"',[4,this.query(r)];case 3:return i.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query('TRUNCATE TABLE "'+e+'"')];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return[4,this.startTransaction()];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,6,,11]),e="SELECT 'DROP TABLE IF EXISTS \"' || tablename || '\" CASCADE;' as query FROM pg_tables WHERE schemaname = '"+this.schemaName+"'",[4,this.query(e)];case 3:return t=o.sent(),[4,Promise.all(t.map(function(e){return i.query(e.query)}))];case 4:return o.sent(),[4,this.commitTransaction()];case 5:return o.sent(),[3,11];case 6:n=o.sent(),o.label=7;case 7:return o.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:return o.sent(),[3,10];case 9:return r=o.sent(),[3,10];case 10:throw n;case 11:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.database},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schemaName",{get:function(){return this.driver.options.schemaName||"default"},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,n){return'"'+e+'"=$'+(t+n+1)})},e.prototype.buildCreateColumnSql=function(e,t){var n='"'+e.name+'"';return!0===e.isGenerated&&"uuid"!==e.type&&(n+=" SERIAL"),e.isGenerated&&"uuid"!==e.type||(n+=" "+e.type),!0!==e.isNullable&&(n+=" NOT NULL"),e.isGenerated&&(n+=" PRIMARY KEY"),void 0!==e.default&&null!==e.default&&(n+=" DEFAULT "+e.default),e.isGenerated&&"uuid"===e.type&&!e.default&&(n+=" DEFAULT uuid_generate_v4()"),n},e}(),e("PostgresQueryRunner",l)}}}),System.register("typeorm/driver/postgres/PostgresConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/postgres/PostgresDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/postgres/PostgresQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){if(this.connectedQueryRunners=[],this.supportedDataTypes=["smallint","integer","bigint","decimal","numeric","real","double precision","smallserial","serial","bigserial","money","character varying","varchar","character","char","text","bytea","timestamp","timestamp without time zone","timestamp with time zone","date","time","time without time zone","time with time zone","interval","boolean","enum","point","line","lseg","box","path","polygon","circle","cidr","inet","macaddr","tsvector","tsquery","uuid","xml","json","jsonb"],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"now()",updateDate:"timestamp",updateDateDefault:"now()",version:"int",treeLevel:"int",migrationName:"varchar",migrationTimestamp:"bigint"},this.connection=e,this.options=e.options,Object.assign(this.options,i.DriverUtils.buildDriverOptions(e.options)),!this.options.host)throw new a.DriverOptionNotSetError("host");if(!this.options.username)throw new a.DriverOptionNotSetError("username");if(!this.options.database)throw new a.DriverOptionNotSetError("database");this.loadDependencies()}return e.prototype.connect=function(){var e=Object.assign({},{host:this.options.host,user:this.options.username,password:this.options.password,database:this.options.database,port:this.options.port},this.options.extra||{});return this.pool=new this.postgres.Pool(e),Promise.resolve()},e.prototype.disconnect=function(){var e=this;return this.pool?new Promise(function(t,n){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(r){return e=function(e){return e?n(e):t()},this.pool.end(e),this.pool=void 0,t(),[2]})})}):Promise.reject(new n.ConnectionIsNotSetError("postgres"))},e.prototype.createSchemaBuilder=function(){return new c.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(){return new o.PostgresQueryRunner(this)},e.prototype.preparePersistentValue=function(e,t){return null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?s.DateUtils.mixedDateToDateString(e):"time"===t.type?s.DateUtils.mixedDateToTimeString(e):"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp without time zone"===t.type?s.DateUtils.mixedDateToUtcDatetimeString(e):"json"===t.type||"jsonb"===t.type?JSON.stringify(e):"simple-array"===t.type?s.DateUtils.simpleArrayToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return t.type===Boolean?!!e:"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp without time zone"===t.type?s.DateUtils.normalizeHydratedDate(e):"date"===t.type?s.DateUtils.mixedDateToDateString(e):"time"===t.type?s.DateUtils.mixedTimeToString(e):"simple-array"===t.type?s.DateUtils.stringToSimpleArray(e):e},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"$"+n.length}).join(", "):(n.push(r),"$"+n.length)}),[e,n]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.normalizeType=function(e){var t="";return e.type===Number?t+="integer":e.type===String?t+="character varying":e.type===Date?t+="timestamp":e.type===Boolean?t+="boolean":e.type===Object?t+="text":"simple-array"===e.type?t+="text":t+=e.type,"int"===t?t="integer":"timestamp"===t&&(t="timestamp without time zone"),e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale&&(t+="("+e.scale+")"),e.array&&(t+=" ARRAY"+("string"==typeof e.array?e.array:"")),t},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"true":"false":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.loadStreamDependency=function(){try{return u.PlatformTools.load("pg-query-stream")}catch(e){throw new Error("To use streams you should install pg-query-stream package. Please run npm i pg-query-stream --save command.")}},e.prototype.loadDependencies=function(){try{this.postgres=u.PlatformTools.load("pg")}catch(e){throw new r.DriverPackageNotInstalledError("Postgres","pg")}},e}(),e("PostgresDriver",l)}}}),System.register("typeorm/driver/oracle/OracleQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){this.driver=e,this.isReleased=!1,this.isTransactionActive=!1,this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.connection=e.connection,this.manager=e.connection.manager}return e.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(this.databaseConnectionPromise=new Promise(function(t,n){e.driver.pool.getConnection(function(r,i){e.databaseConnection=i,r?n(r):t(i)})}),this.databaseConnectionPromise)},e.prototype.release=function(){var e=this;return new Promise(function(t,n){e.isReleased=!0,e.databaseConnection&&e.databaseConnection.close(function(e){if(e)return n(e);t()})})},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){return __awaiter(n,void 0,void 0,function(){var n,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return this.driver.connection.logger.logQuery(e,t,this),n=function(n,o){if(n)return s.driver.connection.logger.logFailedQuery(e,t,s),s.driver.connection.logger.logQueryError(n,s),i(n);r(o.rows||o.outBinds)},o={autoCommit:!this.isTransactionActive},[4,this.connect()];case 1:return(a=u.sent()).execute(e,t||{},o,n),[2]}})})})},e.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by Oracle driver.")},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c;return __generator(this,function(l){switch(l.label){case 0:return r=Object.keys(t),i=r.map(function(e){return'"'+e+'"'}).join(", "),o=r.map(function(e){return":"+e}).join(", "),a=r.map(function(e){return t[e]}),s=i.length>0?'INSERT INTO "'+e+'" ('+i+") VALUES ("+o+")":'INSERT INTO "'+e+'" DEFAULT VALUES',n?(u="declare lastId number; begin "+s+' returning "id" into lastId; dbms_output.enable; dbms_output.put_line(lastId); dbms_output.get_line(:ln, :st); end;',[4,this.query(u,a.concat([{dir:this.driver.oracle.BIND_OUT,type:this.driver.oracle.STRING,maxSize:32767},{dir:this.driver.oracle.BIND_OUT,type:this.driver.oracle.NUMBER}]))]):[3,2];case 1:return c=l.sent(),[2,parseInt(c[0])];case 2:return[2,this.query(s,a)]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=this.parametrize(t).join(", "),i=this.parametrize(n).join(" AND "),o='UPDATE "'+e+'" SET '+r+" "+(i?" WHERE "+i:""),a=Object.keys(n).map(function(e){return n[e]}),s=Object.keys(t).map(function(e){return t[e]}),u=s.concat(a),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o='DELETE FROM "'+e+'" WHERE '+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i="",i=r?'INSERT INTO "'+e+'"("ancestor", "descendant", "level") SELECT "ancestor", '+t+', "level" + 1 FROM "'+e+'" WHERE "descendant" = '+n+" UNION ALL SELECT "+t+", "+t+", 1":'INSERT INTO "'+e+'" ("ancestor", "descendant") SELECT "ancestor", '+t+' FROM "'+e+'" WHERE "descendant" = '+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query('SELECT MAX("level") as "level" FROM "'+e+'" WHERE "descendant" = '+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,c,l,d,p,m,f,y,h,g;return __generator(this,function(v){switch(v.label){case 0:return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME IN ("+t+")",r="SELECT TABLE_NAME, COLUMN_NAME, DATA_TYPE, DATA_LENGTH, DATA_PRECISION, DATA_SCALE, NULLABLE, IDENTITY_COLUMN FROM all_tab_cols WHERE TABLE_NAME IN ("+t+")",c="SELECT ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS, LISTAGG(cols.COLUMN_NAME, ',') WITHIN GROUP (ORDER BY cols.COLUMN_NAME) AS COLUMN_NAMES\n                                FROM USER_INDEXES ind, USER_IND_COLUMNS cols \n                                WHERE ind.INDEX_NAME = cols.INDEX_NAME AND ind.TABLE_NAME IN ("+t+")\n                                GROUP BY ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS",l="SELECT * FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = '"+this.dbName+"' AND REFERENCED_COLUMN_NAME IS NOT NULL",d="SELECT * FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE TABLE_SCHEMA = '"+this.dbName+"' AND CONSTRAINT_TYPE = 'UNIQUE'",p="SELECT cols.table_name, cols.column_name, cols.position, cons.constraint_type, cons.constraint_name\nFROM all_constraints cons, all_cons_columns cols WHERE cols.table_name IN ("+t+") \nAND cons.constraint_name = cols.constraint_name AND cons.owner = cols.owner ORDER BY cols.table_name, cols.position",[4,Promise.all([this.query(n),this.query(r),this.query(c),this.query(p)])]):[2,[]];case 1:return m=v.sent(),f=m[0],y=m[1],h=m[2],g=m[3],f.length?[2,f.map(function(e){var t=new o.TableSchema(e.TABLE_NAME);return t.columns=y.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var n=!!g.find(function(n){return n.TABLE_NAME===t.name&&"P"===n.CONSTRAINT_TYPE&&n.COLUMN_NAME===e.COLUMN_NAME}),r=e.DATA_TYPE.toLowerCase();"varchar2"===e.DATA_TYPE.toLowerCase()&&null!==e.DATA_LENGTH?r+="("+e.DATA_LENGTH+")":null!==e.DATA_PRECISION&&null!==e.DATA_SCALE?r+="("+e.DATA_PRECISION+","+e.DATA_SCALE+")":null!==e.DATA_SCALE?r+="(0,"+e.DATA_SCALE+")":null!==e.DATA_PRECISION&&(r+="("+e.DATA_PRECISION+")");var o=new i.ColumnSchema;return o.name=e.COLUMN_NAME,o.type=r,o.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,o.isNullable="N"!==e.NULLABLE,o.isPrimary=n,o.isGenerated="YES"===e.IDENTITY_COLUMN,o.comment="",o}),t.primaryKeys=g.filter(function(e){return e.TABLE_NAME===t.name&&"P"===e.CONSTRAINT_TYPE}).map(function(e){return new s.PrimaryKeySchema(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),t.foreignKeys=g.filter(function(e){return e.TABLE_NAME===t.name&&"R"===e.CONSTRAINT_TYPE}).map(function(e){return new a.ForeignKeySchema(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=h.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(t){return new u.IndexSchema(e.TABLE_NAME,t.INDEX_NAME,t.COLUMN_NAMES,!("UNIQUE"!==t.COLUMN_NAMES))}),t})]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,(r=e.columns.filter(function(e){return e.isPrimary})).length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n="SELECT COLUMN_NAME FROM all_tab_cols WHERE TABLE_NAME = '"+e+"' AND COLUMN_NAME = '"+t+"'",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof o.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" ADD '+this.buildCreateColumnSql(t),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof o.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof i.ColumnSchema?s=n:(s=a.clone()).name=n,[2,this.changeColumn(r,a,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s,u,c,l;return __generator(this,function(d){switch(d.label){case 0:return r=void 0,e instanceof o.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=d.sent(),d.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return n.isGenerated===a.isGenerated?[3,10]:n.isGenerated?r.primaryKeys.length>0&&a.isPrimary?(s='ALTER TABLE "'+r.name+'" DROP CONSTRAINT "'+r.primaryKeys[0].name+'"',[4,this.query(s)]):[3,5]:[3,8];case 4:d.sent(),d.label=5;case 5:return u='ALTER TABLE "'+r.name+'" DROP COLUMN "'+n.name+'"',[4,this.query(u)];case 6:return d.sent(),c='ALTER TABLE "'+r.name+'" ADD '+this.buildCreateColumnSql(n),[4,this.query(c)];case 7:return d.sent(),[3,10];case 8:return l='ALTER TABLE "'+r.name+'" MODIFY "'+n.name+'" DROP IDENTITY',[4,this.query(l)];case 9:d.sent(),d.label=10;case 10:return n.isNullable===a.isNullable?[3,12]:(l='ALTER TABLE "'+r.name+'" MODIFY "'+n.name+'" '+n.type+" "+(n.isNullable?"NULL":"NOT NULL"),[4,this.query(l)]);case 11:return d.sent(),[3,14];case 12:return n.type===a.type?[3,14]:(l='ALTER TABLE "'+r.name+'" MODIFY "'+n.name+'" '+n.type,[4,this.query(l)]);case 13:d.sent(),d.label=14;case 14:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.query('ALTER TABLE "'+e.name+'" DROP COLUMN "'+t.name+'"')]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),e.primaryKeys.length>0&&e.primaryKeys[0].name?[4,this.query('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+e.primaryKeys[0].name+'"')]:[3,2];case 1:n.sent(),n.label=2;case 2:return t.length>0?[4,this.query('ALTER TABLE "'+e.name+'" ADD PRIMARY KEY ('+t.join(", ")+")")]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,a;return __generator(this,function(s){return n=e instanceof o.TableSchema?e.name:e,r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),a='ALTER TABLE "'+n+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'"('+i+")",t.onDelete&&(a+=" ON DELETE "+t.onDelete),[2,this.query(a)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof o.TableSchema?e.name:e,r='ALTER TABLE "'+n+'" DROP CONSTRAINT "'+t.name+'"',[2,this.query(r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r="CREATE "+(t.isUnique?"UNIQUE":"")+' INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n='ALTER TABLE "'+e+'" DROP INDEX "'+t+'"',[4,this.query(n)];case 1:return r.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query('TRUNCATE TABLE "'+e+'"')];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return[4,this.startTransaction()];case 1:s.sent(),s.label=2;case 2:return s.trys.push([2,8,,13]),e="SET FOREIGN_KEY_CHECKS = 0;",t="SELECT concat('DROP TABLE IF EXISTS ', table_name, ';') AS query FROM information_schema.tables WHERE table_schema = '"+this.dbName+"'",n="SET FOREIGN_KEY_CHECKS = 1;",[4,this.query(e)];case 3:return s.sent(),[4,this.query(t)];case 4:return r=s.sent(),[4,Promise.all(r.map(function(e){return a.query(e.query)}))];case 5:return s.sent(),[4,this.query(n)];case 6:return s.sent(),[4,this.commitTransaction()];case 7:return s.sent(),[3,13];case 8:i=s.sent(),s.label=9;case 9:return s.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return s.sent(),[3,12];case 11:return o=s.sent(),[3,12];case 12:throw i;case 13:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.schemaName},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e){return Object.keys(e).map(function(e){return'"'+e+'"=:'+e})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'" '+e.type;return!0===e.isNullable||e.isGenerated||(t+=" NOT NULL"),!0===e.isGenerated&&(t+=" GENERATED BY DEFAULT ON NULL AS IDENTITY"),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT "+e.default),t},e}(),e("OracleQueryRunner",l)}}}),System.register("typeorm/driver/oracle/OracleConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/oracle/OracleDriver",["typeorm/driver/error/ConnectionIsNotSetError","typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/oracle/OracleQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder"],function(e,t){"use strict";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(e){if(this.supportedDataTypes=["char","nchar","nvarchar2","varchar2","long","raw","long raw","number","numeric","dec","decimal","integer","int","smallint","real","double precision","date","timestamp","timestamp with time zone","timestamp with local time zone","interval year","interval day","bfile","blob","clob","nclob","rowid","urowid"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"CURRENT_TIMESTAMP",updateDate:"datetime",updateDateDefault:"CURRENT_TIMESTAMP",version:"number",treeLevel:"number",migrationName:"varchar",migrationTimestamp:"timestamp"},this.connection=e,this.options=e.options,!this.options.host)throw new o.DriverOptionNotSetError("host");if(!this.options.username)throw new o.DriverOptionNotSetError("username");if(!this.options.sid)throw new o.DriverOptionNotSetError("sid");this.loadDependencies(),this.oracle.outFormat=this.oracle.OBJECT}return e.prototype.connect=function(){var e=this,t=Object.assign({},{user:this.options.username,password:this.options.password,connectString:this.options.host+":"+this.options.port+"/"+this.options.sid},this.options.extra||{});return new Promise(function(n,r){e.oracle.createPool(t,function(t,i){if(t)return r(t);e.pool=i,n()})})},e.prototype.disconnect=function(){var e=this;return this.pool?new Promise(function(t,n){e.pool.close(function(e){return e?n(e):t()}),e.pool=void 0}):Promise.reject(new n.ConnectionIsNotSetError("oracle"))},e.prototype.createSchemaBuilder=function(){return new u.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(){return new i.OracleQueryRunner(this)},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){return n.push(t[e.substr(1)]),e}),[e,n]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.preparePersistentValue=function(e,t){return null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?a.DateUtils.mixedDateToDateString(e):"time"===t.type?a.DateUtils.mixedDateToTimeString(e):"datetime"===t.type?a.DateUtils.mixedDateToUtcDatetimeString(e):"json"===t.type?JSON.stringify(e):"simple-array"===t.type?a.DateUtils.simpleArrayToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return t.type===Boolean?!!e:"datetime"===t.type?a.DateUtils.normalizeHydratedDate(e):"date"===t.type?a.DateUtils.mixedDateToDateString(e):"time"===t.type?a.DateUtils.mixedTimeToString(e):"json"===t.type?JSON.parse(e):"simple-array"===t.type?a.DateUtils.stringToSimpleArray(e):e},e.prototype.normalizeType=function(e){var t="";return e.type===Number?t+="integer":e.type===String?t+="nvarchar2":e.type===Date?t+="timestamp(0)":e.type===Boolean?t+="number(1)":e.type===Object?t+="text":"simple-array"===e.type?t+="text":t+=e.type,e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale&&(t+="("+e.scale+")"),t},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"true":"false":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.loadDependencies=function(){try{this.oracle=s.PlatformTools.load("oracledb")}catch(e){throw new r.DriverPackageNotInstalledError("Oracle","oracledb")}},e}(),e("OracleDriver",c)}}}),System.register("typeorm/query-builder/SelectQuery",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/SelectQueryBuilder",["typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer","typeorm/driver/sqlserver/SqlServerDriver","typeorm/query-builder/error/PessimisticLockTransactionRequiredError","typeorm/query-builder/error/NoVersionOrUpdateDateColumnError","typeorm/query-builder/error/OptimisticLockVersionMismatchError","typeorm/query-builder/error/OptimisticLockCanNotBeUsedError","typeorm/query-builder/JoinAttribute","typeorm/query-builder/relation-id/RelationIdAttribute","typeorm/query-builder/relation-count/RelationCountAttribute","typeorm/query-builder/relation-id/RelationIdLoader","typeorm/query-builder/relation-id/RelationIdMetadataToAttributeTransformer","typeorm/query-builder/relation-count/RelationCountLoader","typeorm/query-builder/relation-count/RelationCountMetadataToAttributeTransformer","typeorm/subscriber/Broadcaster","typeorm/query-builder/QueryBuilder","typeorm/query-builder/error/LockNotSupportedOnGivenDriverError","typeorm/driver/mysql/MysqlDriver","typeorm/driver/postgres/PostgresDriver","typeorm/driver/oracle/OracleDriver"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,p,m,f,y,h,g,v,b,E,_;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){p=e},function(e){m=e},function(e){f=e},function(e){y=e},function(e){h=e},function(e){g=e},function(e){v=e},function(e){b=e},function(e){E=e}],execute:function(){_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){var e=this.createSelectExpression();return e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=this.createLimitOffsetOracleSpecificExpression(e),e=e.trim(),this.expressionMap.subQuery&&(e="("+e+")"),e},t.prototype.subQuery=function(){var e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e},t.prototype.addSelect=function(e,t){return e?(e instanceof Array?this.expressionMap.selects=this.expressionMap.selects.concat(e.map(function(e){return{selection:e}})):this.expressionMap.selects.push({selection:e,aliasName:t}),this):this},t.prototype.from=function(e,t){return this.setMainAlias(e,t),this},t.prototype.innerJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("INNER",e,t,n,r),this},t.prototype.leftJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("LEFT",e,t,n,r),this},t.prototype.innerJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.innerJoin(e,t,n,r),this},t.prototype.leftJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.leftJoin(e,t,n,r),this},t.prototype.innerJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!0),this},t.prototype.innerJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!1),this},t.prototype.leftJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!0),this},t.prototype.leftJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!1),this},t.prototype.loadRelationIdAndMap=function(e,t,n,r){var i=new c.RelationIdAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,"string"==typeof n&&(i.alias=n),n instanceof Object&&n.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=r,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadRelationCountAndMap=function(e,t,n,r){var i=new l.RelationCountAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=n,i.queryBuilderFactory=r,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadAllRelationIds=function(){var e=this;return this.expressionMap.mainAlias.metadata.relations.forEach(function(t){e.loadRelationIdAndMap(e.expressionMap.mainAlias.name+"."+t.propertyPath,e.expressionMap.mainAlias.name+"."+t.propertyPath,{disableMixedMap:!0})}),this},t.prototype.where=function(e,t){return this.expressionMap.wheres.push({type:"simple",condition:e}),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:e}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:e}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},t.prototype.andWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},t.prototype.orWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.orWhere(n,r),this},t.prototype.having=function(e,t){return this.expressionMap.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this},t.prototype.andHaving=function(e,t){return this.expressionMap.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this},t.prototype.orHaving=function(e,t){return this.expressionMap.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this},t.prototype.groupBy=function(e){return this.expressionMap.groupBys=[e],this},t.prototype.addGroupBy=function(e){return this.expressionMap.groupBys.push(e),this},t.prototype.orderBy=function(e,t){return void 0===t&&(t="ASC"),e?e instanceof Object?this.expressionMap.orderBys=e:this.expressionMap.orderBys=(n={},n[e]=t,n):this.expressionMap.orderBys={},this;var n},t.prototype.addOrderBy=function(e,t){return void 0===t&&(t="ASC"),this.expressionMap.orderBys[e]=t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.offset=function(e){return this.expressionMap.offset=e,this},t.prototype.take=function(e){return this.expressionMap.take=e,this},t.prototype.skip=function(e){return this.expressionMap.skip=e,this},t.prototype.setMaxResults=function(e){return this.expressionMap.take=e,this},t.prototype.setFirstResult=function(e){return this.expressionMap.skip=e,this},t.prototype.setLock=function(e,t){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this},t.prototype.getRawOne=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;return[4,this.execute()];case 1:return e=t.sent(),[2,e[0]]}})})},t.prototype.getRawMany=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if("optimistic"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;return[2,this.execute()]})})},t.prototype.getRawAndEntities=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.executeEntitiesAndRawResults({release:!0})]})})},t.prototype.getOne=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getRawAndEntities()];case 1:if(e=i.sent(),(t=e.entities[0])&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion)if(n=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if(r=t[n.updateDateColumn.propertyName],this.expressionMap.lockVersion.setMilliseconds(0),r.getTime()!==this.expressionMap.lockVersion.getTime())throw new a.OptimisticLockVersionMismatchError(n.name,this.expressionMap.lockVersion,r)}else if((r=t[n.versionColumn.propertyName])!==this.expressionMap.lockVersion)throw new a.OptimisticLockVersionMismatchError(n.name,this.expressionMap.lockVersion,r);return[2,t]}})})},t.prototype.getMany=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;return[4,this.getRawAndEntities()];case 1:return e=t.sent(),[2,e.entities]}})})},t.prototype.getCount=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if("optimistic"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;return[2,this.executeCountQuery({release:!0})]})})},t.prototype.getManyAndCount=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;t.label=1;case 1:return t.trys.push([1,,3,6]),[4,Promise.all([this.executeEntitiesAndRawResults({release:!1}),this.executeCountQuery({release:!1})])];case 2:return e=t.sent(),[2,[e[0].entities,e[1]]];case 3:return this.ownQueryRunner?[4,this.queryRunner.release()]:[3,5];case 4:t.sent(),t.label=5;case 5:return[7];case 6:return[2]}})})},t.prototype.stream=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:e=this.getSqlAndParameters(),t=e[0],n=e[1],o.label=1;case 1:return o.trys.push([1,,2,5]),r=function(){if(i.ownQueryRunner)return i.queryRunner.release()},[2,this.queryRunner.stream(t,n,r,r)];case 2:return this.ownQueryRunner?[4,this.queryRunner.release()]:[3,4];case 3:o.sent(),o.label=4;case 4:return[7];case 5:return[2]}})})},t.prototype.join=function(e,t,n,r,i,o,a){var s=new u.JoinAttribute(this.connection,this.expressionMap);s.direction=e,s.mapToProperty=o,s.options=i,s.isMappingMany=a,s.entityOrProperty=t,s.condition=r,this.expressionMap.joinAttributes.push(s),s.alias=this.expressionMap.createAlias({name:n,metadata:s.metadata}),s.relation&&s.relation.junctionEntityMetadata&&this.expressionMap.createAlias({name:s.junctionAlias,metadata:s.relation.junctionEntityMetadata})},t.prototype.createSelectExpression=function(){var e=this;if(!this.expressionMap.mainAlias)throw new Error("Cannot build query because main alias is not set (call qb#from method)");var t=[],n=[],i=this.expressionMap.mainAlias.name,o=this.getTableName();if(this.expressionMap.mainAlias.hasMetadata){var a=this.expressionMap.mainAlias.metadata;t.push.apply(t,this.buildEscapedEntityColumnSelects(i,a)),n.push.apply(n,this.findEntityColumnSelects(i,a))}if(this.expressionMap.joinAttributes.forEach(function(r){r.metadata?(t.push.apply(t,e.buildEscapedEntityColumnSelects(r.alias.name,r.metadata)),n.push.apply(n,e.findEntityColumnSelects(r.alias.name,r.metadata))):e.expressionMap.selects.some(function(e){return e.selection===r.alias.name})&&(t.push({selection:e.escape(r.alias.name)+".*"}),n.push({selection:e.escape(r.alias.name)}))}),!this.expressionMap.ignoreParentTablesJoins&&this.expressionMap.mainAlias.hasMetadata&&(a=this.expressionMap.mainAlias.metadata).parentEntityMetadata&&"class-table"===a.parentEntityMetadata.inheritanceType&&a.parentIdColumns){var s="parentIdColumn_"+a.parentEntityMetadata.tableName;a.parentEntityMetadata.columns.forEach(function(n){t.push({selection:e.escape(s)+"."+e.escape(n.databaseName),aliasName:s+"_"+n.databaseName})})}this.expressionMap.selects.filter(function(e){return-1===n.indexOf(e)}).forEach(function(n){return t.push({selection:e.replacePropertyNames(n.selection),aliasName:n.aliasName})}),0===t.length&&t.push({selection:"*"});var u="";if(this.connection.driver instanceof r.SqlServerDriver)switch(this.expressionMap.lockMode){case"pessimistic_read":u=" WITH (HOLDLOCK, ROWLOCK)";break;case"pessimistic_write":u=" WITH (UPDLOCK, ROWLOCK)"}var c=o?this.escape(o):this.expressionMap.mainAlias.subQuery,l=t.map(function(t){return t.selection+(t.aliasName?" AS "+e.escape(t.aliasName):"")}).join(", ");return(this.expressionMap.limit||this.expressionMap.offset)&&this.connection.driver instanceof E.OracleDriver?"SELECT ROWNUM "+this.escape("RN")+","+l+" FROM "+c+" "+this.escape(i)+u:"SELECT "+l+" FROM "+c+" "+this.escape(i)+u},t.prototype.createJoinExpression=function(){var e=this,t=this.expressionMap.joinAttributes.map(function(t){var n=t.relation,r=t.tableName,i=t.alias.name,o=t.condition?" AND ("+t.condition+")":"",a=t.parentAlias;if(!a||!n)return" "+t.direction+" JOIN "+e.escape(r)+" "+e.escape(i)+(t.condition?" ON "+e.replacePropertyNames(t.condition):"");if(n.isManyToOne||n.isOneToOneOwner){s=n.joinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+a+"."+n.propertyPath+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+t.direction+" JOIN "+e.escape(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(s+o)}if(n.isOneToMany||n.isOneToOneNotOwner){var s=n.inverseRelation.joinColumns.map(function(e){return i+"."+n.inverseRelation.propertyPath+"."+e.referencedColumn.propertyPath+"="+a+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+t.direction+" JOIN "+e.escape(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(s+o)}var u=n.junctionEntityMetadata.tableName,c=t.junctionAlias,l="",d="";return n.isOwning?(l=n.joinColumns.map(function(e){return c+"."+e.propertyPath+"="+a+"."+e.referencedColumn.propertyPath}).join(" AND "),d=n.inverseJoinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+c+"."+e.propertyPath}).join(" AND ")):(l=n.inverseRelation.inverseJoinColumns.map(function(e){return c+"."+e.propertyPath+"="+a+"."+e.referencedColumn.propertyPath}).join(" AND "),d=n.inverseRelation.joinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+c+"."+e.propertyPath}).join(" AND "))," "+t.direction+" JOIN "+e.escape(u)+" "+e.escape(c)+" ON "+e.replacePropertyNames(l)+" "+t.direction+" JOIN "+e.escape(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(d+o)});if(!this.expressionMap.ignoreParentTablesJoins&&this.expressionMap.mainAlias.hasMetadata){var n=this.expressionMap.mainAlias.metadata;if(n.parentEntityMetadata&&"class-table"===n.parentEntityMetadata.inheritanceType&&n.parentIdColumns){var r="parentIdColumn_"+n.parentEntityMetadata.tableName,i=n.parentIdColumns.map(function(t){return e.expressionMap.mainAlias.name+"."+t.propertyPath+" = "+r+"."+t.referencedColumn.propertyPath}).join(" AND "),o=" JOIN "+this.escape(n.parentEntityMetadata.tableName)+" "+this.escape(r)+" ON "+this.replacePropertyNames(i);t.push(o)}}return t.join(" ")},t.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return!Object.keys(t).length&&this.expressionMap.mainAlias.hasMetadata&&(t=this.expressionMap.mainAlias.metadata.orderBy||{}),Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map(function(t){return e.replacePropertyNames(t)+" "+e.expressionMap.orderBys[t]}).join(", "):""},t.prototype.createLimitOffsetOracleSpecificExpression=function(e){return(this.expressionMap.offset||this.expressionMap.limit)&&this.connection.driver instanceof E.OracleDriver&&(e="SELECT * FROM ("+e+") WHERE ",this.expressionMap.offset&&(e+=this.escape("RN")+" >= "+this.expressionMap.offset),this.expressionMap.limit&&(e+=(this.expressionMap.offset?" AND ":"")+this.escape("RN")+" <= "+((this.expressionMap.offset||0)+this.expressionMap.limit))),e},t.prototype.createLimitOffsetExpression=function(){if(this.connection.driver instanceof E.OracleDriver)return"";if(this.connection.driver instanceof r.SqlServerDriver){if(this.expressionMap.limit&&this.expressionMap.offset)return" OFFSET "+this.expressionMap.offset+" ROWS FETCH NEXT "+this.expressionMap.limit+" ROWS ONLY";if(this.expressionMap.limit)return" OFFSET 0 ROWS FETCH NEXT "+this.expressionMap.limit+" ROWS ONLY";if(this.expressionMap.offset)return" OFFSET "+this.expressionMap.offset+" ROWS"}else{if(this.expressionMap.limit&&this.expressionMap.offset)return" LIMIT "+this.expressionMap.limit+" OFFSET "+this.expressionMap.offset;if(this.expressionMap.limit)return" LIMIT "+this.expressionMap.limit;if(this.expressionMap.offset)return" OFFSET "+this.expressionMap.offset}return""},t.prototype.createLockExpression=function(){switch(this.expressionMap.lockMode){case"pessimistic_read":if(this.connection.driver instanceof v.MysqlDriver)return" LOCK IN SHARE MODE";if(this.connection.driver instanceof b.PostgresDriver)return" FOR SHARE";if(this.connection.driver instanceof r.SqlServerDriver)return"";throw new g.LockNotSupportedOnGivenDriverError;case"pessimistic_write":if(this.connection.driver instanceof v.MysqlDriver||this.connection.driver instanceof b.PostgresDriver)return" FOR UPDATE";if(this.connection.driver instanceof r.SqlServerDriver)return"";throw new g.LockNotSupportedOnGivenDriverError;default:return""}},t.prototype.createHavingExpression=function(){var e=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";var t=this.expressionMap.havings.map(function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ");return t.length?" HAVING "+t:""},t.prototype.buildEscapedEntityColumnSelects=function(e,t){var n=this;return(this.expressionMap.selects.some(function(t){return t.selection===e})?t.columns:t.columns.filter(function(t){return n.expressionMap.selects.some(function(n){return n.selection===e+"."+t.propertyName})})).map(function(t){var r=n.expressionMap.selects.find(function(n){return n.selection===e+"."+t.propertyName});return{selection:n.escape(e)+"."+n.escape(t.databaseName),aliasName:r&&r.aliasName?r.aliasName:e+"_"+t.databaseName}})},t.prototype.findEntityColumnSelects=function(e,t){var n=this.expressionMap.selects.find(function(t){return t.selection===e});return n?[n]:this.expressionMap.selects.filter(function(n){return t.columns.some(function(t){return n.selection===e+"."+t.propertyName})})},t.prototype.executeCountQuery=function(e){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l=this;return __generator(this,function(d){switch(d.label){case 0:n=this.expressionMap.mainAlias.name,r=this.expressionMap.mainAlias.metadata,i=this.escape(n),o="COUNT("+r.primaryColumns.map(function(e,t){var n=l.escape(e.databaseName);return 0===t?"DISTINCT("+i+"."+n+")":i+"."+n+")"}).join(", ")+') as "cnt"',a=new t(this).mergeExpressionMap({ignoreParentTablesJoins:!0}).orderBy().offset(void 0).limit(void 0).select(o).getSqlAndParameters(),s=a[0],u=a[1],d.label=1;case 1:return d.trys.push([1,,3,6]),[4,this.queryRunner.query(s,u)];case 2:return c=d.sent(),c&&c[0]&&c[0].cnt?[2,parseInt(c[0].cnt)]:[2,0];case 3:return e.release&&this.ownQueryRunner?[4,this.queryRunner.release()]:[3,5];case 4:d.sent(),d.label=5;case 5:return[7];case 6:return[2]}})})},t.prototype.executeEntitiesAndRawResults=function(e){return __awaiter(this,void 0,void 0,function(){var r,a,s,u,c,l,h,g,v,b,E,_,N,C,T,M,w,R,S,O,A,x,I,P,D=this;return __generator(this,function(q){switch(q.label){case 0:if(q.trys.push([0,,11,14]),!this.expressionMap.mainAlias)throw new Error('Alias is not set. Use "from" method to set an alias.');if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode)&&!this.queryRunner.isTransactionActive)throw new i.PessimisticLockTransactionRequiredError;if("optimistic"===this.expressionMap.lockMode&&!(r=this.expressionMap.mainAlias.metadata).versionColumn&&!r.updateDateColumn)throw new o.NoVersionOrUpdateDateColumnError(r.name);return a=new y.Broadcaster(this.connection),s=new d.RelationIdLoader(this.connection,this.queryRunner,this.expressionMap.relationIdAttributes),u=new m.RelationCountLoader(this.connection,this.queryRunner,this.expressionMap.relationCountAttributes),(c=new p.RelationIdMetadataToAttributeTransformer(this.expressionMap)).transform(),(l=new f.RelationCountMetadataToAttributeTransformer(this.expressionMap)).transform(),h=[],g=[],this.expressionMap.skip||this.expressionMap.take?(v=this.createOrderByCombinedWithSelectExpression("distinctAlias"),b=v[0],E=v[1],_=this.expressionMap.mainAlias.metadata,N=this.expressionMap.mainAlias.name,C=_.primaryColumns.map(function(e){var t=D.escape("distinctAlias"),n=D.escape(N+"_"+e.propertyName);return E[n]||(E[n]="ASC"),t+"."+n+' as "ids_'+N+"_"+e.databaseName+'"'}),[4,new t(this.connection,this.queryRunner).select("DISTINCT "+C.join(", ")+" ").addSelect(b).from("("+new t(this).orderBy().getQuery()+")","distinctAlias").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(E).setParameters(this.getParameters()).getRawMany()]):[3,4];case 1:return(h=q.sent()).length>0?(T="",M={},_.hasMultiplePrimaryKeys?T=h.map(function(e){return _.primaryColumns.map(function(t){return M["ids_"+t.propertyName]=e["ids_"+t.databaseName],N+"."+t.propertyName+"=:ids_"+t.databaseName}).join(" AND ")}).join(" OR "):(w=h.map(function(e){return e["ids_"+N+"_"+_.primaryColumns[0].databaseName]}),(R=w.every(function(e){return"number"==typeof e}))?T=N+"."+_.primaryColumns[0].propertyName+" IN ("+w.join(", ")+")":(M.ids=w,T=N+"."+_.primaryColumns[0].propertyName+" IN (:ids)")),[4,new t(this).mergeExpressionMap({extraAppendedAndWhereCondition:T}).setParameters(M).getRawMany()]):[3,3];case 2:h=q.sent(),q.label=3;case 3:return[3,6];case 4:return S=this.getSqlAndParameters(),O=S[0],A=S[1],[4,this.queryRunner.query(O,A)];case 5:h=q.sent(),q.label=6;case 6:return h.length>0?[4,s.load(h)]:[3,10];case 7:return x=q.sent(),[4,u.load(h)];case 8:return I=q.sent(),P=new n.RawSqlResultsToEntityTransformer(this.connection.driver,this.expressionMap.joinAttributes,x,I),g=P.transform(h,this.expressionMap.mainAlias),this.expressionMap.mainAlias.hasMetadata?[4,a.broadcastLoadEventsForAll(this.expressionMap.mainAlias.target,h)]:[3,10];case 9:q.sent(),q.label=10;case 10:return[2,{raw:h,entities:g}];case 11:return e.release&&this.ownQueryRunner?[4,this.queryRunner.release()]:[3,13];case 12:q.sent(),q.label=13;case 13:return[7];case 14:return[2]}})})},t.prototype.createOrderByCombinedWithSelectExpression=function(e){var t=this,n=this.expressionMap.orderBys;!Object.keys(n).length&&this.expressionMap.mainAlias.hasMetadata&&(n=this.expressionMap.mainAlias.metadata.orderBy||{});var r=Object.keys(n).map(function(n){var r=n.split("."),i=r[0],o=r[1],a=r.slice(2);return t.escape(e)+"."+t.escape(i+"_"+o+a.join("_"))}).join(", "),i={};return Object.keys(n).forEach(function(n){var r=n.split("."),o=r[0],a=r[1],s=r.slice(2);i[t.escape(e)+"."+t.escape(o+"_"+a+s.join("_"))]=t.expressionMap.orderBys[n]}),[r,i]},t.prototype.mergeExpressionMap=function(e){return Object.assign(this.expressionMap,e),this},t}(h.QueryBuilder),e("SelectQueryBuilder",_)}}}),System.register("typeorm/query-builder/relation-id/RelationIdAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,Object.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");var e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=this.relationName.split(".");return e[0]+"_"+e[1]+"_relation_id"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionMetadata",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyPath",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),e}(),e("RelationIdAttribute",r)}}}),System.register("typeorm/query-builder/QueryExpressionMap",["typeorm/query-builder/Alias","typeorm/query-builder/JoinAttribute","typeorm/query-builder/relation-id/RelationIdAttribute","typeorm/query-builder/relation-count/RelationCountAttribute"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.connection=e,this.aliases=[],this.queryType="select",this.selects=[],this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.parameters={},this.disableEscaping=!0,this.ignoreParentTablesJoins=!1,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1}return e.prototype.createMainAlias=function(e){var t=this.createAlias(e);return this.mainAlias&&this.aliases.splice(this.aliases.indexOf(this.mainAlias)),this.mainAlias=t,t},e.prototype.createAlias=function(e){var t=e.name;!t&&e.tableName&&(t=e.tableName),!t&&e.target instanceof Function&&(t=e.target.name),t||"string"!=typeof e.target||(t=e.target);var r=new n.Alias;return t&&(r.name=t),e.metadata&&(r.metadata=e.metadata),e.target&&!r.hasMetadata&&(r.metadata=this.connection.getMetadata(e.target)),e.tableName&&(r.tableName=e.tableName),e.subQuery&&(r.subQuery=e.subQuery),this.aliases.push(r),r},e.prototype.findAliasByName=function(e){var t=this.aliases.find(function(t){return t.name===e});if(!t)throw new Error('"'+e+'" alias was not found. Maybe you forgot to join it?');return t},e.prototype.clone=function(){var t=this,a=new e(this.connection);return a.queryType=this.queryType,a.selects=this.selects.map(function(e){return e}),this.aliases.forEach(function(e){return a.aliases.push(new n.Alias(e))}),a.mainAlias=this.mainAlias,a.valuesSet=this.valuesSet,a.joinAttributes=this.joinAttributes.map(function(e){return new r.JoinAttribute(t.connection,t,e)}),a.relationIdAttributes=this.relationIdAttributes.map(function(e){return new i.RelationIdAttribute(t,e)}),a.relationCountAttributes=this.relationCountAttributes.map(function(e){return new o.RelationCountAttribute(t,e)}),a.wheres=this.wheres.map(function(e){return __assign({},e)}),a.havings=this.havings.map(function(e){return __assign({},e)}),a.orderBys=Object.assign({},this.orderBys),a.groupBys=this.groupBys.map(function(e){return e}),a.limit=this.limit,a.offset=this.offset,a.skip=this.skip,a.take=this.take,a.lockMode=this.lockMode,a.lockVersion=this.lockVersion,a.parameters=Object.assign({},this.parameters),a.disableEscaping=this.disableEscaping,a.ignoreParentTablesJoins=this.ignoreParentTablesJoins,a.enableRelationIdValues=this.enableRelationIdValues,a},e}(),e("QueryExpressionMap",a)}}}),System.register("typeorm/query-builder/UpdateQueryBuilder",["typeorm/query-builder/QueryBuilder"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){var e=this.createUpdateExpression();return(e+=this.createWhereExpression()).trim()},t.prototype.set=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.where=function(e,t){return this.expressionMap.wheres.push({type:"simple",condition:e}),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:e}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:e}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},t.prototype.andWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},t.prototype.orWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.orWhere(n,r),this},t.prototype.createUpdateExpression=function(){var e=this,t=this.getValueSets(),n=[];return Object.keys(t).forEach(function(r){var i=e.expressionMap.mainAlias.metadata.findColumnWithPropertyName(r);if(i){var o="_updated_"+i.databaseName;e.setParameter(o,t[i.propertyName]),n.push(e.escape(i.databaseName)+"=:"+o)}}),"UPDATE "+this.escape(this.getTableName())+" SET "+n.join(", ")},t.prototype.getValueSets=function(){if(this.expressionMap.valuesSet instanceof Object)return this.expressionMap.valuesSet;throw new Error('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify inserted values.')},t}(n.QueryBuilder),e("UpdateQueryBuilder",r)}}}),System.register("typeorm/query-builder/DeleteQueryBuilder",["typeorm/query-builder/QueryBuilder"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){var e=this.createDeleteExpression();return(e+=this.createWhereExpression()).trim()},t.prototype.from=function(e,t){return this.setMainAlias(e,t),this},t.prototype.where=function(e,t){return this.expressionMap.wheres.push({type:"simple",condition:e}),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:e}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:e}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},t.prototype.andWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},t.prototype.orWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.orWhere(n,r),this},t.prototype.createDeleteExpression=function(){return"DELETE FROM "+this.escape(this.getTableName())},t}(n.QueryBuilder),e("DeleteQueryBuilder",r)}}}),System.register("typeorm/query-builder/InsertQueryBuilder",["typeorm/query-builder/QueryBuilder"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){return this.createInsertExpression().trim()},t.prototype.into=function(e){return this.setMainAlias(e),this},t.prototype.values=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.createInsertExpression=function(){var e=this,t=this.getValueSets(),n=[];Object.keys(t[0]).forEach(function(t){var r=e.expressionMap.mainAlias.metadata.findColumnWithPropertyName(t);r&&n.push(r)});var r=t.map(function(t,r){return"("+n.map(function(n){var i="_inserted_"+r+"_"+n.databaseName;return e.setParameter(i,t[n.propertyName]),":"+i}).join(",")+")"}).join(", ");return"INSERT INTO "+this.escape(this.getTableName())+"("+n.map(function(t){return e.escape(t.databaseName)}).join(", ")+") VALUES "+r},t.prototype.getValueSets=function(){if(this.expressionMap.valuesSet instanceof Array&&this.expressionMap.valuesSet.length>0)return this.expressionMap.valuesSet;if(this.expressionMap.valuesSet instanceof Object)return[this.expressionMap.valuesSet];throw new Error('Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')},t}(n.QueryBuilder),e("InsertQueryBuilder",r)}}}),System.register("typeorm/query-builder/RelationQueryBuilder",["typeorm/query-builder/QueryBuilder"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){return""},t.prototype.set=function(e){return this},t.prototype.add=function(e){return this},t.prototype.remove=function(e){return this},t.prototype.getIdOf=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},t.prototype.getIdsOf=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,[]]})})},t}(n.QueryBuilder),e("RelationQueryBuilder",r)}}}),System.register("typeorm/query-builder/QueryBuilder",["typeorm/query-builder/QueryExpressionMap"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(t,r){t instanceof e?(this.connection=t.connection,this.queryRunner=t.queryRunner||this.connection.createQueryRunner(),this.ownQueryRunner=!t.queryRunner,this.expressionMap=t.expressionMap.clone()):(this.connection=t,this.queryRunner=r||this.connection.createQueryRunner(),this.ownQueryRunner=!r,this.expressionMap=new n.QueryExpressionMap(this.connection))}return Object.defineProperty(e.prototype,"alias",{get:function(){if(!this.expressionMap.mainAlias)throw new Error("Main alias is not set");return this.expressionMap.mainAlias.name},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){this.expressionMap.queryType="select",e instanceof Array?this.expressionMap.selects=e.map(function(e){return{selection:e}}):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);var n=require("./SelectQueryBuilder").SelectQueryBuilder;return this instanceof n?this:new n(this)},e.prototype.insert=function(){this.expressionMap.queryType="insert";var e=require("./InsertQueryBuilder").InsertQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.update=function(e,t){var n=t||e;(e instanceof Function||"string"==typeof e)&&this.setMainAlias(e),this.expressionMap.queryType="update",this.expressionMap.valuesSet=n;var r=require("./UpdateQueryBuilder").UpdateQueryBuilder;return this instanceof r?this:new r(this)},e.prototype.delete=function(){this.expressionMap.queryType="delete";var e=require("./DeleteQueryBuilder").DeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.relation=function(e,t){this.expressionMap.queryType="relation",this.setMainAlias(e);var n=require("./RelationQueryBuilder").RelationQueryBuilder;return this instanceof n?this:new n(this)},e.prototype.setParameter=function(e,t){return this.expressionMap.parameters[e]=t,this},e.prototype.setParameters=function(e){var t=this;return Object.keys(e).forEach(function(n){t.expressionMap.parameters[n]=e[n]}),this},e.prototype.getParameters=function(){var e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=t.childEntityMetadatas.filter(function(e){return e.discriminatorColumn}).map(function(e){return e.discriminatorValue});n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e},e.prototype.getSql=function(){return this.connection.driver.escapeQueryWithParameters(this.getQuery(),this.getParameters())[0]},e.prototype.printSql=function(){return console.log(this.getSql()),this},e.prototype.getSqlAndParameters=function(){return this.connection.driver.escapeQueryWithParameters(this.getQuery(),this.getParameters())},e.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(r){switch(r.label){case 0:e=this.getSqlAndParameters(),t=e[0],n=e[1],r.label=1;case 1:return r.trys.push([1,,3,6]),[4,this.queryRunner.query(t,n)];case 2:return[2,r.sent()];case 3:return this.ownQueryRunner?[4,this.queryRunner.release()]:[3,5];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.createQueryBuilder=function(){return new this.constructor(this.connection)},e.prototype.clone=function(){var e=this.createQueryBuilder();return e.expressionMap=this.expressionMap.clone(),e},e.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},e.prototype.escape=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e},e.prototype.getTableName=function(){if(!this.expressionMap.mainAlias)throw new Error('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tableName:this.expressionMap.mainAlias.tableName},e.prototype.setMainAlias=function(e,t){if(this.connection.hasMetadata(e))this.expressionMap.createMainAlias({name:t,metadata:this.connection.getMetadata(e)});else{var n=e instanceof Function||"("===e.substr(0,1)&&")"===e.substr(-1),r=e instanceof Function?e(this.subQuery()).getQuery():e;this.expressionMap.createMainAlias({name:t,tableName:!1===n?e:void 0,subQuery:!0===n?r:void 0})}return this},e.prototype.replacePropertyNames=function(e){var t=this;return this.expressionMap.aliases.forEach(function(n){n.hasMetadata&&(n.metadata.columns.forEach(function(r){var i="([ =(]|^.{0})"+n.name+"\\."+r.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(i,"gm"),"$1"+t.escape(n.name)+"."+t.escape(r.databaseName)+"$2");var o="([ =(]|^.{0})"+n.name+"\\."+r.propertyName+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+t.escape(n.name)+"."+t.escape(r.databaseName)+"$2")}),n.metadata.relations.forEach(function(r){if(r.joinColumns.concat(r.inverseJoinColumns).forEach(function(i){var o="([ =(]|^.{0})"+n.name+"\\."+r.propertyPath+"\\."+i.referencedColumn.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+t.escape(n.name)+"."+t.escape(i.databaseName)+"$2")}),r.joinColumns.length>0){var i="([ =(]|^.{0})"+n.name+"\\."+r.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(i,"gm"),"$1"+t.escape(n.name)+"."+t.escape(r.joinColumns[0].databaseName)+"$2")}}))}),e},e.prototype.createWhereExpression=function(){var e=this,t=this.expressionMap.wheres.map(function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ");if(this.expressionMap.mainAlias.hasMetadata){var n=this.expressionMap.mainAlias.metadata;if(n.discriminatorColumn&&n.parentEntityMetadata){var r=this.replacePropertyNames(this.expressionMap.mainAlias.name+"."+n.discriminatorColumn.databaseName)+" IN (:discriminatorColumnValues)";return" WHERE "+(t.length?"("+t+") AND":"")+" "+r}}return t.length?this.expressionMap.extraAppendedAndWhereCondition?" WHERE ("+t+") AND "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):" WHERE "+t:this.expressionMap.extraAppendedAndWhereCondition?" WHERE "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):""},e.prototype.createWhereIdsExpression=function(e){var t=this,n=this.expressionMap.mainAlias.metadata,r=this.expressionMap.mainAlias.name,i={},o=e.map(function(e,o){var a=[];return n.primaryColumns.forEach(function(n,s){a.push(t.escape(r)+"."+t.escape(n.databaseName)+"=:id_"+o+"_"+s),i["id_"+o+"_"+s]=n.getEntityValue(e)}),n.parentIdColumns.forEach(function(n,s){a.push(t.escape(r)+"."+t.escape(n.databaseName)+"=:parentId_"+o+"_"+s),i["parentId_"+o+"_"+s]=n.getEntityValue(e)}),a.join(" AND ")});return[o.length>1?"("+o.join(" OR ")+")":o[0],i]},e}(),e("QueryBuilder",r)}}}),System.register("typeorm/metadata-args/RelationIdMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationIdMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationId decorator.");this.relation=t},e}(),e("RelationIdMetadata",n)}}}),System.register("typeorm/metadata/EmbeddedMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.columns=[],this.relations=[],this.embeddeds=[],this.isArray=!1,this.parentPropertyNames=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}return e.prototype.create=function(){return new this.type},e.prototype.build=function(e){return this.embeddeds.forEach(function(t){return t.build(e)}),this.prefix=this.buildPrefix(),this.parentPropertyNames=this.buildParentPropertyNames(),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this},e.prototype.buildPrefix=function(){var e=[];return this.parentEmbeddedMetadata&&e.push(this.parentEmbeddedMetadata.buildPrefix()),void 0===this.customPrefix?e.push(this.propertyName):"string"==typeof this.customPrefix&&e.push(this.customPrefix),e.join("_")},e.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},e.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},e.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildColumnsFromTree())},this.columns)},e.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationsFromTree())},this.relations)},e}(),e("EmbeddedMetadata",n)}}}),System.register("typeorm/decorator/options/RelationOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/PropertyTypeInFunction",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/RelationTypeInFunction",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/RelationMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isNullable=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;var t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=t.options.cascadeInsert||t.options.cascadeAll||!1,this.isCascadeUpdate=t.options.cascadeUpdate||t.options.cascadeAll||!1,this.isCascadeRemove=t.options.cascadeRemove||t.options.cascadeAll||!1,this.isNullable=!1!==t.options.nullable,this.onDelete=t.options.onDelete,this.isPrimary=t.options.primary||!1,this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,this.type=t.type instanceof Function?t.type():t.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return e.prototype.getEntityValue=function(e){if(this.embeddedMetadata){var t=this.embeddedMetadata.parentPropertyNames.slice(),n=function(e,t){var r=e.shift();return r?n(e,t[r]):t},r=n(t,e);return r?r[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return e[this.isLazy?"__"+this.propertyName+"__":this.propertyName]},e.prototype.setEntityValue=function(e,t){var n=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){var r=function(e,i){var o=e.shift();return o?(i[o.propertyName]||(i[o.propertyName]=o.create()),r(e,i[o.propertyName]),i):(i[n]=t,i)};return r(this.embeddedMetadata.embeddedMetadataTree.slice(),e)}e[n]=t},e.prototype.createValueMap=function(e){var t=this;if(this.embeddedMetadata){var n=this.embeddedMetadata.parentPropertyNames.slice(),r=function(n,i){var o=n.shift();return o?(i[o]={},r(n,i[o]),i):(i[t.propertyName]=e,i)};return r(n,{})}return i={},i[this.propertyName]=e,i;var i},e.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},e.prototype.registerForeignKeys=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(n=this.foreignKeys).push.apply(n,e),this.joinColumns=this.foreignKeys[0]?this.foreignKeys[0].columns:[],this.inverseJoinColumns=this.foreignKeys[1]?this.foreignKeys[1].columns:[],this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner;var n},e.prototype.registerJunctionEntityMetadata=function(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)},e.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){var e=this.inverseEntityMetadata.propertiesMap;if("function"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if("string"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""},e.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName},e}(),e("RelationMetadata",n)}}}),System.register("typeorm/lazy-loading/LazyRelationsWrapper",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.wrap=function(e,t){var n=this,r="__"+t.propertyName+"__",i="__promise_"+t.propertyName+"__",o="__has_"+t.propertyName+"__";Object.defineProperty(e,t.propertyName,{get:function(){var e=this;return!0===this[o]?Promise.resolve(this[r]):this[i]?this[i]:(this[i]=n.loadRelationResults(t,this).then(function(t){return e[r]=t,e[o]=!0,delete e[i],e[r]}),this[i])},set:function(e){var t=this;e instanceof Promise?e.then(function(e){t[r]=e,t[o]=!0}):(this[r]=e,this[o]=!0)},configurable:!0})},e.prototype.loadRelationResults=function(e,t){return e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t):e.isManyToManyOwner?this.loadManyToManyOwner(e,t):this.loadManyToManyNotOwner(e,t)},e.prototype.loadManyToOneOrOneToOneOwner=function(e,t){var n=e.isOwning?e.joinColumns:e.inverseRelation.joinColumns,r=n.map(function(t){return e.entityMetadata.name+"."+e.propertyName+" = "+e.propertyName+"."+t.referencedColumn.propertyName}).join(" AND "),i=this.connection.createQueryBuilder().select(e.propertyName).from(e.type,e.propertyName).innerJoin(e.entityMetadata.target,e.entityMetadata.name,r);return n.forEach(function(n){i.andWhere(e.entityMetadata.name+"."+n.referencedColumn.databaseName+" = :"+n.referencedColumn.databaseName).setParameter(""+n.referencedColumn.databaseName,n.referencedColumn.getEntityValue(t))}),i.getOne()},e.prototype.loadOneToManyOrOneToOneNotOwner=function(e,t){var n=this.connection.createQueryBuilder().select(e.propertyName).from(e.inverseRelation.entityMetadata.target,e.propertyName);return e.inverseRelation.joinColumns.forEach(function(r){n.andWhere(e.propertyName+"."+r.propertyName+" = :"+r.referencedColumn.propertyName).setParameter(""+r.referencedColumn.propertyName,r.referencedColumn.getEntityValue(t))}),e.isOneToMany?n.getMany():n.getOne()},e.prototype.loadManyToManyOwner=function(e,t){var n=e.propertyName,r=e.junctionEntityMetadata.tableName,i=e.joinColumns.map(function(e){return r+"."+e.propertyName+" = :"+e.propertyName}),o=e.inverseJoinColumns.map(function(e){return r+"."+e.propertyName+"="+n+"."+e.referencedColumn.propertyName}),a=e.joinColumns.reduce(function(e,n){return e[n.propertyName]=n.referencedColumn.getEntityValue(t),e},{});return this.connection.createQueryBuilder().select(n).from(e.type,n).innerJoin(r,r,i.concat(o).join(" AND ")).setParameters(a).getMany()},e.prototype.loadManyToManyNotOwner=function(e,t){var n=e.propertyName,r=e.junctionEntityMetadata.tableName,i=e.inverseRelation.joinColumns.map(function(e){return r+"."+e.propertyName+" = "+n+"."+e.referencedColumn.propertyName}),o=e.inverseRelation.inverseJoinColumns.map(function(e){return r+"."+e.propertyName+" = :"+e.propertyName}),a=e.inverseRelation.inverseJoinColumns.reduce(function(e,n){return e[n.propertyName]=n.referencedColumn.getEntityValue(t),e},{});return this.connection.createQueryBuilder().select(n).from(e.type,n).innerJoin(r,r,i.concat(o).join(" AND ")).setParameters(a).getMany()},e}(),e("LazyRelationsWrapper",n)}}}),System.register("typeorm/metadata-args/TableMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/EntityMetadata",["typeorm/lazy-loading/LazyRelationsWrapper","typeorm/util/OrmUtils"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(e){this.childEntityMetadatas=[],this.tableType="regular",this.isJunction=!1,this.ownColumns=[],this.ownRelations=[],this.relations=[],this.columns=[],this.relationIds=[],this.relationCounts=[],this.indices=[],this.foreignKeys=[],this.embeddeds=[],this.listeners=[],this.primaryColumns=[],this.parentIdColumns=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[];var t=e.connection.namingStrategy,r=e.connection.options.tablesPrefix;this.lazyRelationsWrapper=new n.LazyRelationsWrapper(e.connection),this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.target=e.args.target,this.tableType=e.args.type,this.engine=e.args.engine,this.givenTableName=e.args.name,this.skipSync=e.args.skipSync||!1,this.targetName=e.args.target instanceof Function?e.args.target.name:e.args.target,this.tableNameWithoutPrefix="closure-junction"===this.tableType?t.closureJunctionTableName(this.givenTableName):t.tableName(this.targetName,this.givenTableName),this.tableName=r?t.prefixTableName(r,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.isClassTableChild="class-table-child"===this.tableType,this.isSingleTableChild="single-table-child"===this.tableType,this.isEmbeddable="embeddable"===this.tableType,this.isJunction="closure-junction"===this.tableType||"junction"===this.tableType,this.isClosureJunction="closure-junction"===this.tableType,this.isClosure="closure"===this.tableType,this.isAbstract="abstract"===this.tableType,this.isRegular="regular"===this.tableType,this.orderBy=e.args.orderBy instanceof Function?e.args.orderBy(this.propertiesMap):e.args.orderBy}return e.prototype.create=function(){var e=this;if(this.target instanceof Function)return new this.target;var t={};return this.relations.filter(function(e){return e.isLazy}).forEach(function(n){return e.lazyRelationsWrapper.wrap(t,n)}),t},e.prototype.hasId=function(e){return!!e&&this.primaryColumns.every(function(t){var n=t.getEntityValue(e);return null!==n&&void 0!==n&&""!==n})},e.prototype.compareIds=function(e,t){return void 0!==e&&null!==e&&void 0!==t&&null!==t&&r.OrmUtils.deepCompare(e,t)},e.prototype.compareEntities=function(e,t){var n=this.isEntityMapEmpty(e),r=this.isEntityMapEmpty(t);if(n||r)return!1;var i=this.getEntityIdMap(e),o=this.getEntityIdMap(t);return this.compareIds(i,o)},e.prototype.findColumnWithPropertyName=function(e){return this.columns.find(function(t){return t.propertyName===e})},e.prototype.findRelationWithDbName=function(e){return this.relationsWithJoinColumns.find(function(t){return!!t.joinColumns.find(function(t){return t.databaseName===e})})},e.prototype.findRelationWithPropertyPath=function(e){return this.relations.find(function(t){return t.propertyPath===e})},e.prototype.computePropertyPath=function(e){return"string"==typeof e?e:e(this.propertiesMap)},e.prototype.createEntityIdMap=function(e){return(this.parentEntityMetadata,this.primaryColumns).reduce(function(t,n,r){return Object.assign(t,n.createValueMap(e[r]))},{})},e.prototype.isEntityMapEmpty=function(e){return!(this.parentEntityMetadata,this.primaryColumns).every(function(t){var n=t.getEntityValue(e);return null!==n&&void 0!==n})},e.prototype.getEntityIdMap=function(e){if(e){var t=(this.parentEntityMetadata,this.primaryColumns).reduce(function(t,n){return n.isObjectId?Object.assign(t,n.getEntityValueMap(e)):r.OrmUtils.mergeDeep(t,n.getEntityValueMap(e))},{});return Object.keys(t).length>0?t:void 0}},e.prototype.getDatabaseEntityIdMap=function(e){var t={};return(this.parentEntityMetadata,this.primaryColumns).forEach(function(n){var r=n.getEntityValue(e);null!==r&&void 0!==r&&(t[n.databaseName]=r)}),Object.keys(t).every(function(e){return void 0!==t[e]&&null!==t[e]})?t:void 0},e.prototype.getEntityIdMixedMap=function(e){if(e){var t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?t[this.primaryColumns[0].propertyName]:t}},e.prototype.checkIfObjectContainsAllPrimaryKeys=function(e){return this.primaryColumns.every(function(t){return e.hasOwnProperty(t.propertyName)})},e.prototype.extractRelationValuesFromEntity=function(e,t){var n=[];return t.forEach(function(t){var r=t.getEntityValue(e);r instanceof Array?r.forEach(function(e){return n.push([t,e,t.inverseEntityMetadata])}):r&&n.push([t,r,t.inverseEntityMetadata])}),n},e.prototype.registerColumn=function(e){this.ownColumns.push(e),this.columns=this.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},this.ownColumns),this.parentIdColumns=this.columns.filter(function(e){return e.isParentId}),this.primaryColumns=this.columns.filter(function(e){return e.isPrimary}),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.propertiesMap=this.createPropertiesMap()},e.prototype.createPropertiesMap=function(){var e={};return this.columns.forEach(function(t){return r.OrmUtils.mergeDeep(e,t.createValueMap(t.propertyPath))}),this.relations.forEach(function(t){return r.OrmUtils.mergeDeep(e,t.createValueMap(t.propertyPath))}),e},e}(),e("EntityMetadata",i)}}}),System.register("typeorm/decorator/options/ColumnOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/types/ColumnMode",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/ColumnMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/ColumnMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isUnique=!1,this.isNullable=!1,this.comment="",this.isVirtual=!1,this.isParentId=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isVersion=!1,this.isObjectId=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=String(e.args.options.length)),e.args.options.primary&&(this.isPrimary=e.args.options.primary),e.args.options.generated&&(this.isGenerated=e.args.options.generated),e.args.options.unique&&(this.isUnique=e.args.options.unique),null===e.args.options.default&&(this.isNullable=!0),e.args.options.nullable&&(this.isNullable=e.args.options.nullable),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.enum&&(this.enum=e.args.options.enum),e.args.options.array&&(this.array=e.args.options.array),e.args.mode&&(this.isVirtual="virtual"===e.args.mode,this.isParentId="parentId"===e.args.mode,this.isDiscriminator="discriminator"===e.args.mode,this.isTreeLevel="treeLevel"===e.args.mode,this.isCreateDate="createDate"===e.args.mode,this.isUpdateDate="updateDate"===e.args.mode,this.isVersion="version"===e.args.mode,this.isObjectId="objectId"===e.args.mode),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type=e.connection.driver.mappedDataTypes.createDate,this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.createDateDefault})),this.isUpdateDate&&(this.type=e.connection.driver.mappedDataTypes.updateDate,this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.updateDateDefault})),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version)}return e.prototype.createValueMap=function(e){var t=this;if(this.embeddedMetadata){var n=this.embeddedMetadata.parentPropertyNames.slice(),r=function(n,i){var o=n.shift();return o?(i[o]={},r(n,i[o]),i):(i[t.propertyName]=e,i)};return r(n,{})}return i={},i[this.propertyName]=e,i;var i},e.prototype.getEntityValueMap=function(e){var t=this;if(this.embeddedMetadata){var n=this.embeddedMetadata.parentPropertyNames.slice(),r=function(e,n,i){var o=e.shift();return o?(i[o]={},r(e,n?n[o]:void 0,i[o]),i):(i[t.propertyName]=n?n[t.propertyName]:void 0,i)};return r(n,e,{})}return i={},i[this.propertyName]=e[this.propertyName],i;var i},e.prototype.getEntityValue=function(e){if(!this.embeddedMetadata){if(this.relationMetadata&&this.referencedColumn&&this.isVirtual){var t=this.relationMetadata.getEntityValue(e);return t?this.referencedColumn.getEntityValue(t):void 0}return e[this.propertyName]}var n=this.embeddedMetadata.parentPropertyNames.slice(),r=function(e,t){var n=e.shift();return n?r(e,t[n]):t},i=r(n,e);if(i)return this.relationMetadata&&this.referencedColumn&&this.isVirtual?(t=this.relationMetadata.getEntityValue(i))?this.referencedColumn.getEntityValue(t):void 0:i[this.propertyName]},e.prototype.setEntityValue=function(e,t){var n=this;if(this.embeddedMetadata){var r=function(e,i){var o=e.shift();return o?(i[o.propertyName]||(i[o.propertyName]=o.create()),r(e,i[o.propertyName]),i):(i[n.propertyName]=t,i)};return r(this.embeddedMetadata.embeddedMetadataTree.slice(),e)}e[this.propertyName]=t},e.prototype.build=function(e){return this.propertyPath=this.buildPropertyPath(),this.databaseName=this.buildDatabaseName(e),this.databaseNameWithoutPrefixes=e.columnName(this.propertyName,this.givenDatabaseName,[]),this},e.prototype.buildPropertyPath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+=this.referencedColumn.propertyName+"."),e+this.propertyName},e.prototype.buildDatabaseName=function(e){var t=this.embeddedMetadata?this.embeddedMetadata.parentPropertyNames:[];return e.columnName(this.propertyName,this.givenDatabaseName,t)},e}(),e("ColumnMetadata",n)}}}),System.register("typeorm/schema-builder/schema/ColumnSchema",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,e&&(this.name=e.name||"",this.type=e.type||"",this.default=e.default,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.comment=e.comment,this.enum=e.enum)}return e.prototype.clone=function(){var t=new e;return t.name=this.name,t.type=this.type,t.default=this.default,t.isNullable=this.isNullable,t.isGenerated=this.isGenerated,t.isPrimary=this.isPrimary,t.isUnique=this.isUnique,t.comment=this.comment,t},e.create=function(t,n,r){var i=new e;return i.name=t.databaseName,i.default=r,i.comment=t.comment,i.isGenerated=t.isGenerated,i.isNullable=t.isNullable,i.type=n,i.isPrimary=t.isPrimary,i.isUnique=t.isUnique,i.enum=t.enum,i},e}(),e("ColumnSchema",n)}}}),System.register("typeorm/query-runner/QueryRunner",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/Driver",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/error/RepositoryNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;r.name="RepositoryNotFoundError";var i="function"==typeof n&&n.name?n.name:n;return r.message='No repository for "'+i+'" was found. Looks like this entity is not registered in current "'+t+'" connection?',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("RepositoryNotFoundError",n)}}}),System.register("typeorm/util/RandomGenerator",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.sha1=function(e){var t,n,r,i,o,a,s,u,c,l=function(e,t){return e<<t|e>>>32-t},d=function(e){var t,n="";for(t=7;t>=0;t--)n+=(e>>>4*t&15).toString(16);return n},p=new Array(80),m=1732584193,f=4023233417,y=2562383102,h=271733878,g=3285377520,v=(e=encodeURIComponent(e)).length,b=[];for(n=0;n<v-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(r);switch(v%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(v-1)<<24|8388608;break;case 2:n=e.charCodeAt(v-2)<<24|e.charCodeAt(v-1)<<16|32768;break;case 3:n=e.charCodeAt(v-3)<<24|e.charCodeAt(v-2)<<16|e.charCodeAt(v-1)<<8|128}for(b.push(n);b.length%16!=14;)b.push(0);for(b.push(v>>>29),b.push(v<<3&4294967295),t=0;t<b.length;t+=16){for(n=0;n<16;n++)p[n]=b[t+n];for(n=16;n<=79;n++)p[n]=l(p[n-3]^p[n-8]^p[n-14]^p[n-16],1);for(i=m,o=f,a=y,s=h,u=g,n=0;n<=19;n++)c=l(i,5)+(o&a|~o&s)+u+p[n]+1518500249&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=20;n<=39;n++)c=l(i,5)+(o^a^s)+u+p[n]+1859775393&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=40;n<=59;n++)c=l(i,5)+(o&a|o&s|a&s)+u+p[n]+2400959708&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=60;n<=79;n++)c=l(i,5)+(o^a^s)+u+p[n]+3395469782&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;m=m+i&4294967295,f=f+o&4294967295,y=y+a&4294967295,h=h+s&4294967295,g=g+u&4294967295}return(c=d(m)+d(f)+d(y)+d(h)+d(g)).toLowerCase()},e}(),e("RandomGenerator",n)}}}),System.register("typeorm/util/StringUtils",[],function(e,t){"use strict";t&&t.id;return e("camelCase",function(e){return e.replace(/^([A-Z])|[\s-_](\w)/g,function(e,t,n,r){return n?n.toUpperCase():t.toLowerCase()})}),e("snakeCase",function(e){return e.replace(/(?:^|\.?)([A-Z])/g,function(e,t){return"_"+t.toLowerCase()}).replace(/^_/,"")}),e("titleCase",function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}),{setters:[],execute:function(){}}}),System.register("typeorm/naming-strategy/DefaultNamingStrategy",["typeorm/util/RandomGenerator","typeorm/util/StringUtils"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(){}return e.prototype.tableName=function(e,t){return t||r.snakeCase(e)},e.prototype.closureJunctionTableName=function(e){return e+"_closure"},e.prototype.columnName=function(e,t,n){return n.length?r.camelCase(n.join("_"))+(t?r.titleCase(t):r.titleCase(e)):t||e},e.prototype.relationName=function(e){return e},e.prototype.indexName=function(e,t,r){if(e)return e;var i="ind_"+t+"_"+r.join("_");return"ind_"+n.RandomGenerator.sha1(i).substr(0,26)},e.prototype.joinColumnName=function(e,t){return r.camelCase(e+"_"+t)},e.prototype.joinTableName=function(e,t,n,i){return r.snakeCase(e+"_"+n.replace(/\./gi,"_")+"_"+t)},e.prototype.joinTableColumnDuplicationPrefix=function(e,t){return e+"_"+t},e.prototype.joinTableColumnName=function(e,t,n){return r.camelCase(e+"_"+(n||t))},e.prototype.foreignKeyName=function(e,t,r,i){var o=e+"_"+t.join("_")+"_"+r+"_"+i.join("_");return"fk_"+n.RandomGenerator.sha1(o).substr(0,27)},e.prototype.classTableInheritanceParentColumnName=function(e,t){return r.camelCase(e+"_"+t)},e.prototype.prefixTableName=function(e,t){return e+t},e}(),e("DefaultNamingStrategy",i)}}}),System.register("typeorm/connection/error/CannotExecuteNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotExecuteNotConnectedError",n.message='Cannot execute operation on "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotExecuteNotConnectedError",n)}}}),System.register("typeorm/connection/error/CannotConnectAlreadyConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotConnectAlreadyConnectedError",n.message='Cannot create a "'+t+'" connection because connection to the database already established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotConnectAlreadyConnectedError",n)}}}),System.register("typeorm/connection/error/RepositoryNotTreeError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;n.name="RepositoryNotTreeError";var r="function"==typeof t&&t.name?t.name:t;return n.message='Repository of the "'+r+'" class is not a TreeRepository. Try to use @ClosureTable decorator instead of @Table.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("RepositoryNotTreeError",n)}}}),System.register("typeorm/logger/Logger",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,r){(this.options.logQueries||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("log","executing query: "+e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):""),r)},e.prototype.logFailedQuery=function(e,t,r){(this.options.logQueries||this.options.logOnlyFailedQueries||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("error","query failed: "+e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):""),r)},e.prototype.logQueryError=function(e,t){(this.options.logFailedQueryError||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("error","error during executing query:"+e,t)},e.prototype.logSchemaBuild=function(e,t){(this.options.logSchemaCreation||n.PlatformTools.getEnvVariable("LOGGER_CLI_SCHEMA_SYNC"))&&this.log("info",e,t)},e.prototype.log=function(e,t,n){if(this.options)if(this.options.logger)this.options.logger(e,t,n);else switch(e){case"log":console.log(t);break;case"info":console.info(t);break;case"warn":console.warn(t);break;case"error":console.error(t)}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),e("Logger",r)}}}),System.register("typeorm/metadata-args/error/EntityMetadataNotFound",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;n.name="EntityMetadataNotFound";var r="function"==typeof t&&t.name?t.name:t;return n.message='No metadata for "'+r+'" was found.',n}return __extends(t,e),t}(Error),e("EntityMetadataNotFound",n)}}}),System.register("typeorm/migration/MigrationInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/migration/Migration",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){return function(e,t,n){this.timestamp=e,this.name=t,this.instance=n}}(),e("Migration",n)}}}),System.register("typeorm/migration/MigrationExecutor",["typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/ColumnSchema","typeorm/migration/Migration","typeorm/util/PromiseUtils"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e,t){this.connection=e,this.queryRunner=t||e.createQueryRunner()}return e.prototype.executePendingMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return[4,this.createMigrationsTableIfNotExist()];case 1:return c.sent(),[4,this.loadExecutedMigrations()];case 2:return e=c.sent(),t=this.getLatestMigration(e),n=this.getMigrations(),(r=n.filter(function(n){if(e.find(function(e){return e.name===n.name}))return!1;if(t&&n.timestamp<t.timestamp)throw new Error("New migration found: "+n.name+", however this migration's timestamp is not valid. Migration's timestamp should not be older then migrations already executed in the database.");return!0})).length?(this.connection.logger.log("info",e.length+" migrations are already loaded in the database."),this.connection.logger.log("info",n.length+" migrations were found in the source code."),t&&this.connection.logger.log("info",t.name+" is the last executed migration. It was executed on "+new Date(1e3*t.timestamp).toString()+"."),this.connection.logger.log("info",r.length+" migrations are new migrations that needs to be executed."),i=!1,this.queryRunner.isTransactionActive?[3,4]:[4,this.queryRunner.startTransaction()]):(this.connection.logger.log("info","No migrations are pending"),[2]);case 3:c.sent(),i=!0,c.label=4;case 4:return c.trys.push([4,8,,13]),[4,o.PromiseUtils.runInSequence(r,function(e){return e.instance.up(u.queryRunner).then(function(){return u.insertExecutedMigration(e)}).then(function(){u.connection.logger.log("info","Migration "+e.name+" has been executed successfully.")})})];case 5:return c.sent(),i?[4,this.queryRunner.commitTransaction()]:[3,7];case 6:c.sent(),c.label=7;case 7:return[3,13];case 8:if(a=c.sent(),!i)return[3,12];c.label=9;case 9:return c.trys.push([9,11,,12]),[4,this.queryRunner.rollbackTransaction()];case 10:return c.sent(),[3,12];case 11:return s=c.sent(),[3,12];case 12:throw a;case 13:return[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a;return __generator(this,function(s){switch(s.label){case 0:return[4,this.createMigrationsTableIfNotExist()];case 1:return s.sent(),[4,this.loadExecutedMigrations()];case 2:if(e=s.sent(),!(t=this.getLatestMigration(e)))return this.connection.logger.log("info","No migrations was found in the database. Nothing to revert!"),[2];if(n=this.getMigrations(),!(r=n.find(function(e){return e.name===t.name})))throw new Error("No migration "+t.name+" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.");return this.connection.logger.log("info",e.length+" migrations are already loaded in the database."),this.connection.logger.log("info",t.name+" is the last executed migration. It was executed on "+new Date(1e3*t.timestamp).toString()+"."),this.connection.logger.log("info","Now reverting it..."),i=!1,this.queryRunner.isTransactionActive?[3,4]:[4,this.queryRunner.startTransaction()];case 3:s.sent(),i=!0,s.label=4;case 4:return s.trys.push([4,9,,14]),[4,r.instance.down(this.queryRunner)];case 5:return s.sent(),[4,this.deleteExecutedMigration(r)];case 6:return s.sent(),this.connection.logger.log("info","Migration "+r.name+" has been reverted successfully."),i?[4,this.queryRunner.commitTransaction()]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,14];case 9:if(o=s.sent(),!i)return[3,13];s.label=10;case 10:return s.trys.push([10,12,,13]),[4,this.queryRunner.rollbackTransaction()];case 11:return s.sent(),[3,13];case 12:return a=s.sent(),[3,13];case 13:throw o;case 14:return[2]}})})},e.prototype.createMigrationsTableIfNotExist=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.queryRunner.hasTable("migrations")];case 1:return e=t.sent(),e?[3,3]:[4,this.queryRunner.createTable(new n.TableSchema("migrations",[new r.ColumnSchema({name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!0,isNullable:!1}),new r.ColumnSchema({name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1})]))];case 2:t.sent(),t.label=3;case 3:return[2]}})})},e.prototype.loadExecutedMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.connection.manager.createQueryBuilder(this.queryRunner).select().from("migrations","migrations").getRawMany()];case 1:return e=t.sent(),[2,e.map(function(e){return new i.Migration(parseInt(e.timestamp),e.name)})]}})})},e.prototype.getMigrations=function(){return this.connection.migrations.map(function(e){var t=e.constructor.name,n=parseInt(t.substr(-13));if(!n)throw new Error("Migration class name should contain a class name at the end of the file. "+t+" migration name is wrong.");return new i.Migration(n,t,e)}).sort(function(e,t){return e.timestamp-t.timestamp})},e.prototype.getLatestMigration=function(e){var t=e.map(function(e){return e}).sort(function(e,t){return-1*(e.timestamp-t.timestamp)});return t.length>0?t[0]:void 0},e.prototype.insertExecutedMigration=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.queryRunner.insert("migrations",{timestamp:e.timestamp,name:e.name})];case 1:return t.sent(),[2]}})})},e.prototype.deleteExecutedMigration=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.queryRunner.delete("migrations",{timestamp:e.timestamp,name:e.name})];case 1:return t.sent(),[2]}})})},e}(),e("MigrationExecutor",a)}}}),System.register("typeorm/metadata-builder/error/MissingPrimaryColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="MissingPrimaryColumnError",n.message='Entity "'+t.name+'" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.',n}return __extends(t,e),t}(Error),e("MissingPrimaryColumnError",n)}}}),System.register("typeorm/metadata-builder/error/CircularRelationsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Circular relations detected: "+t+". To resolve this issue you need to set nullable: false somewhere in this dependency structure.")||this;return n.name="CircularRelationsError",n}return __extends(t,e),t}(Error),e("CircularRelationsError",n)}}}),System.register("typeorm/util/DepGraph",[],function(e,t){"use strict";function n(e,t,n){var r=[],i={};return function o(a){i[a]=!0,r.push(a),e[a].forEach(function(e){if(i[e]){if(r.indexOf(e)>=0)throw r.push(e),new Error("Dependency Cycle Found: "+r.join(" -> "))}else o(e)}),r.pop(),t&&0!==e[a].length||-1!==n.indexOf(a)||n.push(a)}}var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(2===arguments.length?this.nodes[e]=t:this.nodes[e]=e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach(function(t){Object.keys(t).forEach(function(n){var r=t[n].indexOf(e);r>=0&&t[n].splice(r,1)},this)}))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw new Error("Node does not exist: "+e)},e.prototype.setNodeData=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);this.nodes[e]=t},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);if(!this.hasNode(t))throw new Error("Node does not exist: "+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t))>=0&&this.outgoingEdges[e].splice(n,1),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e))>=0&&this.incomingEdges[t].splice(n,1)},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var r=[];n(this.outgoingEdges,t,r)(e);var i=r.indexOf(e);return i>=0&&r.splice(i,1),r}throw new Error("Node does not exist: "+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var r=[];n(this.incomingEdges,t,r)(e);var i=r.indexOf(e);return i>=0&&r.splice(i,1),r}throw new Error("Node does not exist: "+e)},e.prototype.overallOrder=function(e){var t=this,r=[],i=Object.keys(this.nodes);if(0===i.length)return r;var o=n(this.outgoingEdges,!1,[]);i.forEach(function(e){o(e)});var a=n(this.outgoingEdges,e,r);return i.filter(function(e){return 0===t.incomingEdges[e].length}).forEach(function(e){a(e)}),r},e}(),e("DepGraph",r)}}}),System.register("typeorm/metadata-builder/EntityMetadataValidator",["typeorm/metadata-builder/error/MissingPrimaryColumnError","typeorm/metadata-builder/error/CircularRelationsError","typeorm/util/DepGraph"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(){}return e.prototype.validateMany=function(e){var t=this;e.forEach(function(n){return t.validate(n,e)}),this.validateDependencies(e)},e.prototype.validate=function(e,t){if(!e.isClassTableChild&&!e.primaryColumns.length&&!e.isJunction)throw new n.MissingPrimaryColumnError(e);if("single-table"===e.inheritanceType){if(!e.discriminatorColumn)throw new Error("Entity "+e.name+" using single-table inheritance, it should also have a discriminator column. Did you forget to put @DiscriminatorColumn decorator?");if(-1!==["",void 0,null].indexOf(e.discriminatorValue))throw new Error("Entity "+e.name+" has empty discriminator value. Discriminator value should not be empty.");var r=t.find(function(t){return t!==e&&t.discriminatorValue===e.discriminatorValue});if(r)throw new Error("Entities "+e.name+" and "+r.name+" as equal discriminator values. Make sure their discriminator values are not equal using @DiscriminatorValue decorator.")}e.relationCounts.forEach(function(e){if(e.relation.isManyToOne||e.relation.isOneToOne)throw new Error("Relation count can not be implemented on ManyToOne or OneToOne relations.")}),e.relations.forEach(function(e){}),e.relations.forEach(function(t){if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw new Error("Relation "+e.name+"#"+t.propertyName+" and "+t.inverseRelation.entityMetadata.name+"#"+t.inverseRelation.propertyName+" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.")})},e.prototype.validateDependencies=function(e){var t=new i.DepGraph;e.forEach(function(e){t.addNode(e.name)}),e.forEach(function(e){e.relationsWithJoinColumns.filter(function(e){return!e.isNullable}).forEach(function(n){t.addDependency(e.name,n.inverseEntityMetadata.name)})});try{t.overallOrder()}catch(e){throw new r.CircularRelationsError(e.toString().replace("Error: Dependency Cycle Found: ",""))}},e}(),e("EntityMetadataValidator",o)}}}),System.register("typeorm/driver/sqlite/SqliteConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/websql/WebSqlConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/ConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-manager/EntityManagerFactory",["typeorm/entity-manager/EntityManager","typeorm/entity-manager/MongoEntityManager","typeorm/driver/mongodb/MongoDriver"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(){}return e.prototype.create=function(e,t){return e.driver instanceof i.MongoDriver?new r.MongoEntityManager(e):new n.EntityManager(e,t)},e}(),e("EntityManagerFactory",o)}}}),System.register("typeorm/logger/LoggerFactory",["typeorm/logger/Logger"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){}return e.prototype.create=function(e){return new n.Logger(e)},e}(),e("LoggerFactory",r)}}}),System.register("typeorm/repository/RepositoryFactory",["typeorm/repository/TreeRepository","typeorm/repository/Repository","typeorm/driver/mongodb/MongoDriver","typeorm/repository/MongoRepository"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(){}return e.prototype.create=function(e,t,a){if(t.isClosure)return(s=new n.TreeRepository).manager=e.manager,s.metadata=t,s.queryRunner=a,s;var s=void 0;return s=e.driver instanceof i.MongoDriver?new o.MongoRepository:new r.Repository,s.manager=e.manager,s.metadata=t,s.queryRunner=a,s},e}(),e("RepositoryFactory",a)}}}),System.register("typeorm/driver/error/MissingDriverError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="MissingDriverError",n.message="Wrong driver "+t+' given. Supported drivers are: "mysql", "postgres", "mssql", "oracle", "mariadb", "sqlite".',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("MissingDriverError",n)}}}),System.register("typeorm/driver/websql/WebsqlQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/schema-builder/schema/ColumnSchema","typeorm/metadata/ColumnMetadata","typeorm/schema-builder/schema/TableSchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError"],function(e,t){"use strict";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e){this.driver=e,this.isReleased=!1,this.isTransactionActive=!1,this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.connection=e.connection,this.manager=e.connection.manager}return e.prototype.connect=function(){var e=this;if(this.databaseConnection)return Promise.resolve(this.databaseConnection);if(this.databaseConnectionPromise)return this.databaseConnectionPromise;var t=Object.assign({},{database:this.driver.options.database},this.driver.options.extra||{});return this.databaseConnectionPromise=new Promise(function(n,r){e.databaseConnection=openDatabase(t.database,t.version,t.description,t.size),n(e.databaseConnection)}),this.databaseConnectionPromise},e.prototype.release=function(){return this.isReleased=!0,Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new s.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new s.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return this.isTransactionActive=!1,[2]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new s.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return this.isTransactionActive=!1,[2]})})},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new s.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){return __awaiter(n,void 0,void 0,function(){var n,o=this;return __generator(this,function(a){switch(a.label){case 0:return this.driver.connection.logger.logQuery(e,t,this),[4,this.connect()];case 1:return(n=a.sent()).transaction(function(n){n.executeSql(e,t,function(e,t){var n=Object.keys(t.rows).filter(function(e){return"length"!==e}).map(function(e){return t.rows[e]});r(n)},function(n,r){return o.driver.connection.logger.logFailedQuery(e,t,o),o.driver.connection.logger.logQueryError(r,o),i(r)})}),[2]}})})})},e.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by websqlite driver.")},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u=this;return __generator(this,function(c){return r=Object.keys(t),i=r.map(function(e){return'"'+e+'"'}).join(", "),o=r.map(function(e,t){return"$"+(t+1)}).join(","),a=i.length>0?'INSERT INTO "'+e+'"('+i+") VALUES ("+o+")":'INSERT INTO "'+e+'" DEFAULT VALUES',s=r.map(function(e){return t[e]}),[2,new Promise(function(e,t){return __awaiter(u,void 0,void 0,function(){var r,i=this;return __generator(this,function(o){switch(o.label){case 0:return this.driver.connection.logger.logQuery(a,s,this),[4,this.connect()];case 1:return(r=o.sent()).transaction(function(r){r.executeSql(a,s,function(t,r){if(n)return e(r.insertId);e()},function(e,n){return i.driver.connection.logger.logFailedQuery(a,s,i),i.driver.connection.logger.logQueryError(n,i),t(n)})}),[2]}})})})]})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=this.parametrize(t).join(", "),i=this.parametrize(n,Object.keys(t).length).join(" AND "),o='UPDATE "'+e+'" SET '+r+" "+(i?" WHERE "+i:""),a=Object.keys(t).map(function(e){return t[e]}),s=Object.keys(n).map(function(e){return n[e]}),u=a.concat(s),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o='DELETE FROM "'+e+'" WHERE '+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i="",i=r?'INSERT INTO "'+e+'"("ancestor", "descendant", "level") SELECT "ancestor", '+t+', "level" + 1 FROM "'+e+'" WHERE "descendant" = '+n+" UNION ALL SELECT "+t+", "+t+", 1":'INSERT INTO "'+e+'"("ancestor", "descendant") SELECT "ancestor", '+t+' FROM "'+e+'" WHERE "descendant" = '+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query('SELECT MAX("level") as "level" FROM '+e+' WHERE "descendant" = '+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query("SELECT * FROM sqlite_master WHERE type = 'table' AND name IN ("+t+")")]):[2,[]];case 1:return n=i.sent(),n&&n.length?[2,Promise.all(n.map(function(e){return __awaiter(r,void 0,void 0,function(){var t;return __generator(this,function(n){return t=new a.TableSchema(e.name),[2,t]})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM sqlite_master WHERE type = 'table' AND name = "+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,(r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return""+e.name}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n='PRAGMA table_info("'+e+'")',[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.find(function(e){return e.name===t})]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).addColumns([t]),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).addColumns(t),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,o,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(o=void 0,!(o=t instanceof i.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof i.ColumnSchema?s=n:(s=o.clone()).name=n,[2,this.changeColumn(r,o,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(o){switch(o.label){case 0:return n=void 0,e instanceof a.TableSchema?(n=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:n=o.sent(),o.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(r=void 0,!(r=t instanceof i.ColumnSchema?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return[2,this.recreateTable(n)]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.recreateTable(e)]})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.dropColumns(e,[t])]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){return(n=e.clone()).removeColumns(t),[2,this.recreateTable(n)]})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.recreateTable(e)]})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.createForeignKeys(e,[t])]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).addForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.dropForeignKeys(e,[t])]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).removeForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(","),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return e='DROP INDEX "'+t+'"',[4,this.query(e)];case 1:return n.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query('DELETE FROM "'+e+'"')];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return[4,this.startTransaction()];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,6,,11]),e="select 'drop table ' || name || ';' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'",[4,this.query(e)];case 3:return t=o.sent(),[4,Promise.all(t.map(function(e){return i.query(e.query)}))];case 4:return o.sent(),[4,this.commitTransaction()];case 5:return o.sent(),[3,11];case 6:n=o.sent(),o.label=7;case 7:return o.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:return o.sent(),[3,10];case 9:return r=o.sent(),[3,10];case 10:throw n;case 11:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,n){return'"'+e+'"=$'+(t+n+1)})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'"';return e instanceof o.ColumnMetadata?t+=" "+this.driver.normalizeType(e):t+=" "+e.type,!0!==e.isNullable&&(t+=" NOT NULL"),!0===e.isUnique&&(t+=" UNIQUE"),!0===e.isGenerated&&(t+=" PRIMARY KEY AUTOINCREMENT"),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT "+e.default),t},e.prototype.recreateTable=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,d=this;return __generator(this,function(p){switch(p.label){case 0:return n=e.columns.map(function(e){return d.buildCreateColumnSql(e)}).join(", "),r=e.columns.map(function(e){return'"'+e.name+'"'}).join(", "),i='CREATE TABLE "temporary_'+e.name+'" ('+n,e.foreignKeys.forEach(function(e){var t=e.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n=e.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", ");i+=", FOREIGN KEY("+t+') REFERENCES "'+e.referencedTableName+'"('+n+")",e.onDelete&&(i+=" ON DELETE "+e.onDelete)}),(o=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(i+=", PRIMARY KEY("+o.map(function(e){return""+e.name}).join(", ")+")"),i+=")",[4,this.query(i)];case 1:return p.sent(),a=t?t.columns.map(function(e){return'"'+e.name+'"'}).join(", "):r,s='INSERT INTO "temporary_'+e.name+'"('+a+") SELECT "+a+' FROM "'+e.name+'"',[4,this.query(s)];case 2:return p.sent(),u='DROP TABLE "'+e.name+'"',[4,this.query(u)];case 3:return p.sent(),c='ALTER TABLE "temporary_'+e.name+'" RENAME TO "'+e.name+'"',[4,this.query(c)];case 4:return p.sent(),l=e.indices.map(function(t){return d.createIndex(e.name,t)}),[4,Promise.all(l)];case 5:return p.sent(),[2]}})})},e.prototype.getTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e instanceof a.TableSchema?[2,e]:[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:if(!(t=n.sent()))throw new Error("Table named "+e+" was not found in the database.");return[2,t]}})})},e}(),e("WebsqlQueryRunner",u)}}}),System.register("typeorm/driver/websql/WebsqlDriver",["typeorm/driver/DriverUtils","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DateUtils","typeorm/driver/websql/WebsqlQueryRunner","typeorm/schema-builder/RdbmsSchemaBuilder"],function(e,t){"use strict";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(e){if(this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","datetime"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",version:"int",treeLevel:"int",migrationName:"varchar",migrationTimestamp:"bigint"},this.connection=e,this.options=e.options,Object.assign(e.options,n.DriverUtils.buildDriverOptions(e.options)),!this.options.database)throw new r.DriverOptionNotSetError("database")}return e.prototype.connect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return Promise.resolve()},e.prototype.createSchemaBuilder=function(){return new a.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(){return new o.WebsqlQueryRunner(this)},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){return n.push(t[e.substr(1)]),"?"}),[e,n]},e.prototype.escape=function(e){return e},e.prototype.preparePersistentValue=function(e,t){return null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?i.DateUtils.mixedDateToDateString(e):"time"===t.type?i.DateUtils.mixedDateToTimeString(e):"datetime"===t.type?i.DateUtils.mixedDateToUtcDatetimeString(e):"json"===t.type?JSON.stringify(e):"simple-array"===t.type?i.DateUtils.simpleArrayToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return t.type===Boolean?!!e:"datetime"===t.type?i.DateUtils.normalizeHydratedDate(e):"date"===t.type?i.DateUtils.mixedDateToDateString(e):"time"===t.type?i.DateUtils.mixedTimeToString(e):"json"===t.type?JSON.parse(e):"simple-array"===t.type?i.DateUtils.stringToSimpleArray(e):e},e.prototype.normalizeType=function(e){var t="";return e.type===Number?t+="integer":e.type===String?t+="varchar":e.type===Date?t+="datetime":e.type===Boolean?t+="boolean":e.type===Object?t+="text":"simple-array"===e.type?t+="text":t+=e.type,e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale&&(t+="("+e.scale+")"),t},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"1":"0":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":e.default},e}(),e("WebsqlDriver",s)}}}),System.register("typeorm/driver/sqlite/SqliteQueryRunner",["typeorm/driver/error/TransactionAlreadyStartedError","typeorm/driver/error/TransactionNotStartedError","typeorm/schema-builder/schema/ColumnSchema","typeorm/metadata/ColumnMetadata","typeorm/schema-builder/schema/TableSchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/query-runner/error/QueryRunnerAlreadyReleasedError","typeorm/util/RandomGenerator"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,p;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e}],execute:function(){p=function(){function e(e){this.driver=e,this.isReleased=!1,this.isTransactionActive=!1,this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.connection=e.connection,this.manager=e.connection.manager}return e.prototype.connect=function(){return Promise.resolve(this.driver.databaseConnection)},e.prototype.release=function(){return Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query("BEGIN TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){return __awaiter(n,void 0,void 0,function(){var n,o=this;return __generator(this,function(a){switch(a.label){case 0:return[4,this.connect()];case 1:return n=a.sent(),this.driver.connection.logger.logQuery(e,t,this),n.all(e,t,function(n,a){n?(o.driver.connection.logger.logFailedQuery(e,t,o),o.driver.connection.logger.logQueryError(n,o),i(n)):r(a)}),[2]}})})})},e.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by sqlite driver.")},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u=this;return __generator(this,function(c){return r=Object.keys(t),i=r.map(function(e){return'"'+e+'"'}).join(", "),o=r.map(function(e,t){return"$"+(t+1)}).join(","),a=i.length>0?'INSERT INTO "'+e+'"('+i+") VALUES ("+o+")":'INSERT INTO "'+e+'" DEFAULT VALUES',s=r.map(function(e){return t[e]}),[2,new Promise(function(e,t){return __awaiter(u,void 0,void 0,function(){var r,i;return __generator(this,function(o){switch(o.label){case 0:return this.driver.connection.logger.logQuery(a,s,this),r=this,[4,this.connect()];case 1:return(i=o.sent()).run(a,s,function(i){if(i)r.driver.connection.logger.logFailedQuery(a,s,this),r.driver.connection.logger.logQueryError(i,this),t(i);else{if(n)return e(this.lastID);e()}}),[2]}})})})]})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=this.parametrize(t).join(", "),i=this.parametrize(n,Object.keys(t).length).join(" AND "),o='UPDATE "'+e+'" SET '+r+" "+(i?" WHERE "+i:""),a=Object.keys(t).map(function(e){return t[e]}),s=Object.keys(n).map(function(e){return n[e]}),u=a.concat(s),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:return r="string"==typeof t?t:this.parametrize(t).join(" AND "),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o='DELETE FROM "'+e+'" WHERE '+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i="",i=r?'INSERT INTO "'+e+'"("ancestor", "descendant", "level") SELECT "ancestor", '+t+', "level" + 1 FROM "'+e+'" WHERE "descendant" = '+n+" UNION ALL SELECT "+t+", "+t+", 1":'INSERT INTO "'+e+'"("ancestor", "descendant") SELECT "ancestor", '+t+' FROM "'+e+'" WHERE "descendant" = '+n+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query("SELECT MAX(level) as level FROM "+e+" WHERE descendant = "+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.loadTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadTableSchemas([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.loadTableSchemas=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(o){switch(o.label){case 0:return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query("SELECT * FROM sqlite_master WHERE type = 'table' AND name IN ("+t+")")]):[2,[]];case 1:return n=o.sent(),n&&n.length?[2,Promise.all(n.map(function(e){return __awaiter(r,void 0,void 0,function(){var t,n,r,o,l,p,m,f,y,h,g,v=this;return __generator(this,function(b){switch(b.label){case 0:return t=new a.TableSchema(e.name),[4,Promise.all([this.query('PRAGMA table_info("'+e.name+'")'),this.query('PRAGMA index_list("'+e.name+'")'),this.query('PRAGMA foreign_key_list("'+e.name+'")')])];case 1:return n=b.sent(),r=n[0],o=n[1],l=n[2],p=void 0,-1!==(m=e.sql).indexOf("AUTOINCREMENT")&&(p=m.substr(0,m.indexOf("AUTOINCREMENT")),f=p.lastIndexOf(","),y=p.lastIndexOf("("),-1!==f?(p=p.substr(f),p=p.substr(0,p.lastIndexOf('"')),p=p.substr(p.indexOf('"')+1)):-1!==y&&(p=p.substr(y),p=p.substr(0,p.lastIndexOf('"')),p=p.substr(p.indexOf('"')+1))),t.columns=r.map(function(n){var r=new i.ColumnSchema;r.name=n.name,r.type=n.type.toLowerCase(),r.default=null!==n.dflt_value&&void 0!==n.dflt_value?n.dflt_value:void 0,r.isNullable=0===n.notnull,r.isPrimary=1===n.pk,r.comment="",r.isGenerated=p===n.name;var o=l.filter(function(e){return e.from===n.name}).map(function(t){var n=e.name+"_"+[t.from].join("_")+"_"+t.table+"_"+[t.to].join("_"),r="fk_"+d.RandomGenerator.sha1(n).substr(0,27);return new u.ForeignKeySchema(r,[t.from],[t.to],t.table,t.on_delete)});return t.addForeignKeys(o),r}),[4,Promise.all(o.filter(function(e){return"pk"===e.origin}).map(function(e){return __awaiter(v,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.query('PRAGMA index_info("'+e.name+'")')];case 1:return n=i.sent(),(r=n.map(function(e){return e.name})).forEach(function(n){t.primaryKeys.push(new c.PrimaryKeySchema(e.name,n))}),[2]}})})}))];case 2:return b.sent(),h=o.filter(function(e){return"pk"!==e.origin&&!t.foreignKeys.find(function(t){return t.name===e.name})&&!t.primaryKeys.find(function(t){return t.name===e.name})}).map(function(e){return e.name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){return __awaiter(v,void 0,void 0,function(){var r,i,a;return __generator(this,function(u){switch(u.label){case 0:return r=o.find(function(e){return e.name===n}),[4,this.query('PRAGMA index_info("'+r.name+'")')];case 1:return i=u.sent(),a=i.map(function(e){return e.name}),"sqlite_autoindex"===r.name.substr(0,"sqlite_autoindex".length)?(1===r.unique&&a.forEach(function(e){var n=t.columns.find(function(t){return t.name===e});n&&(n.isUnique=!0)}),[2,Promise.resolve(void 0)]):[2,new s.IndexSchema(e.name,r.name,a,"1"===r.unique)]}})})}),[4,Promise.all(h)];case 3:return g=b.sent(),t.indices=g.filter(function(e){return!!e}),[2,t]}})})}))]:[2,[]]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t="SELECT * FROM sqlite_master WHERE type = 'table' AND name = '"+e+"'",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),n='CREATE TABLE "'+e.name+'" ('+t,(r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(n+=", PRIMARY KEY("+r.map(function(e){return""+e.name}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n='PRAGMA table_info("'+e+'")',[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.find(function(e){return e.name===t})]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).addColumns([t]),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).addColumns(t),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,o,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof a.TableSchema?(r=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(o=void 0,!(o=t instanceof i.ColumnSchema?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,n instanceof i.ColumnSchema?s=n:(s=o.clone()).name=n,[2,this.changeColumn(r,o,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(o){switch(o.label){case 0:return n=void 0,e instanceof a.TableSchema?(n=e,[3,3]):[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:n=o.sent(),o.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(r=void 0,!(r=t instanceof i.ColumnSchema?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return[2,this.recreateTable(n)]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.recreateTable(e)]})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.dropColumns(e,[t])]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){return(n=e.clone()).removeColumns(t),[2,this.recreateTable(n)]})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.recreateTable(e)]})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.createForeignKeys(e,[t])]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).addForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.dropForeignKeys(e,[t])]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).removeForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=t.columnNames.map(function(e){return'"'+e+'"'}).join(","),r="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e+'"('+n+")",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return e='DROP INDEX "'+t+'"',[4,this.query(e)];case 1:return n.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query('DELETE FROM "'+e+'"')];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:return o.sent(),[4,this.startTransaction()];case 2:o.sent(),o.label=3;case 3:return o.trys.push([3,7,12,14]),e="select 'drop table ' || name || ';' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'",[4,this.query(e)];case 4:return t=o.sent(),[4,Promise.all(t.map(function(e){return i.query(e.query)}))];case 5:return o.sent(),[4,this.commitTransaction()];case 6:return o.sent(),[3,14];case 7:n=o.sent(),o.label=8;case 8:return o.trys.push([8,10,,11]),[4,this.rollbackTransaction()];case 9:return o.sent(),[3,11];case 10:return r=o.sent(),[3,11];case 11:throw n;case 12:return[4,this.query("PRAGMA foreign_keys = ON;")];case 13:return o.sent(),[7];case 14:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,n){return'"'+e+'"=$'+(t+n+1)})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'"';return e instanceof o.ColumnMetadata?t+=" "+this.driver.normalizeType(e):t+=" "+e.type,!0!==e.isNullable&&(t+=" NOT NULL"),!0===e.isUnique&&(t+=" UNIQUE"),!0===e.isGenerated&&(t+=" PRIMARY KEY AUTOINCREMENT"),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT ("+e.default+")"),t},e.prototype.recreateTable=function(e,t,n){return void 0===n&&(n=!0),__awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c,l,d,p=this;return __generator(this,function(m){switch(m.label){case 0:return r=e.columns.map(function(e){return p.buildCreateColumnSql(e)}).join(", "),i=e.columns.map(function(e){return'"'+e.name+'"'}).join(", "),o='CREATE TABLE "temporary_'+e.name+'" ('+r,e.foreignKeys.forEach(function(e){var t=e.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n=e.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", ");o+=", FOREIGN KEY("+t+') REFERENCES "'+e.referencedTableName+'"('+n+")",e.onDelete&&(o+=" ON DELETE "+e.onDelete)}),(a=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(o+=", PRIMARY KEY("+a.map(function(e){return""+e.name}).join(", ")+")"),o+=")",[4,this.query(o)];case 1:return m.sent(),s=t?t.columns.map(function(e){return'"'+e.name+'"'}).join(", "):i,n?(u='INSERT INTO "temporary_'+e.name+'"('+s+") SELECT "+s+' FROM "'+e.name+'"',[4,this.query(u)]):[3,3];case 2:m.sent(),m.label=3;case 3:return c='DROP TABLE "'+e.name+'"',[4,this.query(c)];case 4:return m.sent(),l='ALTER TABLE "temporary_'+e.name+'" RENAME TO "'+e.name+'"',[4,this.query(l)];case 5:return m.sent(),d=e.indices.map(function(t){return p.createIndex(e.name,t)}),[4,Promise.all(d)];case 6:return m.sent(),[2]}})})},e.prototype.getTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e instanceof a.TableSchema?[2,e]:[3,1];case 1:return[4,this.loadTableSchema(e)];case 2:if(!(t=n.sent()))throw new Error("Table named "+e+" was not found in the database.");return[2,t]}})})},e}(),e("SqliteQueryRunner",p)}}}),System.register("typeorm/driver/sqlite/SqliteDriver",["typeorm/driver/error/DriverPackageNotInstalledError","typeorm/driver/sqlite/SqliteQueryRunner","typeorm/driver/error/DriverOptionNotSetError","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder"],function(e,t){"use strict";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e){if(this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","datetime"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",version:"integer",treeLevel:"integer",migrationName:"varchar",migrationTimestamp:"bigint"},this.connection=e,this.options=e.options,!this.options.database)throw new i.DriverOptionNotSetError("database");this.loadDependencies()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(function(e){return e?n(e):t()})})]})})},e.prototype.createSchemaBuilder=function(){return new s.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(){return this.queryRunner||(this.queryRunner=new r.SqliteQueryRunner(this)),this.queryRunner},e.prototype.preparePersistentValue=function(e,t){return null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?o.DateUtils.mixedDateToDateString(e):"time"===t.type?o.DateUtils.mixedDateToTimeString(e):"datetime"===t.type?o.DateUtils.mixedDateToUtcDatetimeString(e):"json"===t.type?JSON.stringify(e):"simple-array"===t.type?o.DateUtils.simpleArrayToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return t.type===Boolean?!!e:"datetime"===t.type?o.DateUtils.normalizeHydratedDate(e):"date"===t.type?o.DateUtils.mixedDateToDateString(e):"time"===t.type?o.DateUtils.mixedTimeToString(e):"json"===t.type?JSON.parse(e):"simple-array"===t.type?o.DateUtils.stringToSimpleArray(e):e},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(r,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"$"+n.length}).join(", "):(n.push(r),"$"+n.length)}),[e,n]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.normalizeType=function(e){var t="";return e.type===Number||"int"===e.type?t+="integer":e.type===String?t+="varchar":e.type===Date?t+="datetime":e.type===Boolean?t+="boolean":e.type===Object?t+="text":"simple-array"===e.type?t+="text":t+=e.type,e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale&&(t+="("+e.scale+")"),"varchar"===t&&(t+="(255)"),"int"===t&&(t+="(11)"),t},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"1":"0":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){var r=new e.sqlite.Database(e.options.database,function(e){if(e)return n(e);r.run("PRAGMA foreign_keys = ON;",function(e,i){if(e)return n(e);t(r)})})})},e.prototype.loadDependencies=function(){try{this.sqlite=a.PlatformTools.load("sqlite3").verbose()}catch(e){throw new n.DriverPackageNotInstalledError("SQLite","sqlite3")}},e}(),e("SqliteDriver",u)}}}),System.register("typeorm/driver/DriverFactory",["typeorm/driver/error/MissingDriverError","typeorm/driver/mongodb/MongoDriver","typeorm/driver/websql/WebsqlDriver","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/oracle/OracleDriver","typeorm/driver/sqlite/SqliteDriver","typeorm/driver/mysql/MysqlDriver","typeorm/driver/postgres/PostgresDriver"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(){}return e.prototype.create=function(e){var t=e.options.type;switch(t){case"mysql":return new u.MysqlDriver(e);case"postgres":return new c.PostgresDriver(e);case"mariadb":return new u.MysqlDriver(e);case"sqlite":return new s.SqliteDriver(e);case"oracle":return new a.OracleDriver(e);case"mssql":return new o.SqlServerDriver(e);case"websql":return new i.WebsqlDriver(e);case"mongodb":return new r.MongoDriver(e);default:throw new n.MissingDriverError(t)}},e}(),e("DriverFactory",l)}}}),System.register("typeorm/util/DirectoryExportedClassesLoader",["typeorm/platform/PlatformTools"],function(e,t){"use strict";t&&t.id;e("importClassesFromDirectories",function(e,t){function r(e,t){return e instanceof Function?t.push(e):e instanceof Object?Object.keys(e).forEach(function(n){return r(e[n],t)}):e instanceof Array&&e.forEach(function(e){return r(e,t)}),t}return void 0===t&&(t=[".js",".ts"]),r(e.reduce(function(e,t){return e.concat(n.PlatformTools.load("glob").sync(n.PlatformTools.pathNormilize(t)))},[]).filter(function(e){var r=e.substring(e.length-5,e.length);return-1!==t.indexOf(n.PlatformTools.pathExtname(e))&&".d.ts"!==r}).map(function(e){return n.PlatformTools.load(n.PlatformTools.pathResolve(e))}),[])}),e("importJsonsFromDirectories",function(e,t){return void 0===t&&(t=".json"),e.reduce(function(e,t){return e.concat(n.PlatformTools.load("glob").sync(n.PlatformTools.pathNormilize(t)))},[]).filter(function(e){return n.PlatformTools.pathExtname(e)===t}).map(function(e){return n.PlatformTools.load(n.PlatformTools.pathResolve(e))})});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/container",[],function(e,t){"use strict";t&&t.id;e("useContainer",function(e,t){r=e,i=t}),e("getFromContainer",function(e){if(r)try{var t=r.get(e);if(t)return t;if(!i||!i.fallback)return t}catch(e){if(!i||!i.fallbackOnErrors)throw e}return n.get(e)});var n,r,i;return{setters:[],execute:function(){e("defaultContainer",n=new(function(){function e(){this.instances=[]}return e.prototype.get=function(e){var t=this.instances.find(function(t){return t.type===e});return t||(t={type:e,object:new e},this.instances.push(t)),t.object},e}()))}}}),System.register("typeorm/metadata-args/NamingStrategyMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/JoinColumnMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/JoinTableMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EntitySubscriberMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/InheritanceMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/DiscriminatorValueMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EntityRepositoryMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/TransactionEntityMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-builder/MetadataUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.getInheritanceTree=function(e){var t=[e],n=function(e){var r=Object.getPrototypeOf(e);r&&r.name&&(t.push(r),n(r))};return n(e),t},e.isInherited=function(e,t){return e.prototype instanceof t},e.filterByTarget=function(e,t){return t?e.filter(function(e){return e.target&&-1!==t.indexOf(e.target)}):e},e}(),e("MetadataUtils",n)}}}),System.register("typeorm/metadata-args/MetadataArgsStorage",["typeorm/metadata-builder/MetadataUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){this.tables=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.columns=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return e.prototype.filterTables=function(e){return this.tables.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterColumns=function(e){return this.columns.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterRelations=function(e){return this.relations.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterRelationIds=function(e){return this.relationIds.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterRelationCounts=function(e){return this.relationCounts.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterIndices=function(e){return this.indices.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterListeners=function(e){return this.entityListeners.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterEmbeddeds=function(e){return this.embeddeds.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.findJoinTable=function(e,t){return this.joinTables.find(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterJoinColumns=function(e,t){return this.joinColumns.filter(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterSubscribers=function(e){return this.entitySubscribers.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterNamingStrategies=function(e){return this.namingStrategies.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterTransactionEntityManagers=function(e){return this.transactionEntityManagers.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterSingleTableChildren=function(e){return this.tables.filter(function(t){return t.target instanceof Function&&e instanceof Function&&n.MetadataUtils.isInherited(t.target,e)&&"single-table-child"===t.type})},e.prototype.findInheritanceType=function(e){return this.inheritances.find(function(t){return t.target===e})},e.prototype.findDiscriminatorValue=function(e){return this.discriminatorValues.find(function(t){return t.target===e})},e}(),e("MetadataArgsStorage",r)}}}),System.register("typeorm/metadata-builder/JunctionEntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata","typeorm/metadata/IndexMetadata"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var a=this,s=this.collectReferencedColumns(e,t),u=this.collectInverseReferencedColumns(e,t),c=t.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),l=new n.EntityMetadata({connection:this.connection,args:{target:"",name:c,type:"junction"}}),d=s.map(function(n){var i=t.joinColumns?t.joinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name)}):void 0,o=i&&i.name?i.name:a.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,n.propertyName,n.databaseName);return new r.ColumnMetadata({connection:a.connection,entityMetadata:l,referencedColumn:n,args:{target:"",mode:"virtual",propertyName:o,options:{name:o,length:n.length,type:n.type,nullable:!1,primary:!0}}})}),p=u.map(function(n){var i=t.inverseJoinColumns?t.inverseJoinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name)}):void 0,o=i&&i.name?i.name:a.connection.namingStrategy.joinTableColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,n.propertyName,n.databaseName);return new r.ColumnMetadata({connection:a.connection,entityMetadata:l,referencedColumn:n,args:{target:"",mode:"virtual",propertyName:o,options:{length:n.length,type:n.type,name:o,nullable:!1,primary:!0}}})});return l.ownColumns=d.concat(p),l.ownColumns.forEach(function(t){return t.relationMetadata=e}),l.foreignKeys=[new i.ForeignKeyMetadata({entityMetadata:l,referencedEntityMetadata:e.entityMetadata,columns:d,referencedColumns:s}),new i.ForeignKeyMetadata({entityMetadata:l,referencedEntityMetadata:e.inverseEntityMetadata,columns:p,referencedColumns:u})],l.indices=[new o.IndexMetadata({entityMetadata:l,columns:d,args:{target:"",unique:!1}}),new o.IndexMetadata({entityMetadata:l,columns:p,args:{target:"",unique:!1}})],l},e.prototype.collectReferencedColumns=function(e,t){var n=!!t.joinColumns&&t.joinColumns.find(function(e){return!!e.referencedColumnName});return!t.joinColumns||t.joinColumns&&!n?e.entityMetadata.columns.filter(function(e){return e.isPrimary}):t.joinColumns.map(function(t){var n=e.entityMetadata.columns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.entityMetadata.name);return n})},e.prototype.collectInverseReferencedColumns=function(e,t){var n=!!t.inverseJoinColumns,r=!!n&&t.inverseJoinColumns.find(function(e){return!!e.referencedColumnName});return!n||n&&!r?e.inverseEntityMetadata.primaryColumns:t.inverseJoinColumns.map(function(t){var n=e.inverseEntityMetadata.ownColumns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.inverseEntityMetadata.name);return n})},e}(),e("JunctionEntityMetadataBuilder",a)}}}),System.register("typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(e){this.connection=e}return e.prototype.build=function(e){var t=this,o=new n.EntityMetadata({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.tableNameWithoutPrefix,type:"closure-junction"}});return e.primaryColumns.forEach(function(e){o.ownColumns.push(new r.ColumnMetadata({connection:t.connection,entityMetadata:o,args:{target:"",mode:"virtual",propertyName:"ancestor_"+e.databaseName,options:{length:e.length,type:e.type}}})),o.ownColumns.push(new r.ColumnMetadata({connection:t.connection,entityMetadata:o,args:{target:"",mode:"virtual",propertyName:"descendant_"+e.databaseName,options:{length:e.length,type:e.type}}}))}),e.treeLevelColumn&&o.ownColumns.push(new r.ColumnMetadata({connection:this.connection,entityMetadata:o,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),o.foreignKeys=[new i.ForeignKeyMetadata({entityMetadata:o,referencedEntityMetadata:e,columns:[o.ownColumns[0]],referencedColumns:e.primaryColumns}),new i.ForeignKeyMetadata({entityMetadata:o,referencedEntityMetadata:e,columns:[o.ownColumns[1]],referencedColumns:e.primaryColumns})],o},e}(),e("ClosureJunctionEntityMetadataBuilder",o)}}}),System.register("typeorm/metadata-builder/RelationJoinColumnBuilder",["typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this.collectReferencedColumns(e,t);if(n.length){var i=this.collectColumns(e,t,n);return new r.ForeignKeyMetadata({entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:i,referencedColumns:n,onDelete:t.onDelete})}},e.prototype.collectReferencedColumns=function(e,t){var n=e.find(function(e){return!!e.referencedColumnName}),r=0===e.length&&t.isManyToOne,i=e.length>0&&!n;return r||i?t.inverseEntityMetadata.primaryColumns:e.map(function(e){var n=t.inverseEntityMetadata.ownColumns.find(function(t){return t.propertyName===e.referencedColumnName});if(!n)throw new Error("Referenced column "+e.referencedColumnName+" was not found in entity "+t.inverseEntityMetadata.name);return n})},e.prototype.collectColumns=function(e,t,r){var i=this;return r.map(function(r){var o=e.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)}),a=o?o.name:i.connection.namingStrategy.joinColumnName(t.propertyName,r.propertyName),s=t.entityMetadata.ownColumns.find(function(e){return e.databaseName===a});return s||(s=new n.ColumnMetadata({connection:i.connection,entityMetadata:t.entityMetadata,args:{target:"",mode:"virtual",propertyName:t.propertyName,options:{name:a,type:r.type,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(s)),s.referencedColumn=r,s.type=r.type,s.relationMetadata=t,s.build(i.connection.namingStrategy),s})},e}(),e("RelationJoinColumnBuilder",i)}}}),System.register("typeorm/metadata-builder/EntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/IndexMetadata","typeorm/metadata/RelationMetadata","typeorm/metadata/EmbeddedMetadata","typeorm/metadata/RelationIdMetadata","typeorm/metadata/RelationCountMetadata","typeorm/metadata-builder/MetadataUtils","typeorm/metadata-builder/JunctionEntityMetadataBuilder","typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder","typeorm/metadata-builder/RelationJoinColumnBuilder","typeorm/metadata/EntityListenerMetadata","typeorm/metadata/ForeignKeyMetadata","typeorm/lazy-loading/LazyRelationsWrapper"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,p,m,f,y,h;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){p=e},function(e){m=e},function(e){f=e},function(e){y=e}],execute:function(){h=function(){function e(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new l.JunctionEntityMetadataBuilder(e),this.closureJunctionEntityMetadataBuilder=new d.ClosureJunctionEntityMetadataBuilder(e),this.relationJoinColumnBuilder=new p.RelationJoinColumnBuilder(e)}return e.prototype.build=function(e){var t=this,n=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter(function(e){return"regular"===e.type||"closure"===e.type||"class-table-child"===e.type||"single-table-child"===e.type}).map(function(e){return t.createEntityMetadata(e)});return n.forEach(function(e){return t.computeEntityMetadata(e)}),n.forEach(function(e){return t.computeInverseProperties(e,n)}),n.filter(function(e){return"single-table-child"!==e.tableType}).forEach(function(e){e.relations.filter(function(e){return e.isOneToOne||e.isManyToOne}).forEach(function(n){var r=t.metadataArgsStorage.filterJoinColumns(n.target,n.propertyName),i=t.relationJoinColumnBuilder.build(r,n);i&&(n.registerForeignKeys(i),e.foreignKeys.push(i))}),e.relations.filter(function(e){return e.isManyToMany}).forEach(function(e){var r=t.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(r){var i=t.junctionEntityMetadataBuilder.build(e,r);e.registerForeignKeys.apply(e,i.foreignKeys),e.registerJunctionEntityMetadata(i),t.computeEntityMetadata(i),t.computeInverseProperties(i,n),n.push(i)}}),e.relationsWithJoinColumns=e.relations.filter(function(e){return e.isWithJoinColumn}),e.hasNonNullableRelations=e.relationsWithJoinColumns.some(function(e){return!e.isNullable||e.isPrimary})}),n.filter(function(e){return e.isClosure}).forEach(function(e){var r=t.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=r,t.computeEntityMetadata(r),t.computeInverseProperties(r,n),n.push(r)}),n.filter(function(e){return"single-table-child"===e.tableType||"class-table-child"===e.tableType}).forEach(function(e){var t=e.target instanceof Function?c.MetadataUtils.getInheritanceTree(e.target):[e.target],r=n.find(function(e){return t.find(function(t){return t===e.target})&&("single-table"===e.inheritanceType||"class-table"===e.inheritanceType)});r&&(e.parentEntityMetadata=r,"single-table"===r.inheritanceType&&(e.tableName=r.tableName))}),n.forEach(function(e){e.childEntityMetadatas=n.filter(function(t){return e.target instanceof Function&&t.target instanceof Function&&c.MetadataUtils.isInherited(t.target,e.target)})}),n.filter(function(e){return"single-table"===e.inheritanceType&&e.discriminatorColumn}).forEach(function(e){return t.createKeysForTableInheritance(e)}),n.forEach(function(e){e.indices.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.filter(function(e){return!!e.parentEntityMetadata&&"class-table-child"===e.tableType}).forEach(function(e){var n=e.parentEntityMetadata.primaryColumns,i=n.map(function(n){var i=t.connection.namingStrategy.classTableInheritanceParentColumnName(e.parentEntityMetadata.tableName,n.propertyPath),o=new r.ColumnMetadata({connection:t.connection,entityMetadata:e,referencedColumn:n,args:{target:e.target,propertyName:i,mode:"parentId",options:{name:i,type:n.type,unique:!0,nullable:!1,primary:!0}}});return e.registerColumn(o),o.build(t.connection.namingStrategy),o});e.foreignKeys=[new f.ForeignKeyMetadata({entityMetadata:e,referencedEntityMetadata:e.parentEntityMetadata,namingStrategy:t.connection.namingStrategy,columns:i,referencedColumns:n,onDelete:"CASCADE"})]}),n.filter(function(e){return e.target instanceof Function}).forEach(function(e){e.relations.filter(function(e){return e.isLazy}).forEach(function(n){new y.LazyRelationsWrapper(t.connection).wrap(e.target.prototype,n)})}),n},e.prototype.createEntityMetadata=function(e){var t,a=this,l=e.target instanceof Function?c.MetadataUtils.getInheritanceTree(e.target):[e.target];"single-table-child"===e.type?(t=this.metadataArgsStorage.filterSingleTableChildren(e.target).map(function(e){return e.target}).filter(function(e){return e instanceof Function}),l.push.apply(l,t)):"class-table-child"===e.type&&l.forEach(function(e){!!a.metadataArgsStorage.inheritances.find(function(t){return t.target===e})&&l.splice(l.indexOf(e),1)});var d=new n.EntityMetadata({connection:this.connection,args:e}),p=this.metadataArgsStorage.findInheritanceType(e.target);d.inheritanceType=p?p.type:void 0;var f=this.metadataArgsStorage.findDiscriminatorValue(e.target);return d.discriminatorValue=f?f.value:e.target.name,d.embeddeds=this.createEmbeddedsRecursively(d,this.metadataArgsStorage.filterEmbeddeds(l)),d.ownColumns=this.metadataArgsStorage.filterColumns(l).map(function(e){var n=new r.ColumnMetadata({connection:a.connection,entityMetadata:d,args:e});return t&&-1!==t.indexOf(e.target)&&(n.isNullable=!0),n}),d.ownRelations=this.metadataArgsStorage.filterRelations(l).map(function(e){return new o.RelationMetadata({entityMetadata:d,args:e})}),d.relationIds=this.metadataArgsStorage.filterRelationIds(l).map(function(e){return new s.RelationIdMetadata({entityMetadata:d,args:e})}),d.relationCounts=this.metadataArgsStorage.filterRelationCounts(l).map(function(e){return new u.RelationCountMetadata({entityMetadata:d,args:e})}),d.indices=this.metadataArgsStorage.filterIndices(l).map(function(e){return new i.IndexMetadata({entityMetadata:d,args:e})}),d.listeners=this.metadataArgsStorage.filterListeners(l).map(function(e){return new m.EntityListenerMetadata(e)}),d},e.prototype.createEmbeddedsRecursively=function(e,t){var n=this;return t.map(function(t){var i=new a.EmbeddedMetadata({entityMetadata:e,args:t});return i.columns=n.metadataArgsStorage.filterColumns(i.type).map(function(t){return new r.ColumnMetadata({connection:n.connection,entityMetadata:e,embeddedMetadata:i,args:t})}),i.relations=n.metadataArgsStorage.filterRelations(i.type).map(function(t){return new o.RelationMetadata({entityMetadata:e,embeddedMetadata:i,args:t})}),i.embeddeds=n.createEmbeddedsRecursively(e,n.metadataArgsStorage.filterEmbeddeds(i.type)),i.embeddeds.forEach(function(e){return e.parentEmbeddedMetadata=i}),i})},e.prototype.computeEntityMetadata=function(e){var t=this;e.embeddeds.forEach(function(e){return e.build(t.connection.namingStrategy)}),e.embeddeds.forEach(function(e){e.columnsFromTree.forEach(function(e){return e.build(t.connection.namingStrategy)}),e.relationsFromTree.forEach(function(e){return e.build()})}),e.ownColumns.forEach(function(e){return e.build(t.connection.namingStrategy)}),e.ownRelations.forEach(function(e){return e.build()}),e.relations=e.embeddeds.reduce(function(e,t){return e.concat(t.relationsFromTree)},e.ownRelations),e.oneToOneRelations=e.relations.filter(function(e){return e.isOneToOne}),e.oneToManyRelations=e.relations.filter(function(e){return e.isOneToMany}),e.manyToOneRelations=e.relations.filter(function(e){return e.isManyToOne}),e.manyToManyRelations=e.relations.filter(function(e){return e.isManyToMany}),e.ownerOneToOneRelations=e.relations.filter(function(e){return e.isOneToOneOwner}),e.ownerManyToManyRelations=e.relations.filter(function(e){return e.isManyToManyOwner}),e.treeParentRelation=e.relations.find(function(e){return e.isTreeParent}),e.treeChildrenRelation=e.relations.find(function(e){return e.isTreeChildren}),e.columns=e.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},e.ownColumns),e.primaryColumns=e.columns.filter(function(e){return e.isPrimary}),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumn=e.columns.find(function(e){return e.isGenerated}),e.createDateColumn=e.columns.find(function(e){return e.isCreateDate}),e.updateDateColumn=e.columns.find(function(e){return e.isUpdateDate}),e.versionColumn=e.columns.find(function(e){return e.isVersion}),e.discriminatorColumn=e.columns.find(function(e){return e.isDiscriminator}),e.treeLevelColumn=e.columns.find(function(e){return e.isTreeLevel}),e.parentIdColumns=e.columns.filter(function(e){return e.isParentId}),e.objectIdColumn=e.columns.find(function(e){return e.isObjectId}),e.foreignKeys.forEach(function(e){return e.build(t.connection.namingStrategy)}),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach(function(e){return e.build()}),e.relationCounts.forEach(function(e){return e.build()}),e.embeddeds.forEach(function(e){e.relationIdsFromTree.forEach(function(e){return e.build()}),e.relationCountsFromTree.forEach(function(e){return e.build()})})},e.prototype.computeInverseProperties=function(e,t){e.relations.forEach(function(n){var r=t.find(function(e){return e.target===n.type||"string"==typeof n.type&&e.targetName===n.type});if(!r)throw new Error("Entity metadata for "+e.name+"#"+n.propertyPath+" was not found. Check if you specified a correct entity object, check its really entity and its connected in the connection options.");n.inverseEntityMetadata=r,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=r.relations.find(function(e){return e.propertyPath===n.inverseSidePropertyPath})})},e.prototype.createKeysForTableInheritance=function(e){e.indices.push(new i.IndexMetadata({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}),new i.IndexMetadata({entityMetadata:e,columns:e.primaryColumns.concat([e.discriminatorColumn]),args:{target:e.target,unique:!1}}))},e}(),e("EntityMetadataBuilder",h)}}}),System.register("typeorm/decorator/options/JoinTableOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaTransformer",["typeorm/metadata-args/MetadataArgsStorage"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){}return e.prototype.transform=function(e){var t=new n.MetadataArgsStorage;return e.forEach(function(e){var n=e.table||{},r={target:e.target||e.name,name:n.name,type:n.type||"regular",orderBy:n.orderBy};t.tables.push(r),Object.keys(e.columns).forEach(function(n){var r=e.columns[n],i="regular";r.createDate&&(i="createDate"),r.updateDate&&(i="updateDate"),r.version&&(i="version"),r.treeChildrenCount&&(i="treeChildrenCount"),r.treeLevel&&(i="treeLevel");var o={target:e.target||e.name,mode:i,propertyName:n,options:{type:r.type,name:r.name,length:r.length,primary:r.primary,generated:r.generated,unique:r.unique,nullable:r.nullable,comment:r.comment,default:r.default,precision:r.precision,scale:r.scale}};t.columns.push(o)}),e.relations&&Object.keys(e.relations).forEach(function(n){var r=e.relations[n],i={target:e.target||e.name,propertyName:n,relationType:r.type,isLazy:r.isLazy||!1,type:r.target,inverseSideProperty:r.inverseSide,isTreeParent:r.isTreeParent,isTreeChildren:r.isTreeChildren,options:{cascadeAll:r.cascadeAll,cascadeInsert:r.cascadeInsert,cascadeUpdate:r.cascadeUpdate,cascadeRemove:r.cascadeRemove,nullable:r.nullable,onDelete:r.onDelete}};if(t.relations.push(i),r.joinColumn)if("boolean"==typeof r.joinColumn){o={target:e.target||e.name,propertyName:n};t.joinColumns.push(o)}else{var o={target:e.target||e.name,propertyName:n,name:r.joinColumn.name,referencedColumnName:r.joinColumn.referencedColumnName};t.joinColumns.push(o)}if(r.joinTable)if("boolean"==typeof r.joinTable){a={target:e.target||e.name,propertyName:n};t.joinTables.push(a)}else{var a={target:e.target||e.name,propertyName:n,name:r.joinTable.name,joinColumns:r.joinTable.joinColumn?[r.joinTable.joinColumn]:r.joinTable.joinColumns,inverseJoinColumns:r.joinTable.inverseJoinColumn?[r.joinTable.inverseJoinColumn]:r.joinTable.inverseJoinColumns};t.joinTables.push(a)}})}),t},e}(),e("EntitySchemaTransformer",r)}}}),System.register("typeorm/connection/ConnectionMetadataBuilder",["typeorm/util/DirectoryExportedClassesLoader","typeorm/util/OrmUtils","typeorm/container","typeorm/index","typeorm/metadata-builder/EntityMetadataBuilder","typeorm/entity-schema/EntitySchemaTransformer"],function(e,t){"use strict";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e){this.connection=e}return e.prototype.buildMigrations=function(e){var t=r.OrmUtils.splitClassesAndStrings(e),o=t[0],a=t[1];return o.concat(n.importClassesFromDirectories(a)).map(function(e){return i.getFromContainer(e)})},e.prototype.buildSubscribers=function(e){var t=r.OrmUtils.splitClassesAndStrings(e||[]),a=t[0],s=t[1],u=a.concat(n.importClassesFromDirectories(s));return o.getMetadataArgsStorage().filterSubscribers(u).map(function(e){return i.getFromContainer(e.target)})},e.prototype.buildEntityMetadatas=function(e,t){var i=r.OrmUtils.splitClassesAndStrings(e||[]),u=i[0],c=i[1],l=u.concat(n.importClassesFromDirectories(c)),d=new a.EntityMetadataBuilder(this.connection,o.getMetadataArgsStorage()).build(l),p=r.OrmUtils.splitClassesAndStrings(t||[]),m=p[0],f=p[1],y=m.concat(n.importJsonsFromDirectories(f)),h=(new s.EntitySchemaTransformer).transform(y),g=new a.EntityMetadataBuilder(this.connection,h).build();return d.concat(g)},e}(),e("ConnectionMetadataBuilder",u)}}}),System.register("typeorm/connection/Connection",["typeorm/connection/error/RepositoryNotFoundError","typeorm/naming-strategy/DefaultNamingStrategy","typeorm/connection/error/CannotExecuteNotConnectedError","typeorm/connection/error/CannotConnectAlreadyConnectedError","typeorm/repository/TreeRepository","typeorm/connection/error/RepositoryNotTreeError","typeorm/metadata-args/error/EntityMetadataNotFound","typeorm/migration/MigrationExecutor","typeorm/platform/PlatformTools","typeorm/driver/mongodb/MongoDriver","typeorm/entity-manager/MongoEntityManager","typeorm/metadata-builder/EntityMetadataValidator","typeorm/query-runner/error/QueryRunnerProviderAlreadyReleasedError","typeorm/entity-manager/EntityManagerFactory","typeorm/logger/LoggerFactory","typeorm/repository/RepositoryFactory","typeorm/driver/DriverFactory","typeorm/connection/ConnectionMetadataBuilder","typeorm/query-builder/SelectQueryBuilder"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,d,p,m,f,y,h,g,v,b,E,_;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){p=e},function(e){m=e},function(e){f=e},function(e){y=e},function(e){h=e},function(e){g=e},function(e){v=e},function(e){b=e},function(e){E=e}],execute:function(){_=function(){function e(e){this.isConnected=!1,this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||"default",this.options=e,this.logger=(new h.LoggerFactory).create(this.options.logging||{}),this.driver=(new v.DriverFactory).create(this),this.manager=(new y.EntityManagerFactory).create(this),this.namingStrategy=e.namingStrategy||new r.DefaultNamingStrategy}return Object.defineProperty(e.prototype,"mongoManager",{get:function(){if(!(this.manager instanceof p.MongoEntityManager))throw new Error("MongoEntityManager is only available for MongoDB databases.");return this.manager},enumerable:!0,configurable:!0}),e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(this.isConnected)throw new o.CannotConnectAlreadyConnectedError(this.name);return[4,this.driver.connect()];case 1:t.sent(),Object.assign(this,{isConnected:!0}),t.label=2;case 2:return t.trys.push([2,9,,11]),this.buildMetadatas(),!this.options.dropSchemaOnConnection||l.PlatformTools.getEnvVariable("SKIP_SCHEMA_CREATION")?[3,4]:[4,this.dropDatabase()];case 3:t.sent(),t.label=4;case 4:return!this.options.autoSchemaSync||l.PlatformTools.getEnvVariable("SKIP_SCHEMA_CREATION")?[3,6]:[4,this.syncSchema()];case 5:t.sent(),t.label=6;case 6:return!this.options.autoMigrationsRun||l.PlatformTools.getEnvVariable("SKIP_MIGRATIONS_RUN")?[3,8]:[4,this.runMigrations()];case 7:t.sent(),t.label=8;case 8:return[3,11];case 9:return e=t.sent(),[4,this.close()];case 10:throw t.sent(),e;case 11:return[2,this]}})})},e.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new i.CannotExecuteNotConnectedError(this.name);return[4,this.driver.disconnect()];case 1:return e.sent(),Object.assign(this,{isConnected:!1}),[2]}})})},e.prototype.syncSchema=function(e){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:if(!this.isConnected)throw new i.CannotExecuteNotConnectedError(this.name);return e?[4,this.dropDatabase()]:[3,2];case 1:n.sent(),n.label=2;case 2:return t=this.driver.createSchemaBuilder(),[4,t.build()];case 3:return n.sent(),[2]}})})},e.prototype.logSyncSchema=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){if(!this.isConnected)throw new i.CannotExecuteNotConnectedError(this.name);return e=this.driver.createSchemaBuilder(),[2,e.log()]})})},e.prototype.dropDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.createQueryRunner()];case 1:return e=t.sent(),[4,e.clearDatabase()];case 2:return t.sent(),[4,e.release()];case 3:return t.sent(),[2]}})})},e.prototype.runMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(!this.isConnected)throw new i.CannotExecuteNotConnectedError(this.name);return e=new c.MigrationExecutor(this),[4,e.executePendingMigrations()];case 1:return t.sent(),[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(!this.isConnected)throw new i.CannotExecuteNotConnectedError(this.name);return e=new c.MigrationExecutor(this),[4,e.undoLastMigration()];case 1:return t.sent(),[2]}})})},e.prototype.hasMetadata=function(e){return!!this.findMetadata(e)},e.prototype.getMetadata=function(e){var t=this.findMetadata(e);if(!t)throw new u.EntityMetadataNotFound(e);return t},e.prototype.getRepository=function(e){return this.getMetadata(e).repository},e.prototype.getTreeRepository=function(e){if(this.driver instanceof d.MongoDriver)throw new Error("You cannot use getTreeRepository for MongoDB connections.");if(!this.hasMetadata(e))throw new n.RepositoryNotFoundError(this.name,e);var t=this.getMetadata(e).repository;if(!(t instanceof a.TreeRepository))throw new s.RepositoryNotTreeError(e);return t},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof d.MongoDriver))throw new Error("You can use getMongoRepository only for MongoDB connections.");if(!this.hasMetadata(e))throw new n.RepositoryNotFoundError(this.name,e);return this.getMetadata(e).repository},e.prototype.getCustomRepository=function(e){return this.manager.getCustomRepository(e)},e.prototype.transaction=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a;return __generator(this,function(s){switch(s.label){case 0:if(this instanceof p.MongoEntityManager)throw new Error("Transactions aren't supported by MongoDB.");if(t&&t.isReleased)throw new f.QueryRunnerProviderAlreadyReleasedError;n=t||this.createQueryRunner(),r=(new y.EntityManagerFactory).create(this,n),s.label=1;case 1:return s.trys.push([1,5,10,13]),[4,n.startTransaction()];case 2:return s.sent(),[4,e(r)];case 3:return i=s.sent(),[4,n.commitTransaction()];case 4:return s.sent(),[2,i];case 5:o=s.sent(),s.label=6;case 6:return s.trys.push([6,8,,9]),[4,n.rollbackTransaction()];case 7:return s.sent(),[3,9];case 8:return a=s.sent(),[3,9];case 9:throw o;case 10:return t?[3,12]:[4,n.release()];case 11:s.sent(),s.label=12;case 12:return[7];case 13:return[2]}})})},e.prototype.query=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:if(this instanceof p.MongoEntityManager)throw new Error("Queries aren't supported by MongoDB.");if(n&&n.isReleased)throw new f.QueryRunnerProviderAlreadyReleasedError;r=n||this.createQueryRunner(),i.label=1;case 1:return i.trys.push([1,,3,6]),[4,r.query(e,t)];case 2:return[2,i.sent()];case 3:return n?[3,5]:[4,r.release()];case 4:i.sent(),i.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.createQueryBuilder=function(e,t,n){if(this instanceof p.MongoEntityManager)throw new Error("Query Builder is not supported by MongoDB.");if(t){var r=this.getMetadata(e);return new E.SelectQueryBuilder(this,n).select(t).from(r.target,t)}return new E.SelectQueryBuilder(this,e)},e.prototype.createQueryRunner=function(){return this.driver.createQueryRunner()},e.prototype.createIsolatedManager=function(e){return e&&e.manager&&e.manager!==this.manager?e.manager:(e||(e=this.createQueryRunner()),Object.assign(e,{manager:(new y.EntityManagerFactory).create(this,e)}),e.manager)},e.prototype.createIsolatedRepository=function(e,t){return t||(t=this.createQueryRunner()),(new g.RepositoryFactory).create(this,this.getMetadata(e),t)},Object.defineProperty(e.prototype,"entityManager",{get:function(){return this.manager},enumerable:!0,configurable:!0}),e.prototype.findMetadata=function(e){return this.entityMetadatas.find(function(t){return t.target===e||"string"==typeof e&&(t.name===e||t.tableName===e)})},e.prototype.buildMetadatas=function(){var e=this,t=new b.ConnectionMetadataBuilder(this),n=new g.RepositoryFactory,r=new m.EntityMetadataValidator;if(!l.PlatformTools.getEnvVariable("SKIP_SUBSCRIBERS_LOADING")){var i=t.buildSubscribers(this.options.subscribers||[]);Object.assign(this,{subscribers:i})}var o=t.buildEntityMetadatas(this.options.entities||[],this.options.entitySchemas||[]);Object.assign(this,{entityMetadatas:o});var a=t.buildMigrations(this.options.migrations||[]);Object.assign(this,{migrations:a}),this.entityMetadatas.forEach(function(t){t.repository=n.create(e,t)}),r.validateMany(this.entityMetadatas)},e}(),e("Connection",_)}}}),System.register("typeorm/connection/error/ConnectionNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="ConnectionNotFoundError",n.message='Connection "'+t+'" was not found.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("ConnectionNotFoundError",n)}}}),System.register("typeorm/connection/error/AlreadyHasActiveConnectionError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="AlreadyHasActiveConnectionError",n.message='Cannot create a new connection named "'+t+'", because connection with such name already exist and it now has an active connection session.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("AlreadyHasActiveConnectionError",n)}}}),System.register("typeorm/connection/ConnectionManager",["typeorm/connection/Connection","typeorm/connection/error/ConnectionNotFoundError","typeorm/connection/error/AlreadyHasActiveConnectionError"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(){this.connections=[]}return e.prototype.has=function(e){return!!this.connections.find(function(t){return t.name===e})},e.prototype.get=function(e){void 0===e&&(e="default");var t=this.connections.find(function(t){return t.name===e});if(!t)throw new r.ConnectionNotFoundError(e);return t},e.prototype.create=function(e){e.driver&&Object.assign(e,e.driver);var t=this.connections.find(function(t){return t.name===(e.name||"default")});if(t){if(t.isConnected)throw new i.AlreadyHasActiveConnectionError(e.name||"default");this.connections.splice(this.connections.indexOf(t),1)}var r=new n.Connection(e);return this.connections.push(r),r},e}(),e("ConnectionManager",o)}}}),System.register("typeorm/connection/options-reader/ConnectionOptionsEnvReader",["typeorm/platform/PlatformTools","typeorm/util/OrmUtils"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(){}return e.prototype.read=function(){return{type:n.PlatformTools.getEnvVariable("TYPEORM_CONNECTION"),url:n.PlatformTools.getEnvVariable("TYPEORM_URL"),host:n.PlatformTools.getEnvVariable("TYPEORM_HOST"),port:n.PlatformTools.getEnvVariable("TYPEORM_PORT"),username:n.PlatformTools.getEnvVariable("TYPEORM_USERNAME"),password:n.PlatformTools.getEnvVariable("TYPEORM_PASSWORD"),database:n.PlatformTools.getEnvVariable("TYPEORM_DATABASE"),sid:n.PlatformTools.getEnvVariable("TYPEORM_SID"),extra:n.PlatformTools.getEnvVariable("TYPEORM_DRIVER_EXTRA")?JSON.parse(n.PlatformTools.getEnvVariable("TYPEORM_DRIVER_EXTRA")):void 0,autoSchemaSync:r.OrmUtils.toBoolean(n.PlatformTools.getEnvVariable("TYPEORM_AUTO_SCHEMA_SYNC")),entities:n.PlatformTools.getEnvVariable("TYPEORM_ENTITIES")?n.PlatformTools.getEnvVariable("TYPEORM_ENTITIES").split(","):[],migrations:n.PlatformTools.getEnvVariable("TYPEORM_MIGRATIONS")?n.PlatformTools.getEnvVariable("TYPEORM_MIGRATIONS").split(","):[],subscribers:n.PlatformTools.getEnvVariable("TYPEORM_SUBSCRIBERS")?n.PlatformTools.getEnvVariable("TYPEORM_SUBSCRIBERS").split(","):[],entitySchemas:n.PlatformTools.getEnvVariable("TYPEORM_ENTITY_SCHEMAS")?n.PlatformTools.getEnvVariable("TYPEORM_ENTITY_SCHEMAS").split(","):[],logging:{logQueries:r.OrmUtils.toBoolean(n.PlatformTools.getEnvVariable("TYPEORM_LOGGING_QUERIES")),logFailedQueryError:r.OrmUtils.toBoolean(n.PlatformTools.getEnvVariable("TYPEORM_LOGGING_FAILED_QUERIES")),logOnlyFailedQueries:r.OrmUtils.toBoolean(n.PlatformTools.getEnvVariable("TYPEORM_LOGGING_ONLY_FAILED_QUERIES"))},cli:{entitiesDir:n.PlatformTools.getEnvVariable("TYPEORM_ENTITIES_DIR"),migrationsDir:n.PlatformTools.getEnvVariable("TYPEORM_MIGRATIONS_DIR"),subscribersDir:n.PlatformTools.getEnvVariable("TYPEORM_SUBSCRIBERS_DIR")}}},e}(),e("ConnectionOptionsEnvReader",i)}}}),System.register("typeorm/connection/options-reader/ConnectionOptionsYmlReader",["fs","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(){}return e.prototype.read=function(e){var t=r.PlatformTools.load("js-yaml").safeLoad(n.readFileSync(e));return Object.keys(t).map(function(e){return Object.assign({name:e},t[e])})},e}(),e("ConnectionOptionsYmlReader",i)}}}),System.register("typeorm/connection/options-reader/ConnectionOptionsXmlReader",["fs","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(){}return e.prototype.read=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.readXml(e)];case 1:return t=n.sent(),[2,t.connection.map(function(e){return{name:e.$.name,type:e.$.type,url:e.url?e.url[0]:void 0,host:e.host?e.host[0]:void 0,port:e.port&&e.port[0]?parseInt(e.port[0]):void 0,username:e.username?e.username[0]:void 0,password:e.password?e.password[0]:void 0,database:e.database?e.database[0]:void 0,sid:e.sid?e.sid[0]:void 0,extra:e.extra?e.extra[0]:void 0,autoSchemaSync:e.autoSchemaSync?e.autoSchemaSync[0]:void 0,entities:e.entities?e.entities[0].entity:[],subscribers:e.subscribers?e.subscribers[0].entity:[],entitySchemas:e.entitySchemas?e.entitySchemas[0].entity:[],logging:{logQueries:e.logging&&e.logging[0].logQueries?e.logging[0].logQueries[0]:void 0,logFailedQueryError:e.logging&&e.logging[0].logFailedQueryError?e.logging[0].logFailedQueryError[0]:void 0,logOnlyFailedQueries:e.logging&&e.logging[0].logOnlyFailedQueries?e.logging[0].logOnlyFailedQueries[0]:void 0}}})]}})})},e.prototype.readXml=function(e){var t=r.PlatformTools.load("xml2js").parseString,i={trim:!0,explicitRoot:!1};return new Promise(function(r,o){t(n.readFileSync(e),i,function(e,t){return e?o(e):r(t)})})},e}(),e("ConnectionOptionsXmlReader",i)}}}),System.register("typeorm/connection/ConnectionOptionsReader",["typeorm/platform/PlatformTools","typeorm/connection/options-reader/ConnectionOptionsEnvReader","typeorm/connection/options-reader/ConnectionOptionsYmlReader","typeorm/connection/options-reader/ConnectionOptionsXmlReader"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.options=e}return e.prototype.all=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.load()]})})},e.prototype.get=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.all()];case 1:if(t=r.sent(),!(n=t.find(function(t){return t.name===e||"default"===e&&!t.name})))throw new Error("Cannot find connection "+e+" because its not defined in any orm configuration files.");return[2,n]}})})},e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e,t,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return"env"===(e=["env","js","json","yml","yaml","xml"].find(function(e){return n.PlatformTools.fileExist(s.baseFilePath+"."+e)}))&&(t=n.PlatformTools.load("dotenv")).config({path:this.baseFilePath+".env"}),n.PlatformTools.getEnvVariable("TYPEORM_CONNECTION")?(a=(new r.ConnectionOptionsEnvReader).read(),[3,8]):[3,1];case 1:return"js"!==e?[3,2]:(a=n.PlatformTools.load(this.baseFilePath+".js"),[3,8]);case 2:return"json"!==e?[3,3]:(a=n.PlatformTools.load(this.baseFilePath+".json"),[3,8]);case 3:return"yml"!==e?[3,4]:(a=(new i.ConnectionOptionsYmlReader).read(this.baseFilePath+".yml"),[3,8]);case 4:return"yaml"!==e?[3,5]:(a=(new i.ConnectionOptionsYmlReader).read(this.baseFilePath+".yaml"),[3,8]);case 5:return"xml"!==e?[3,7]:[4,(new o.ConnectionOptionsXmlReader).read(this.baseFilePath+".xml")];case 6:return a=u.sent(),[3,8];case 7:throw new Error("No connection options were found in any of configurations file.");case 8:return[2,this.normalizeConnectionOptions(a)]}})})},e.prototype.normalizeConnectionOptions=function(e){var t=this;return e instanceof Array||(e=[e]),e.forEach(function(n){if(n.entities){var r=n.entities.map(function(e){return"string"==typeof e||"/"!==e.substr(0,1)?t.baseFilePath+"/"+e:e});Object.assign(e,{entities:r})}if(n.subscribers){var i=n.subscribers.map(function(e){return"string"==typeof e||"/"!==e.substr(0,1)?t.baseFilePath+"/"+e:e});Object.assign(e,{subscribers:i})}if(n.migrations){var o=n.migrations.map(function(e){return"string"==typeof e||"/"!==e.substr(0,1)?t.baseFilePath+"/"+e:e});Object.assign(e,{migrations:o})}}),e},Object.defineProperty(e.prototype,"baseFilePath",{get:function(){return this.baseDirectory+"/"+this.baseConfigName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseDirectory",{get:function(){return this.options&&this.options.root?this.options.root:n.PlatformTools.load("app-root-path").path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseConfigName",{get:function(){return this.options&&this.options.configName?this.options.configName:"ormconfig"},enumerable:!0,configurable:!0}),e}(),e("ConnectionOptionsReader",a)}}}),System.register("typeorm/decorator/error/GeneratedOnlyForPrimaryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="GeneratedOnlyForPrimaryError",r.message="Column for property "+t.constructor.name+"#"+n+" cannot have a generated value because its not a primary column. Try to use @PrimaryColumn decorator.",r}return __extends(t,e),t}(Error),e("GeneratedOnlyForPrimaryError",n)}}}),System.register("typeorm/decorator/options/ColumnCommonOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnWithLengthOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnNumericOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnEnumOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnEmbeddedOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/columns/Column",["typeorm/decorator/error/GeneratedOnlyForPrimaryError","typeorm/index"],function(e,t){"use strict";t&&t.id;e("Column",function(e,t){var i;return"string"==typeof e||e instanceof Function?i=e:e&&(t=e,i=e.type),function(o,a){if(e instanceof Function){var s=!!((c=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",o,a):void 0)===Array||t&&!0===t.array),u={target:o.constructor,propertyName:a,isArray:s,prefix:t&&void 0!==t.prefix?t.prefix:void 0,type:e};r.getMetadataArgsStorage().embeddeds.push(u)}else{if(!i){var c=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",o,a):void 0;c&&(i=c)}if(t||(t={}),!t.type&&i&&(t=Object.assign({type:i},t)),t.generated)throw new n.GeneratedOnlyForPrimaryError(o,a);u={target:o.constructor,propertyName:a,mode:"regular",options:t},r.getMetadataArgsStorage().columns.push(u)}}});var n,r;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/CreateDateColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("CreateDateColumn",function(e){return function(t,r){e||(e={});var i={target:t.constructor,propertyName:r,mode:"createDate",options:e};n.getMetadataArgsStorage().columns.push(i)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/DiscriminatorColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("DiscriminatorColumn",function(e){return function(t){var r={name:e.name,type:e.type},i={target:t,mode:"discriminator",propertyName:e.name,options:r};n.getMetadataArgsStorage().columns.push(i)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/error/PrimaryColumnCannotBeNullableError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="PrimaryColumnCannotBeNullableError",r.message="Primary column "+t.constructor.name+"#"+n+" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.",r}return __extends(t,e),t}(Error),e("PrimaryColumnCannotBeNullableError",n)}}}),System.register("typeorm/decorator/columns/PrimaryGeneratedColumn",["typeorm/index","typeorm/decorator/error/PrimaryColumnCannotBeNullableError"],function(e,t){"use strict";t&&t.id;e("PrimaryGeneratedColumn",function(e){return function(t,i){if(e||(e={}),(e=Object.assign({type:"int"},e)).nullable)throw new r.PrimaryColumnCannotBeNullableError(t,i);e=Object.assign({primary:!0,generated:!0},e);var o={target:t.constructor,propertyName:i,mode:"regular",options:e};n.getMetadataArgsStorage().columns.push(o)}});var n,r;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/error/ColumnTypeUndefinedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="ColumnTypeUndefinedError",r.message="Column type for "+t.constructor.name+"#"+n+" is not defined or cannot be guessed. Try to implicitly provide a column type to @Column decorator.",r}return __extends(t,e),t}(Error),e("ColumnTypeUndefinedError",n)}}}),System.register("typeorm/decorator/columns/PrimaryColumn",["typeorm/decorator/error/ColumnTypeUndefinedError","typeorm/index","typeorm/decorator/error/PrimaryColumnCannotBeNullableError"],function(e,t){"use strict";t&&t.id;e("PrimaryColumn",function(e,t){var o;return"string"==typeof e?o=e:t=e,function(e,a){if(!o){var s=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,a):void 0;s&&(o=s)}if(t||(t={}),!t.type&&o&&(t=Object.assign({type:o},t)),!t.type)throw new n.ColumnTypeUndefinedError(e,a);if(t.nullable)throw new i.PrimaryColumnCannotBeNullableError(e,a);t=Object.assign({primary:!0},t);var u={target:e.constructor,propertyName:a,mode:"regular",options:t};r.getMetadataArgsStorage().columns.push(u)}});var n,r,i;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/UpdateDateColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("UpdateDateColumn",function(e){return function(t,r){var i={target:t.constructor,propertyName:r,mode:"updateDate",options:e||{}};n.getMetadataArgsStorage().columns.push(i)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/VersionColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("VersionColumn",function(e){return function(t,r){e||(e={});var i={target:t.constructor,propertyName:r,mode:"version",options:e};n.getMetadataArgsStorage().columns.push(i)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/ObjectIdColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("ObjectIdColumn",function(e){return function(t,r){e||(e={}),e=Object.assign(e,{primary:!0,name:e.name?e.name:"_id"});var i={target:t.constructor,propertyName:r,mode:"objectId",options:e};n.getMetadataArgsStorage().columns.push(i)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterInsert",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("AfterInsert",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:r.EventListenerTypes.AFTER_INSERT};n.getMetadataArgsStorage().entityListeners.push(i)}});var n,r;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterLoad",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("AfterLoad",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:r.EventListenerTypes.AFTER_LOAD};n.getMetadataArgsStorage().entityListeners.push(i)}});var n,r;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterRemove",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("AfterRemove",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:r.EventListenerTypes.AFTER_REMOVE};n.getMetadataArgsStorage().entityListeners.push(i)}});var n,r;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterUpdate",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("AfterUpdate",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:r.EventListenerTypes.AFTER_UPDATE};n.getMetadataArgsStorage().entityListeners.push(i)}});var n,r;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeInsert",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("BeforeInsert",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:r.EventListenerTypes.BEFORE_INSERT};n.getMetadataArgsStorage().entityListeners.push(i)}});var n,r;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeRemove",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("BeforeRemove",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:r.EventListenerTypes.BEFORE_REMOVE};n.getMetadataArgsStorage().entityListeners.push(i)}});var n,r;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeUpdate",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("BeforeUpdate",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:r.EventListenerTypes.BEFORE_UPDATE};n.getMetadataArgsStorage().entityListeners.push(i)}});var n,r;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/EventSubscriber",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("EventSubscriber",function(){return function(e){var t={target:e};n.getMetadataArgsStorage().entitySubscribers.push(t)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/options/IndexOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/EntityOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/relations/RelationCount",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("RelationCount",function(e,t,r){return function(i,o){var a={target:i.constructor,propertyName:o,relation:e,alias:t,queryBuilderFactory:r};n.getMetadataArgsStorage().relationCounts.push(a)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/JoinColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("JoinColumn",function(e){return function(t,r){(e instanceof Array?e:[e||{}]).forEach(function(e){var i={target:t.constructor,propertyName:r,name:e.name,referencedColumnName:e.referencedColumnName};n.getMetadataArgsStorage().joinColumns.push(i)})}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/JoinTable",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("JoinTable",function(e){return function(t,r){e=e||{};var i={target:t.constructor,propertyName:r,name:e.name,joinColumns:e&&e.joinColumn?[e.joinColumn]:e.joinColumns,inverseJoinColumns:e&&e.inverseJoinColumn?[e.inverseJoinColumn]:e.inverseJoinColumns};n.getMetadataArgsStorage().joinTables.push(i)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/ManyToMany",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("ManyToMany",function(e,t,r){var i;return"object"==typeof t?r=t:i=t,function(t,o){r||(r={});var a=!(!r||!0!==r.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",t,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:t.constructor,propertyName:o,relationType:"many-to-many",isLazy:a,type:e,inverseSideProperty:i,options:r};n.getMetadataArgsStorage().relations.push(u)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/ManyToOne",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("ManyToOne",function(e,t,r){var i;return"object"==typeof t?r=t:i=t,function(t,o){r||(r={});var a=!(!r||!0!==r.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",t,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:t.constructor,propertyName:o,relationType:"many-to-one",isLazy:a,type:e,inverseSideProperty:i,options:r};n.getMetadataArgsStorage().relations.push(u)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/OneToMany",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("OneToMany",function(e,t,r){return function(i,o){r||(r={});var a=!(!r||!0!==r.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",i,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:i.constructor,propertyName:o,isLazy:a,relationType:"one-to-many",type:e,inverseSideProperty:t,options:r};n.getMetadataArgsStorage().relations.push(u)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/OneToOne",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("OneToOne",function(e,t,r){var i;return"object"==typeof t?r=t:i=t,function(t,o){r||(r={});var a=!(!r||!0!==r.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",t,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:t.constructor,propertyName:o,isLazy:a,relationType:"one-to-one",type:e,inverseSideProperty:i,options:r};n.getMetadataArgsStorage().relations.push(u)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/RelationId",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("RelationId",function(e,t,r){return function(i,o){var a={target:i.constructor,propertyName:o,relation:e,alias:t,queryBuilderFactory:r};n.getMetadataArgsStorage().relationIds.push(a)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/Entity",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("Entity",function(e,t){return function(r){var i={target:r,name:e,type:"regular",orderBy:t&&t.orderBy?t.orderBy:void 0,engine:t&&t.engine?t.engine:void 0,skipSync:!(!t||!0!==t.skipSync)};n.getMetadataArgsStorage().tables.push(i)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/AbstractEntity",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("AbstractEntity",function(){return function(e){var t={target:e,name:void 0,type:"abstract"};n.getMetadataArgsStorage().tables.push(t)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/ClassEntityChild",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("ClassEntityChild",function(e,t){return function(r){var i={target:r,name:e,type:"class-table-child",orderBy:t&&t.orderBy?t.orderBy:void 0,skipSync:!(!t||!0!==t.skipSync)};n.getMetadataArgsStorage().tables.push(i)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/ClosureEntity",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("ClosureEntity",function(e,t){return function(r){var i={target:r,name:e,type:"closure",orderBy:t&&t.orderBy?t.orderBy:void 0,skipSync:!(!t||!0!==t.skipSync)};n.getMetadataArgsStorage().tables.push(i)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/EmbeddableEntity",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("EmbeddableEntity",function(){return function(e){var t={target:e,type:"embeddable",orderBy:void 0};n.getMetadataArgsStorage().tables.push(t)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/SingleEntityChild",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("SingleEntityChild",function(){return function(e){var t={target:e,name:void 0,type:"single-table-child",orderBy:void 0};n.getMetadataArgsStorage().tables.push(t)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/TableInheritance",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("TableInheritance",function(e){return function(t){var r={target:t,type:e};n.getMetadataArgsStorage().inheritances.push(r)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/Transaction",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("Transaction",function(e){return void 0===e&&(e="default"),function(t,r,i){var o=i.value;i.value=function(){for(var i=this,a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];return n.getConnection(e).manager.transaction(function(e){var s,u=n.getMetadataArgsStorage().filterTransactionEntityManagers(t.constructor).filter(function(e){return e.methodName===r}).map(function(e){return e.index});return u.length?(s=a.slice(),u.forEach(function(t){return s.splice(t,0,e)})):s=[e].concat(a),o.apply(i,s)})}}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/TransactionEntityManager",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("TransactionEntityManager",function(){return function(e,t,r){var i={target:e.constructor,methodName:t,index:r};n.getMetadataArgsStorage().transactionEntityManagers.push(i)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeLevelColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("TreeLevelColumn",function(){return function(e,t){var r={target:e.constructor,propertyName:t,mode:"treeLevel",options:{}};n.getMetadataArgsStorage().columns.push(r)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeParent",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("TreeParent",function(e){return function(t,r){e||(e={});var i=!(!e||!0!==e.lazy);if(!i&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,r);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(i=!0)}var a={isTreeParent:!0,target:t.constructor,propertyName:r,isLazy:i,relationType:"many-to-one",type:function(){return t.constructor},options:e};n.getMetadataArgsStorage().relations.push(a)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeChildren",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("TreeChildren",function(e){return function(t,r){e||(e={});var i=!(!e||!0!==e.lazy);if(!i&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,r);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(i=!0)}var a={isTreeChildren:!0,target:t.constructor,propertyName:r,isLazy:i,relationType:"one-to-many",type:function(){return t.constructor},options:e};n.getMetadataArgsStorage().relations.push(a)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/Index",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("Index",function(e,t,r){var i="string"==typeof e?e:void 0,o="string"==typeof e?t:e,a="object"!=typeof e||Array.isArray(e)?r:e;return a||(a="object"!=typeof t||Array.isArray(t)?r:t),function(e,t){var r={target:t?e.constructor:e,name:i,columns:t?[t]:o,unique:!(!a||!a.unique)};n.getMetadataArgsStorage().indices.push(r)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/Embedded",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("Embedded",function(e,t){return function(r,i){var o=!!((Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",r,i):void 0)===Array||t&&!0===t.array),a={target:r.constructor,propertyName:i,isArray:o,prefix:t&&void 0!==t.prefix?t.prefix:void 0,type:e};n.getMetadataArgsStorage().embeddeds.push(a)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/DiscriminatorValue",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("DiscriminatorValue",function(e){return function(t){var r={target:t,value:e};n.getMetadataArgsStorage().discriminatorValues.push(r)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/EntityRepository",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("EntityRepository",function(e){return function(t){var r={target:t,entity:e};n.getMetadataArgsStorage().entityRepositories.push(r)}});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/repository/BaseEntity",["typeorm/index"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){}return e.prototype.hasId=function(){return this.constructor.getRepository().hasId(this)},e.prototype.save=function(){return this.constructor.getRepository().save(this)},e.prototype.remove=function(){return this.constructor.getRepository().remove(this)},e.useConnection=function(e){this.usedConnection=e},e.getRepository=function(){return(this.usedConnection||n.getConnection()).getRepository(this)},Object.defineProperty(e,"target",{get:function(){return this.getRepository().target},enumerable:!0,configurable:!0}),e.hasId=function(e){return this.getRepository().hasId(e)},e.getId=function(e){return this.getRepository().getId(e)},e.createQueryBuilder=function(e){return this.getRepository().createQueryBuilder(e)},e.create=function(){return this.getRepository().create()},e.merge=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return(r=this.getRepository()).merge.apply(r,[e].concat(t));var r},e.preload=function(e){return this.getRepository().preload(e)},e.save=function(e,t){return this.getRepository().save(e,t)},e.update=function(e,t,n){return this.getRepository().update(e,t,n)},e.updateById=function(e,t,n){return this.getRepository().updateById(e,t,n)},e.remove=function(e,t){return this.getRepository().remove(e,t)},e.removeById=function(e,t){return this.getRepository().removeById(e,t)},e.count=function(e){return this.getRepository().count(e)},e.find=function(e){return this.getRepository().find(e)},e.findAndCount=function(e){return this.getRepository().findAndCount(e)},e.findByIds=function(e,t){return this.getRepository().findByIds(e,t)},e.findOne=function(e){return this.getRepository().findOne(e)},e.findOneById=function(e,t){return this.getRepository().findOneById(e,t)},e.query=function(e,t){return this.getRepository().query(e,t)},e.clear=function(){return this.getRepository().clear()},e}(),e("BaseEntity",r)}}}),System.register("typeorm/index",["typeorm/connection/ConnectionManager","typeorm/metadata-args/MetadataArgsStorage","typeorm/container","typeorm/platform/PlatformTools","typeorm/connection/ConnectionOptionsReader","typeorm/decorator/columns/Column","typeorm/decorator/columns/CreateDateColumn","typeorm/decorator/columns/DiscriminatorColumn","typeorm/decorator/columns/PrimaryGeneratedColumn","typeorm/decorator/columns/PrimaryColumn","typeorm/decorator/columns/UpdateDateColumn","typeorm/decorator/columns/VersionColumn","typeorm/decorator/columns/ObjectIdColumn","typeorm/decorator/listeners/AfterInsert","typeorm/decorator/listeners/AfterLoad","typeorm/decorator/listeners/AfterRemove","typeorm/decorator/listeners/AfterUpdate","typeorm/decorator/listeners/BeforeInsert","typeorm/decorator/listeners/BeforeRemove","typeorm/decorator/listeners/BeforeUpdate","typeorm/decorator/listeners/EventSubscriber","typeorm/decorator/relations/RelationCount","typeorm/decorator/relations/JoinColumn","typeorm/decorator/relations/JoinTable","typeorm/decorator/relations/ManyToMany","typeorm/decorator/relations/ManyToOne","typeorm/decorator/relations/OneToMany","typeorm/decorator/relations/OneToOne","typeorm/decorator/relations/RelationId","typeorm/decorator/entity/Entity","typeorm/decorator/entity/AbstractEntity","typeorm/decorator/entity/ClassEntityChild","typeorm/decorator/entity/ClosureEntity","typeorm/decorator/entity/EmbeddableEntity","typeorm/decorator/entity/SingleEntityChild","typeorm/decorator/entity/TableInheritance","typeorm/decorator/transaction/Transaction","typeorm/decorator/transaction/TransactionEntityManager","typeorm/decorator/tree/TreeLevelColumn","typeorm/decorator/tree/TreeParent","typeorm/decorator/tree/TreeChildren","typeorm/decorator/Index","typeorm/decorator/Embedded","typeorm/decorator/DiscriminatorValue","typeorm/decorator/EntityRepository","typeorm/schema-builder/schema/ColumnSchema","typeorm/schema-builder/schema/ForeignKeySchema","typeorm/schema-builder/schema/IndexSchema","typeorm/schema-builder/schema/PrimaryKeySchema","typeorm/schema-builder/schema/TableSchema","typeorm/driver/mongodb/typings","typeorm/connection/Connection","typeorm/query-builder/QueryBuilder","typeorm/entity-manager/EntityManager","typeorm/entity-manager/MongoEntityManager","typeorm/naming-strategy/DefaultNamingStrategy","typeorm/repository/Repository","typeorm/repository/TreeRepository","typeorm/repository/MongoRepository","typeorm/repository/BaseEntity"],function(e,t){"use strict";function n(){return a.getFromContainer(i.ConnectionManager)}function r(t){var n={};for(var r in t)"default"===r||c.hasOwnProperty(r)||(n[r]=t[r]);e(n)}t&&t.id;e("getMetadataArgsStorage",function(){var e=s.PlatformTools.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new o.MetadataArgsStorage),e.typeormMetadataArgsStorage}),e("getConnectionManager",n),e("createConnection",function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return e?[3,2]:[4,(new u.ConnectionOptionsReader).get("default")];case 1:e=t.sent(),t.label=2;case 2:return[2,n().create(e).connect()]}})})}),e("createConnections",function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return e?[3,2]:[4,(new u.ConnectionOptionsReader).all()];case 1:e=t.sent(),t.label=2;case 2:return[2,Promise.all(e.map(function(e){return n().create(e).connect()}))]}})})}),e("getConnection",function(e){return void 0===e&&(e="default"),n().get(e)}),e("getEntityManager",function(e){return void 0===e&&(e="default"),n().get(e).manager}),e("getRepository",function(e,t){return void 0===t&&(t="default"),n().get(t).getRepository(e)}),e("getTreeRepository",function(e,t){return void 0===t&&(t="default"),n().get(t).getTreeRepository(e)}),e("getMongoRepository",function(e,t){return void 0===t&&(t="default"),n().get(t).getMongoRepository(e)});var i,o,a,s,u,c={getMetadataArgsStorage:!0,getConnectionManager:!0,createConnection:!0,createConnections:!0,getConnection:!0,getEntityManager:!0,getRepository:!0,getTreeRepository:!0,getMongoRepository:!0,ConnectionOptionsReader:!0,Connection:!0,ConnectionManager:!0,QueryBuilder:!0,EntityManager:!0,MongoEntityManager:!0,DefaultNamingStrategy:!0,Repository:!0,TreeRepository:!0,MongoRepository:!0,BaseEntity:!0};return{setters:[function(t){i=t,e({ConnectionManager:t.ConnectionManager})},function(e){o=e},function(e){a=e,r(e)},function(e){s=e},function(t){u=t,e({ConnectionOptionsReader:t.ConnectionOptionsReader})},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e),r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e),r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(e){r(e)},function(t){e({Connection:t.Connection})},function(t){e({QueryBuilder:t.QueryBuilder})},function(t){e({EntityManager:t.EntityManager})},function(t){e({MongoEntityManager:t.MongoEntityManager})},function(t){e({DefaultNamingStrategy:t.DefaultNamingStrategy})},function(t){e({Repository:t.Repository})},function(t){e({TreeRepository:t.TreeRepository})},function(t){e({MongoRepository:t.MongoRepository})},function(t){e({BaseEntity:t.BaseEntity})}],execute:function(){}}}),System.register("typeorm",["typeorm/index"],function(e,t){"use strict";function n(t){var n={};for(var r in t)"default"!==r&&(n[r]=t[r]);e(n)}t&&t.id;return{setters:[function(e){n(e)}],execute:function(){}}}),System.register("typeorm/query-runner/QueryRunnerProvider",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){void 0===t&&(t=!1),this.driver=e,this.useSingleQueryRunner=t}return Object.defineProperty(e.prototype,"isReleased",{get:function(){return this._isReleased},enumerable:!0,configurable:!0}),e.prototype.releaseReused=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._isReleased=!0,this.reusableQueryRunner?[2,this.reusableQueryRunner.release()]:[2]})})},e}(),e("QueryRunnerProvider",n)}}}),System.register("typeorm/connection/error/CannotDetermineConnectionOptionsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="CannotDetermineConnectionOptionsError",t.message='Cannot create connection, because connection options are missing. You either need to explicitly pass connection options, either create a ormconfig.json with connection options and "default" connection name, either to set proper environment variables. Also, if you are using environment-specific configurations in your ormconfig.json make sure your are running under correct NODE_ENV.',t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("CannotDetermineConnectionOptionsError",n)}}}),System.register("typeorm/connection/error/CannotGetEntityManagerNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotGetEntityManagerNotConnectedError",n.message='Cannot get entity manager for "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotGetEntityManagerNotConnectedError",n)}}}),System.register("typeorm/connection/error/CannotImportAlreadyConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="CannotImportAlreadyConnected",r.message="Cannot import "+t+' for "'+n+'" connection because connection to the database already established.',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("CannotImportAlreadyConnectedError",n)}}}),System.register("typeorm/connection/error/CannotRunMigrationNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotRunMigrationNotConnectedError",n.message='Cannot run/revert migrations on "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotRunMigrationNotConnectedError",n)}}}),System.register("typeorm/connection/error/CannotSyncNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotSyncNotConnectedError",n.message='Cannot sync schema of the "'+t+'" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotSyncNotConnectedError",n)}}}),System.register("typeorm/connection/error/CannotUseNamingStrategyNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="CannotUseNamingStrategyNotConnectedError",n.message='Cannot use a given naming strategy for "'+t+'" connection because connection to the database already established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("CannotUseNamingStrategyNotConnectedError",n)}}}),System.register("typeorm/connection/error/NamingStrategyNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;r.name="NamingStrategyNotFoundError";var i=t instanceof Function?t.name:t;return r.message='Naming strategy "'+i+'" was not found. Looks like this naming strategy does not exist or it was not registered in current "'+n+'" connection?',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("NamingStrategyNotFoundError",n)}}}),System.register("typeorm/connection/error/NoConnectionForRepositoryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="NoConnectionForRepositoryError",n.message='Cannot get a Repository for "'+t+" connection, because connection with the database is not established yet. Call connection#connect method to establish connection.",n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("NoConnectionForRepositoryError",n)}}}),System.register("typeorm/driver/error/DataTypeNotSupportedByDriverError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="DataTypeNotSupportedByDriverError",r.message="Specified type ("+t+") is not supported by "+n+" driver.",r}return __extends(t,e),t}(Error),e("DataTypeNotSupportedByDriverError",n)}}}),System.register("typeorm/driver/error/DriverPackageLoadError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="DriverPackageLoadError",t.message="Cannot load driver dependencies. Try to install all required dependencies.",t}return __extends(t,e),t}(Error),e("DriverPackageLoadError",n)}}}),System.register("typeorm/driver/error/DriverPoolingNotSupportedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name="DriverPoolingNotSupportedError",n.message="Connection pooling is not supported by ("+t+") driver.",n}return __extends(t,e),t}(Error),e("DriverPoolingNotSupportedError",n)}}}),System.register("typeorm/driver/mysql/MysqlColumnTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/postgres/PostgresColumnTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-builder/error/MetadataAlreadyExistsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n,r){var i=e.call(this)||this;return i.name="MetadataAlreadyExistsError",i.message=t+" metadata already exists for the class constructor "+JSON.stringify(n)+(r?" on property "+r:". If you previously renamed or moved entity class, make sure that compiled version of old entity class source wasn't left in the compiler output directory."),i}return __extends(t,e),t}(Error),e("MetadataAlreadyExistsError",n)}}}),System.register("typeorm/metadata-builder/error/MetadataWithSuchNameAlreadyExistsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="MetadataWithSuchNameAlreadyExistsError",r.message=t+" metadata with such name "+n+" already exists. Do you apply decorator twice? Or maybe try to change a name?",r}return __extends(t,e),t}(Error),e("MetadataWithSuchNameAlreadyExistsError",n)}}}),System.register("typeorm/metadata-builder/error/MissingJoinColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="MissingJoinColumnError",n.inverseRelation?r.message="JoinColumn is missing on both sides of "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on one of the sides.":r.message="JoinColumn is missing on "+t.name+"#"+n.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on it.",r}return __extends(t,e),t}(Error),e("MissingJoinColumnError",n)}}}),System.register("typeorm/metadata-builder/error/MissingJoinTableError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="MissingJoinTableError",n.inverseRelation?r.message="JoinTable is missing on both sides of "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" many-to-many relationship. You need to put decorator decorator on one of the sides.":r.message="JoinTable is missing on "+t.name+"#"+n.propertyName+" many-to-many relationship. You need to put JoinTable decorator on it.",r}return __extends(t,e),t}(Error),e("MissingJoinTableError",n)}}}),System.register("typeorm/metadata-builder/error/UsingJoinColumnIsNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinColumnIsNotAllowedError",r.message="Using JoinColumn on "+t.name+"#"+n.propertyName+" is wrong. You can use JoinColumn only on one-to-one and many-to-one relations.",r}return __extends(t,e),t}(Error),e("UsingJoinColumnIsNotAllowedError",n)}}}),System.register("typeorm/metadata-builder/error/UsingJoinColumnOnlyOnOneSideAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinColumnOnlyOnOneSideAllowedError",r.message="Using JoinColumn is allowed only on one side of the one-to-one relationship. Both "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinTable decorator only on it.",r}return __extends(t,e),t}(Error),e("UsingJoinColumnOnlyOnOneSideAllowedError",n)}}}),System.register("typeorm/metadata-builder/error/UsingJoinTableIsNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinTableIsNotAllowedError",r.message="Using JoinTable on "+t.name+"#"+n.propertyName+" is wrong. "+t.name+"#"+n.propertyName+" has "+n.relationType+" relation, however you can use JoinTable only on many-to-many relations.",r}return __extends(t,e),t}(Error),e("UsingJoinTableIsNotAllowedError",n)}}}),System.register("typeorm/metadata-builder/error/UsingJoinTableOnlyOnOneSideAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;return r.name="UsingJoinTableOnlyOnOneSideAllowedError",r.message="Using JoinTable is allowed only on one side of the many-to-many relationship. Both "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinColumn decorator only on it.",r}return __extends(t,e),t}(Error),e("UsingJoinTableOnlyOnOneSideAllowedError",n)}}}),System.register("typeorm/persistence/error/CascadesNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n,r){var i=e.call(this)||this;return i.name="CascadesNotAllowedError",i.message="Cascades ("+t+") are not allowed for the given relation "+n.name+"#"+r.joinColumns[0].referencedColumn.databaseName,i}return __extends(t,e),t}(Error),e("CascadesNotAllowedError",n)}}}),System.register("typeorm/persistence/error/PersistedEntityNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name="PersistedEntityNotFoundError",t.message="Internal error. Persisted entity was not found in the list of prepared operated entities.",t}return __extends(t,e),t}(Error),e("PersistedEntityNotFoundError",n)}}}),System.register("typeorm/repository/error/CustomRepositoryReusedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,"Custom entity repository "+(t instanceof Function?t.name:t.constructor.name)+" was already used in the different connection. You can't share entity repositories between different connections when useContainer is set to true for the entity repository.")||this;return n.name="CustomRepositoryReusedError",n}return __extends(t,e),t}(Error),e("CustomRepositoryReusedError",n)}}});